-- Ofuscado por ChatGPT (base64)
local encoded = [[bG9jYWwgdHlwZV9jdXN0b20gPSB0eXBlb2YKaWYgbm90IExQSF9PQkZVU0NBVEVEIHRoZW4KCUxQSF9KSVQgPSBmdW5jdGlvbiguLi4pCgkJcmV0dXJuIC4uLjsKCWVuZDsKCUxQSF9KSVRfTUFYID0gZnVuY3Rpb24oLi4uKQoJCXJldHVybiAuLi47CgllbmQ7CglMUEhfTk9fVklSVFVBTElaRSA9IGZ1bmN0aW9uKC4uLikKCQlyZXR1cm4gLi4uOwoJZW5kOwoJTFBIX05PX1VQVkFMVUVTID0gZnVuY3Rpb24oZikKCQlyZXR1cm4gKGZ1bmN0aW9uKC4uLikKCQkJcmV0dXJuIGYoLi4uKTsKCQllbmQpOwoJZW5kOwoJTFBIX0VOQ1NUUiA9IGZ1bmN0aW9uKC4uLikKCQlyZXR1cm4gLi4uOwoJZW5kOwoJTFBIX0VOQ05VTSA9IGZ1bmN0aW9uKC4uLikKCQlyZXR1cm4gLi4uOwoJZW5kOwoJTFBIX0VOQ0ZVTkMgPSBmdW5jdGlvbihmdW5jLCBrZXkxLCBrZXkyKQoJCWlmIGtleTEgfj0ga2V5MiB0aGVuIHJldHVybiBwcmludCgiTFBIX0VOQ0ZVTkMgbWlzbWF0Y2giKSBlbmQKCQlyZXR1cm4gZnVuYwoJZW5kCglMUEhfQ1JBU0ggPSBmdW5jdGlvbigpCgkJcmV0dXJuIHByaW50KGRlYnVnLnRyYWNlYmFjaygpKTsKCWVuZDsKICAgIFNXR19EaXNjb3JkVXNlciA9ICJzd2ltIgogICAgU1dHX0Rpc2NvcmRJRCA9IDEzMzcKICAgIFNXR19Qcml2YXRlID0gdHJ1ZQogICAgU1dHX0RldiA9IGZhbHNlCiAgICBTV0dfVmVyc2lvbiA9ICJkZXYiCiAgICBTV0dfVGl0bGUgPSAnc3ludGF4ICVzIC0gJXMnLS0nJCQkICBzeW50YXg8Zm9udCBjb2xvcj0icmdiKDE2NiwgMCwgMjU1KSI+Lnh5ejwvZm9udD4gJXMgLSAlcyAgJCQkJwogICAgU1dHX1Nob3J0TmFtZSA9ICdkZXYnCiAgICBTV0dfRnVsbE5hbWUgPSAnc3ludGF4LXRlYW0nCiAgICBTV0dfRkZBID0gZmFsc2UKZW5kOwotLS0gRkFCUklDQVRFRCBWQUxVRVMgRU5EISEhCgpsb2NhbCB3b3Jrc3BhY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpKQpsb2NhbCBQbGF5ZXJzID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikpCmxvY2FsIFJ1blNlcnZpY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKSkKbG9jYWwgTGlnaHRpbmcgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikpCmxvY2FsIFVzZXJJbnB1dFNlcnZpY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKSkKbG9jYWwgSHR0cFNlcnZpY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikpCmxvY2FsIEd1aUluc2V0ID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCJHdWlTZXJ2aWNlIikpOkdldEd1aUluc2V0KCkKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIE1vdXNlID0gTG9jYWxQbGF5ZXI6R2V0TW91c2UoKQpsb2NhbCBDYW1lcmEgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYQoKbG9jYWwgZnVuY3Rpb24gZ2V0ZmlsZShuYW1lKQogICAgbG9jYWwgcmVwbyA9ICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vU1dJTUhVQklTV0lNTUlORy9zd2ltaHViL21haW4vIgogICAgbG9jYWwgc3VjY2VzcywgY29udGVudCA9IHBjYWxsKHJlcXVlc3QsIHtVcmwgPSByZXBvLi5uYW1lLCBNZXRob2QgPSAiR0VUIn0pCiAgICBpZiBzdWNjZXNzIGFuZCBjb250ZW50LlN0YXR1c0NvZGUgPT0gMjAwIHRoZW4KICAgICAgICByZXR1cm4gY29udGVudC5Cb2R5CiAgICBlbHNlCiAgICAgICAgcmV0dXJuIHByaW50KCJnZXRmaWxlIHJldHVybmVkIGVycm9yIFwiIi4uY29udGVudC4uIlwiIikKICAgIGVuZAplbmQKbG9jYWwgZnVuY3Rpb24gaXNzeW50YXhmaWxlKGZpbGUpCiAgICByZXR1cm4gaXNmaWxlKCJzeW50YXgvbmV3L2ZpbGVzLyIuLmZpbGUpCmVuZApsb2NhbCBmdW5jdGlvbiByZWFkc3ludGF4ZmlsZShmaWxlKQogICAgaWYgbm90IGlzc3ludGF4ZmlsZShmaWxlKSB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIGxvY2FsIHN1Y2Nlc3MsIHJldHVybnMgPSBwY2FsbChyZWFkZmlsZSwgInN5bnRheC9uZXcvZmlsZXMvIi4uZmlsZSkKICAgIGlmIHN1Y2Nlc3MgdGhlbiByZXR1cm4gcmV0dXJucyBlbHNlIHJldHVybiBwcmludChyZXR1cm5zKSBlbmQKZW5kCmxvY2FsIGZ1bmN0aW9uIGxvYWRzeW50YXhmaWxlKGZpbGUpCiAgICBpZiBub3QgaXNzeW50YXhmaWxlKGZpbGUpIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgbG9jYWwgc3VjY2VzcywgcmV0dXJucyA9IHBjYWxsKGxvYWRzdHJpbmcsIHJlYWRzeW50YXhmaWxlKGZpbGUpKQogICAgaWYgc3VjY2VzcyB0aGVuIHJldHVybiByZXR1cm5zIGVsc2UgcmV0dXJuIHByaW50KHJldHVybnMpIGVuZAplbmQKbG9jYWwgZnVuY3Rpb24gZ2V0c3ludGF4YXNzZXQoZmlsZSkKICAgIGlmIGlzc3ludGF4ZmlsZShmaWxlKSB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIGxvY2FsIHN1Y2Nlc3MsIHJldHVybnMgPSBwY2FsbChnZXRjdXN0b21hc3NldCwgInN5bnRheC9uZXcvZmlsZXMvIi4uZmlsZSkKICAgIGlmIHN1Y2Nlc3MgdGhlbiByZXR1cm4gcmV0dXJucyBlbHNlIHJldHVybiBwcmludChyZXR1cm5zKSBlbmQKZW5kCmRvCiAgICBpZiBub3QgaXNmb2xkZXIoInN5bnRheCIpIHRoZW4gbWFrZWZvbGRlcigic3ludGF4IikgZW5kCiAgICBpZiBub3QgaXNmb2xkZXIoInN5bnRheC9uZXciKSB0aGVuIG1ha2Vmb2xkZXIoInN5bnRheC9uZXciKSBlbmQKICAgIGlmIG5vdCBpc2ZvbGRlcigic3ludGF4L25ldy9maWxlcyIpIHRoZW4gbWFrZWZvbGRlcigic3ludGF4L25ldy9maWxlcyIpIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gZ2V0ZmlsZXMoZm9yY2UsIGxpc3QpCiAgICAgICAgZm9yIF8sIGZpbGUgaW4gbGlzdCBkbwogICAgICAgICAgICBpZiAoZm9yY2Ugb3Igbm90IGZvcmNlIGFuZCBub3QgaXNzeW50YXhmaWxlKGZpbGUpKSB0aGVuCiAgICAgICAgICAgICAgICB3cml0ZWZpbGUoInN5bnRheC9uZXcvZmlsZXMvIi4uZmlsZSwgZ2V0ZmlsZShmaWxlKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGxvY2FsIGdvdGFzc2V0cyA9IGdldGZpbGUoImFzc2V0cy5qc29uIikKICAgIGxvY2FsIGFzc2V0cyA9IEh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoZ290YXNzZXRzKQogICAgbG9jYWwgbG9jYWxhc3NldHMgPSByZWFkc3ludGF4ZmlsZSgiYXNzZXRzLmpzb24iKQogICAgaWYgbG9jYWxhc3NldHMgdGhlbgogICAgICAgIGxvY2FsYXNzZXRzID0gSHR0cFNlcnZpY2U6SlNPTkRlY29kZShsb2NhbGFzc2V0cykKICAgICAgICBpZiBsb2NhbGFzc2V0cy52ZXJzaW9uIH49IGFzc2V0cy52ZXJzaW9uIHRoZW4KICAgICAgICAgICAgd3JpdGVmaWxlKCJzeW50YXgvbmV3L2ZpbGVzL2Fzc2V0cy5qc29uIiwgZ290YXNzZXRzKQogICAgICAgICAgICBnZXRmaWxlcyh0cnVlLCBhc3NldHMubGlzdCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICB3cml0ZWZpbGUoInN5bnRheC9uZXcvZmlsZXMvYXNzZXRzLmpzb24iLCBnb3Rhc3NldHMpCiAgICBlbmQKICAgIGdldGZpbGVzKGZhbHNlLCBhc3NldHMubGlzdCkKZW5kCgotLSBzeW50YXggbWFpbgoKbG9jYWwgY2hlYXQgPSB7CiAgICBMaWJyYXJ5ID0gbmlsLAogICAgVG9nZ2xlcyA9IG5pbCwKICAgIE9wdGlvbnMgPSBuaWwsCiAgICBUaGVtZU1hbmFnZXIgPSBuaWwsCiAgICBTYXZlTWFuYWdlciA9IG5pbCwKICAgIGNvbm5lY3Rpb25zID0gewogICAgICAgIGhlYXJ0YmVhdHMgPSB7fSwKICAgICAgICByZW5kZXJzdGVwcGVkID0ge30KICAgIH0sCiAgICBkcmF3aW5ncyA9IHt9LAogICAgaG9va3MgPSB7fQp9CmNoZWF0LnV0aWxpdHkgPSB7fSBkbwogICAgY2hlYXQudXRpbGl0eS5uZXdfaGVhcnRiZWF0ID0gZnVuY3Rpb24oZnVuYykKICAgICAgICBsb2NhbCBvYmogPSB7fQogICAgICAgIGNoZWF0LmNvbm5lY3Rpb25zLmhlYXJ0YmVhdHNbZnVuY10gPSBmdW5jCiAgICAgICAgZnVuY3Rpb24gb2JqOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBpZiBmdW5jIHRoZW4KICAgICAgICAgICAgICAgIGNoZWF0LmNvbm5lY3Rpb25zLmhlYXJ0YmVhdHNbZnVuY10gPSBuaWwKICAgICAgICAgICAgICAgIGZ1bmMgPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIG9iagogICAgZW5kCiAgICBjaGVhdC51dGlsaXR5Lm5ld19yZW5kZXJzdGVwcGVkID0gZnVuY3Rpb24oZnVuYykKICAgICAgICBsb2NhbCBvYmogPSB7fQogICAgICAgIGNoZWF0LmNvbm5lY3Rpb25zLnJlbmRlcnN0ZXBwZWRbZnVuY10gPSBmdW5jCiAgICAgICAgZnVuY3Rpb24gb2JqOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBpZiBmdW5jIHRoZW4KICAgICAgICAgICAgICAgIGNoZWF0LmNvbm5lY3Rpb25zLnJlbmRlcnN0ZXBwZWRbZnVuY10gPSBuaWwKICAgICAgICAgICAgICAgIGZ1bmMgPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIG9iagogICAgZW5kCiAgICBjaGVhdC51dGlsaXR5Lm5ld19kcmF3aW5nID0gZnVuY3Rpb24oZHJhd29iaiwgYXJncykKICAgICAgICBsb2NhbCBvYmogPSBEcmF3aW5nLm5ldyhkcmF3b2JqKQogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGFyZ3MpIGRvCiAgICAgICAgICAgIG9ialtpXSA9IHYKICAgICAgICBlbmQKICAgICAgICBjaGVhdC5kcmF3aW5nc1tvYmpdID0gb2JqCiAgICAgICAgcmV0dXJuIG9iagogICAgZW5kCiAgICBjaGVhdC51dGlsaXR5Lm5ld19ob29rID0gZnVuY3Rpb24oZiwgbmV3ZiwgdXNlY2Nsb3N1cmUpIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICBpZiB1c2VjY2xvc3VyZSB0aGVuCiAgICAgICAgICAgIGxvY2FsIG9sZDsgb2xkID0gaG9va2Z1bmN0aW9uKGYsIG5ld2NjbG9zdXJlKGZ1bmN0aW9uKC4uLikKICAgICAgICAgICAgICAgIHJldHVybiBuZXdmKG9sZCwgLi4uKQogICAgICAgICAgICBlbmQpKQogICAgICAgICAgICBjaGVhdC5ob29rc1tmXSA9IG9sZAogICAgICAgICAgICByZXR1cm4gb2xkCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbCBvbGQ7IG9sZCA9IGhvb2tmdW5jdGlvbihmLCBmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3ZihvbGQsIC4uLikKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBjaGVhdC5ob29rc1tmXSA9IG9sZAogICAgICAgICAgICByZXR1cm4gb2xkCiAgICAgICAgZW5kCiAgICBlbmQpKCkgZW5kCiAgICBsb2NhbCBjb25uZWN0aW9uOyBjb25uZWN0aW9uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihkZWx0YSkKICAgICAgICBmb3IgXywgZnVuYyBpbiBwYWlycyhjaGVhdC5jb25uZWN0aW9ucy5oZWFydGJlYXRzKSBkbwogICAgICAgICAgICBmdW5jKGRlbHRhKQogICAgICAgIGVuZAogICAgZW5kKSkKICAgIGxvY2FsIGNvbm5lY3Rpb24xOyBjb25uZWN0aW9uMSA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKGRlbHRhKQogICAgICAgIGZvciBfLCBmdW5jIGluIHBhaXJzKGNoZWF0LmNvbm5lY3Rpb25zLnJlbmRlcnN0ZXBwZWQpIGRvCiAgICAgICAgICAgIGZ1bmMoZGVsdGEpCiAgICAgICAgZW5kCiAgICBlbmQpKQogICAgY2hlYXQudXRpbGl0eS51bmxvYWQgPSBmdW5jdGlvbigpCiAgICAgICAgY29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBjb25uZWN0aW9uMTpEaXNjb25uZWN0KCkKICAgICAgICBmb3Iga2V5LCBfIGluIHBhaXJzKGNoZWF0LmNvbm5lY3Rpb25zLmhlYXJ0YmVhdHMpIGRvCiAgICAgICAgICAgIGNoZWF0LmNvbm5lY3Rpb25zLmhlYXJ0YmVhdHNba2V5XSA9IG5pbAogICAgICAgIGVuZAogICAgICAgIGZvciBrZXksIF8gaW4gcGFpcnMoY2hlYXQuY29ubmVjdGlvbnMucmVuZGVyc3RlcHBlZCkgZG8KICAgICAgICAgICAgY2hlYXQuY29ubmVjdGlvbnMuaGVhcnRiZWF0c1trZXldID0gbmlsCiAgICAgICAgZW5kCiAgICAgICAgZm9yIF8sIGRyYXdpbmcgaW4gcGFpcnMoY2hlYXQuZHJhd2luZ3MpIGRvCiAgICAgICAgICAgIGRyYXdpbmc6UmVtb3ZlKCkKICAgICAgICAgICAgY2hlYXQuZHJhd2luZ3NbX10gPSBuaWwKICAgICAgICBlbmQKICAgICAgICBmb3IgaG9va2VkLCBvcmlnaW5hbCBpbiBwYWlycyhjaGVhdC5ob29rcykgZG8KICAgICAgICAgICAgaWYgdHlwZShvcmlnaW5hbCkgPT0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgICAgICAgICBob29rZnVuY3Rpb24oaG9va2VkLCBjbG9uZWZ1bmN0aW9uKG9yaWdpbmFsKSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaG9va21ldGFtZXRob2Qob3JpZ2luYWxbImluc3RhbmNlIl0sIG9yaWdpbmFsWyJtZXRhbWV0aG9kIl0sIGNsb25lZnVuY3Rpb24ob3JpZ2luYWxbImZ1bmMiXSkpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAotLSBbdmVyc2lvbjp0c10KLS0gW3RyYW5zbGF0aW9uOnRyaWRlbnQgc3Vydml2YWxdCi0tIFtzY3JpcHRpZDp0cmlkZW50c3Vydml2YWxdCmxvY2FsIF9DRnJhbWVuZXcgPSBDRnJhbWUubmV3CmxvY2FsIF9WZWN0b3IybmV3ID0gVmVjdG9yMi5uZXcKbG9jYWwgX1ZlY3RvcjNuZXcgPSBWZWN0b3IzLm5ldwpsb2NhbCBfSXNEZXNjZW5kYW50T2YgPSBnYW1lLklzRGVzY2VuZGFudE9mCmxvY2FsIF9GaW5kRmlyc3RDaGlsZCA9IGdhbWUuRmluZEZpcnN0Q2hpbGQKbG9jYWwgX0ZpbmRGaXJzdENoaWxkT2ZDbGFzcyA9IGdhbWUuRmluZEZpcnN0Q2hpbGRPZkNsYXNzCmxvY2FsIF9SYXljYXN0ID0gd29ya3NwYWNlLlJheWNhc3QKbG9jYWwgX0lzS2V5RG93biA9IFVzZXJJbnB1dFNlcnZpY2UuSXNLZXlEb3duCmxvY2FsIF9Xb3JsZFRvVmlld3BvcnRQb2ludCA9IENhbWVyYS5Xb3JsZFRvVmlld3BvcnRQb2ludApsb2NhbCBfVmVjdG9yM3plcm9taW4gPSBWZWN0b3IzLnplcm8uTWluCmxvY2FsIF9WZWN0b3IyemVyb21pbiA9IFZlY3RvcjIuemVyby5NaW4KbG9jYWwgX1ZlY3RvcjN6ZXJvbWF4ID0gVmVjdG9yMy56ZXJvLk1heApsb2NhbCBfVmVjdG9yMnplcm9tYXggPSBWZWN0b3IyLnplcm8uTWF4CmxvY2FsIF9Jc0EgPSBnYW1lLklzQQpsb2NhbCB0YWJsZWNyZWF0ZSA9IHRhYmxlLmNyZWF0ZQpsb2NhbCBtYXRoZmxvb3IgPSBtYXRoLmZsb29yCmxvY2FsIG1hdGhyb3VuZCA9IG1hdGgucm91bmQKbG9jYWwgbWF0aGNsYW1wID0gbWF0aC5jbGFtcApsb2NhbCB0b3N0cmluZyA9IHRvc3RyaW5nCmxvY2FsIHVucGFjayA9IHVucGFjawpsb2NhbCBnZXR1cHZhbHVlcyA9IGRlYnVnLmdldHVwdmFsdWVzCmxvY2FsIGdldHVwdmFsdWUgPSBkZWJ1Zy5nZXR1cHZhbHVlCmxvY2FsIHNldHVwdmFsdWUgPSBkZWJ1Zy5zZXR1cHZhbHVlCmxvY2FsIGdldGNvbnN0YW50cyA9IGRlYnVnLmdldGNvbnN0YW50cwpsb2NhbCBnZXRjb25zdGFudCA9IGRlYnVnLmdldGNvbnN0YW50CmxvY2FsIHNldGNvbnN0YW50ID0gZGVidWcuc2V0Y29uc3RhbnQKbG9jYWwgZ2V0c3RhY2sgPSBkZWJ1Zy5nZXRzdGFjawpsb2NhbCBzZXRzdGFjayA9IGRlYnVnLnNldHN0YWNrCmxvY2FsIGdldGluZm8gPSBkZWJ1Zy5nZXRpbmZvCmxvY2FsIHJhd2dldCA9IHJhd2dldAoKbG9jYWwgdHJpZGVudCA9IHsKICAgIGxvYWRlZCA9IGZhbHNlLAogICAgbGFzdHBvcyA9IG5pbCwKICAgIG1pZGRsZXBhcnQgPSBuaWwsCiAgICB0Y3AgPSBuaWwsCiAgICBvcmlnaW5hbF9tb2RlbCA9IG5pbAp9CmxvY2FsIGdhcmJhZ2UgPSB7fQpsb2NhbCBjbGFzc2VzID0gbmlsOwpsb2NhbCBydW5vbmFjdG9ydXNlZCA9IGZhbHNlCgppZiBub3QgKGhvb2tmdW5jdGlvbiBhbmQgaG9va21ldGFtZXRob2QgYW5kIGdldGdjIGFuZCBnZXR1cHZhbHVlcyBhbmQgZ2V0dXB2YWx1ZSkgdGhlbiByZXR1cm4gcHJpbnQoJ3d0ZiBkdWRlLi4uJykgZW5kCkxQSF9KSVRfTUFYKGZ1bmN0aW9uKCkKICAgIGZvciBpLHYgaW4gcGFpcnMoZ2V0Z2ModHJ1ZSkpIGRvCiAgICAgICAgaWYgdHlwZSh2KSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgaWYgdHlwZShyYXdnZXQodiwgIkNhbWVyYSIpKSA9PSAidGFibGUiIGFuZCByYXdnZXQocmF3Z2V0KHYsICJDYW1lcmEiKSwgInR5cGUiKSA9PSAiQ2FtZXJhIiB0aGVuCiAgICAgICAgICAgICAgICBjbGFzc2VzID0gdgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgdHlwZShyYXdnZXQodiwgInVwZGF0ZUNoYXJhY3RlciIpKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgICAgIGdhcmJhZ2UuY2hhcmFjdGVyID0gdgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgcmF3Z2V0KHYsICJTZXRNYXhSZWxhdGl2ZUxvb2tFeHRlbnRzWSIpIHRoZW4KICAgICAgICAgICAgICAgIGdhcmJhZ2UubWF4bG9va3kgPSByYXdnZXQodiwgIlNldE1heFJlbGF0aXZlTG9va0V4dGVudHNZIikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIHJhd2dldCh2LCAiR2V0RXF1aXBwZWRJdGVtIikgdGhlbgogICAgICAgICAgICAgICAgLS1wcmludCgnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJykKICAgICAgICAgICAgICAgIC0tdGFibGUuZm9yZWFjaChnZXRpbmZvKHYuR2V0RXF1aXBwZWRJdGVtKSwgcHJpbnQpCiAgICAgICAgICAgICAgICAtLXRhYmxlLmZvcmVhY2godiwgcHJpbnQpCiAgICAgICAgICAgICAgICAtLWZvciBfLCB2MSBpbiB2IGRvIGlmIHR5cGUodikgPT0gImZ1bmN0aW9uIiBhbmQgZ2V0aW5mbyh2MSkuc2hvcnRfc3JjOmZpbmQoIkZQUyIpIHRoZW4gcHJpbnQodjEpIGVuZCBlbmQKICAgICAgICAgICAgICAgIC0tcHJpbnQoc3dpbWR1bXAoZ2V0dXB2YWx1ZXModls1XSlbMV0pKQogICAgICAgICAgICAgICAgZ2FyYmFnZS5lcXVpcHBlZGl0ZW0gPSByYXdnZXQodiwgIkdldEVxdWlwcGVkSXRlbSIpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiByYXdnZXQodiwgIkdldEVudGl0eUZyb21QYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgLS1wcmludChzd2ltZHVtcChnZXR1cHZhbHVlcyh2WzVdKVsxXSkpCiAgICAgICAgICAgICAgICBnYXJiYWdlLmVudGl0eWxpc3QgPSByYXdnZXQodiwgIkdldEVudGl0eUZyb21QYXJ0IikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIHJhd2dldCh2LCAiUmVjb2lsIikgYW5kIGdldGluZm8ocmF3Z2V0KHYsICJSZWNvaWwiKSkuc2hvcnRfc3JjOmZpbmQoIkNhbWVyYSIpIHRoZW4KICAgICAgICAgICAgICAgIC0tcHJpbnQoc3dpbWR1bXAoZ2V0dXB2YWx1ZXModls1XSlbMV0pKQogICAgICAgICAgICAgICAgLS1wcmludCgnb2JheXVkbm8nKQogICAgICAgICAgICAgICAgZ2FyYmFnZS5yZWNvaWwgPSByYXdnZXQodiwgIlJlY29pbCIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICAtLVtbZm9yIGksdiBpbiBwYWlycyhnZXRnYyh0cnVlKSkgZG8KICAgICAgICBpZiB0eXBlKHYpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICBpZiB0eXBlKHJhd2dldCh2LCAiQ2FtZXJhIikpID09ICJ0YWJsZSIgYW5kIHJhd2dldChyYXdnZXQodiwgIkNhbWVyYSIpLCAidHlwZSIpID09ICJDYW1lcmEiIHRoZW4KICAgICAgICAgICAgICAgIGNsYXNzZXMgPSB2CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiB0eXBlKHJhd2dldCh2LCAidXBkYXRlQ2hhcmFjdGVyIikpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgZ2FyYmFnZS5jaGFyYWN0ZXIgPSB2CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiB0YWJsZS5maW5kKHYsICJTZXRNYXhSZWxhdGl2ZUxvb2tFeHRlbnRzWSIpIHRoZW4KICAgICAgICAgICAgICAgIGdhcmJhZ2UubWF4bG9va3kgPSByYXdnZXQodiwgNSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQodiwgIkdldEVxdWlwcGVkSXRlbSIpIHRoZW4KICAgICAgICAgICAgICAgIC0tcHJpbnQoJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpCiAgICAgICAgICAgICAgICAtLXRhYmxlLmZvcmVhY2goZ2V0aW5mbyh2LkdldEVxdWlwcGVkSXRlbSksIHByaW50KQogICAgICAgICAgICAgICAgLS10YWJsZS5mb3JlYWNoKHYsIHByaW50KQogICAgICAgICAgICAgICAgLS1mb3IgXywgdjEgaW4gdiBkbyBpZiB0eXBlKHYpID09ICJmdW5jdGlvbiIgYW5kIGdldGluZm8odjEpLnNob3J0X3NyYzpmaW5kKCJGUFMiKSB0aGVuIHByaW50KHYxKSBlbmQgZW5kCiAgICAgICAgICAgICAgICAtLXByaW50KHN3aW1kdW1wKGdldHVwdmFsdWVzKHZbNV0pWzFdKSkKICAgICAgICAgICAgICAgIGdhcmJhZ2UuZXF1aXBwZWRpdGVtID0gcmF3Z2V0KHYsIDUpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiB0YWJsZS5maW5kKHYsICJHZXRFbnRpdHlGcm9tUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgIC0tcHJpbnQoc3dpbWR1bXAoZ2V0dXB2YWx1ZXModls1XSlbMV0pKQogICAgICAgICAgICAgICAgZ2FyYmFnZS5lbnRpdHlsaXN0ID0gcmF3Z2V0KHYsIDUpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiB0YWJsZS5maW5kKHYsICJSZWNvaWwiKSBhbmQgZ2V0aW5mbyhyYXdnZXQodiwgNSkpLnNob3J0X3NyYzpmaW5kKCJDYW1lcmEiKSB0aGVuCiAgICAgICAgICAgICAgICAtLXByaW50KHN3aW1kdW1wKGdldHVwdmFsdWVzKHZbNV0pWzFdKSkKICAgICAgICAgICAgICAgIC0tcHJpbnQoJ29iYXl1ZG5vJykKICAgICAgICAgICAgICAgIGdhcmJhZ2UucmVjb2lsID0gcmF3Z2V0KHYsIDUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kXV0KZW5kKSgpCgppZiBub3QgKGNsYXNzZXMgYW5kIGdhcmJhZ2UuY2hhcmFjdGVyIGFuZCBnYXJiYWdlLm1heGxvb2t5IGFuZCBnYXJiYWdlLmVxdWlwcGVkaXRlbSBhbmQgZ2FyYmFnZS5lbnRpdHlsaXN0IGFuZCBnYXJiYWdlLnJlY29pbCkgdGhlbgogICAgcmV0dXJuIHByaW50KCJVU0UgQU4gQUNUT1IgQllQQVNTLi4uIikKZW5kCgpyZXBlYXQgaWYgbm90IHBjYWxsKGZ1bmN0aW9uKCkKICAgIHRyaWRlbnQubWlkZGxlcGFydCA9IHdvcmtzcGFjZS5Db25zdC5JZ25vcmUuTG9jYWxDaGFyYWN0ZXIuTWlkZGxlCiAgICB0cmlkZW50Lm9yaWdpbmFsX21vZGVsID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlNoYXJlZC5lbnRpdGllcy5QbGF5ZXIuTW9kZWwKICAgIHRyaWRlbnQudGNwID0gTG9jYWxQbGF5ZXIuVENQCiAgICB0cmlkZW50LnVkcCA9IExvY2FsUGxheWVyLlVEUAogICAgdHJpZGVudC52YWxpZF90eXBlcyA9IHt9CiAgICB0cmlkZW50LnZhbGlkX3R5cGVzWyJQbGF5ZXIiXSA9IHRydWUKICAgIGZvciBfLCB2IGluIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TaGFyZWQuZW50aXRpZXMuTlBDOkdldENoaWxkcmVuKCkgZG8KICAgICAgICB0cmlkZW50LnZhbGlkX3R5cGVzW3YuTmFtZV0gPSB0cnVlCiAgICBlbmQKZW5kKSB0aGVuIHRhc2sud2FpdCgwLjUpIGVuZCB1bnRpbCB0cmlkZW50Lm1pZGRsZXBhcnQgYW5kIHRyaWRlbnQub3JpZ2luYWxfbW9kZWwgYW5kIHRyaWRlbnQudGNwCgpjaGVhdC5MaWJyYXJ5LCBjaGVhdC5Ub2dnbGVzLCBjaGVhdC5PcHRpb25zID0gbG9hZHN5bnRheGZpbGUoImxpYnJhcnlfbWFpbi5sdWEiKSgpCmNoZWF0LlRoZW1lTWFuYWdlciA9IGxvYWRzeW50YXhmaWxlKCJsaWJyYXJ5X3RoZW1lLmx1YSIpKCkKY2hlYXQuU2F2ZU1hbmFnZXIgPSBsb2Fkc3ludGF4ZmlsZSgibGlicmFyeV9zYXZlLmx1YSIpKCkKbG9jYWwgdWkgPSB7CiAgICB3aW5kb3cgPSBjaGVhdC5MaWJyYXJ5OkNyZWF0ZVdpbmRvdyh7CiAgICAgICAgVGl0bGU9c3RyaW5nLmZvcm1hdCgKICAgICAgICAgICAgU1dHX1RpdGxlLAogICAgICAgICAgICBTV0dfVmVyc2lvbiwKICAgICAgICAgICAgU1dHX0Z1bGxOYW1lCiAgICAgICAgKSwKICAgIENlbnRlcj10cnVlLEF1dG9TaG93PXRydWUsVGFiUGFkZGluZz04fSkKfQoKdWkudGFicyA9IHsKICAgIGNvbWJhdCA9IHVpLndpbmRvdzpBZGRUYWIoJ2NvbWJhdCcpLAogICAgdmlzdWFscyA9IHVpLndpbmRvdzpBZGRUYWIoJ3Zpc3VhbHMnKSwKICAgIG1pc2MgPSB1aS53aW5kb3c6QWRkVGFiKCdtaXNjJyksCiAgICBjb25maWcgPSB1aS53aW5kb3c6QWRkVGFiKCdjb25maWcnKSwKfQp1aS5ib3ggPSB7CiAgICBhaW1ib3QgPSB1aS50YWJzLmNvbWJhdDpBZGRMZWZ0VGFiYm94KCksCiAgICBtb2RzID0gdWkudGFicy5jb21iYXQ6QWRkUmlnaHRUYWJib3goKSwKICAgIGFudGlhaW0gPSB1aS50YWJzLmNvbWJhdDpBZGRSaWdodFRhYmJveCgpLAogICAgZXNwID0gdWkudGFicy52aXN1YWxzOkFkZExlZnRUYWJib3goKSwKICAgIGNoZWF0dmlzID0gdWkudGFicy52aXN1YWxzOkFkZFJpZ2h0VGFiYm94KCksCiAgICB3b3JsZCA9IHVpLnRhYnMudmlzdWFsczpBZGRSaWdodFRhYmJveCgpLAogICAgbW92ZSA9IHVpLnRhYnMubWlzYzpBZGRMZWZ0VGFiYm94KCksCiAgICBhdHZmbHkgPSB1aS50YWJzLm1pc2M6QWRkTGVmdFRhYmJveCgpLAogICAgbWlzYyA9IHVpLnRhYnMubWlzYzpBZGRSaWdodFRhYmJveCgpLAogICAgdGhlbWVjb25maWcgPSB1aS50YWJzLmNvbmZpZzpBZGRMZWZ0R3JvdXBib3goJ3RoZW1lIGNvbmZpZycpLAp9Cgpsb2NhbCB2ZWN0b3JzID0gewogICAgVmVjdG9yMy56ZXJvLCAtLSBub25lCiAgICBfVmVjdG9yM25ldygxLCAwLCAwKSwgLS0gYmlnIHJpZ2h0CiAgICBfVmVjdG9yM25ldygtMSwgMCwgMCksIC0tIGJpZyBsZWZ0CiAgICBfVmVjdG9yM25ldygwLCAwLCAxKSwgLS0gYmlnIGZvcndhcmQKICAgIF9WZWN0b3IzbmV3KDAsIDAsIC0xKSwgLS0gYmlnIGJhY2t3YXJkCiAgICBfVmVjdG9yM25ldygwLCAxLCAwKSwgLS0gYmlnIHVwCiAgICBfVmVjdG9yM25ldygwLCAtMSwgMCksIC0tIGJpZyBkb3duCiAgICAKICAgIF9WZWN0b3IzbmV3KDEgLyAyLCAwLCAwKSwgLS0gc21hbGwgcmlnaHQKICAgIF9WZWN0b3IzbmV3KC0xIC8gMiwgMCwgMCksIC0tIHNtYWxsIGxlZnQKICAgIF9WZWN0b3IzbmV3KDAsIDAsIDEgLyAyKSwgLS0gc21hbGwgZm9yd2FyZAogICAgX1ZlY3RvcjNuZXcoMCwgMCwgLTEgLyAyKSwgLS0gc21hbGwgYmFja3dhcmQKICAgIF9WZWN0b3IzbmV3KDAsIDEgLyAyLCAwKSwgLS0gc21hbGwgdXAKICAgIF9WZWN0b3IzbmV3KDAsIC0xIC8gMiwgMCksIC0tIHNtYWxsIGRvd24KCiAgICBfVmVjdG9yM25ldygxIC8gMiwgMSAvIDIsIDApLCAtLSBzbWFsbCByaWdodCB1cAogICAgX1ZlY3RvcjNuZXcoMSAvIDIsIC0xIC8gMiwgMCksIC0tIHNtYWxsIHJpZ2h0IGRvd24KICAgIF9WZWN0b3IzbmV3KC0xIC8gMiwgMSAvIDIsIDApLCAtLSBzbWFsbCBsZWZ0IHVwCiAgICBfVmVjdG9yM25ldygtMSAvIDIsIC0xIC8gMiwgMCksIC0tIHNtYWxsIGxlZnQgZG93bgogICAgX1ZlY3RvcjNuZXcoMCwgMSAvIDIsIDEgLyAyKSwgLS0gc21hbGwgZm9yd2FyZCB1cAogICAgX1ZlY3RvcjNuZXcoMCwgLTEgLyAyLCAxIC8gMiksIC0tIHNtYWxsIGZvcndhcmQgZG93bgogICAgX1ZlY3RvcjNuZXcoMCwgMSAvIDIsIC0xIC8gMiksIC0tIHNtYWxsIGJhY2t3YXJkIHVwCiAgICBfVmVjdG9yM25ldygwLCAtMSAvIDIsIC0xIC8gMiksIC0tIHNtYWxsIGJhY2t3YXJkIGRvd24KfQotLVtbbG9jYWwgbXVsdGlwb2ludHMgPSB7CiAgICB7MSwgMSwgLTF9LAogICAgezEsIC0xLCAtMX0sCiAgICB7LTEsIC0xLCAtMX0sCiAgICB7LTEsIDEsIC0xfSwKICAgIHsxLCAxLCAxfSwKICAgIHsxLCAtMSwgMX0sCiAgICB7LTEsIC0xLCAxfSwKICAgIHstMSwgMSwgMX0sCiAgICB7MCwgMCwgMH0KfQoKbG9jYWwgZnVuY3Rpb24gR2V0Q29ybmVycyhjZnJhbWUsIHNpemUsIGlkeCkKICAgIHJldHVybiBjZnJhbWUgKiBfQ0ZyYW1lbmV3KHNpemUuWC8yICogKG11bHRpcG9pbnRzW2lkeF1bMV0qMC43KSwgc2l6ZS5ZLzIgKiAobXVsdGlwb2ludHNbaWR4XVsyXSowLjcpLCBzaXplLlovMiAqIChtdWx0aXBvaW50c1tpZHhdWzNdKjAuNykpCmVuZF1dCgpjaGVhdC5Fc3BMaWJyYXJ5ID0ge307CkxQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGVzcF90YWJsZSA9IHt9CiAgICBsb2NhbCB3b3Jrc3BhY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpKQogICAgbG9jYWwgcnNlcnZpY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKSkKICAgIGxvY2FsIHBscnMgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKSkKICAgIGxvY2FsIGxwbHIgPSBwbHJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBjb250YWluZXIgPSBJbnN0YW5jZS5uZXcoIkZvbGRlciIsIGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLlJvYmxveEd1aSkKICAgIGVzcF90YWJsZSA9IHsKICAgICAgICBfX2xvYWRlZCA9IGZhbHNlLAogICAgICAgIG1haW5fc2V0dGluZ3MgPSB7CiAgICAgICAgICAgIHRleHRTaXplID0gMTUsCiAgICAgICAgICAgIHRleHRGb250ID0gRHJhd2luZy5Gb250cy5Nb25vc3BhY2UsCiAgICAgICAgICAgIGRpc3RhbmNlbGltaXQgPSBmYWxzZSwKICAgICAgICAgICAgbWF4ZGlzdGFuY2UgPSAyMDAsCiAgICAgICAgICAgIHVzZXRlYW1jb2xvciA9IGZhbHNlLAogICAgICAgICAgICB0ZWFtY2hlY2sgPSBmYWxzZSwKICAgICAgICAgICAgc2xlZXBjaGVjayA9IGZhbHNlLAogICAgICAgICAgICBzaW1wbGVjYWxjID0gZmFsc2UKICAgICAgICB9LAogICAgICAgIG1haW5fb2JqZWN0X3NldHRpbmdzID0gewogICAgICAgICAgICB0ZXh0U2l6ZSA9IDE1LAogICAgICAgICAgICB0ZXh0Rm9udCA9IERyYXdpbmcuRm9udHMuTW9ub3NwYWNlLAogICAgICAgICAgICBkaXN0YW5jZWxpbWl0ID0gZmFsc2UsCiAgICAgICAgICAgIG1heGRpc3RhbmNlID0gMjAwLAogICAgICAgICAgICB1c2V0ZWFtY29sb3IgPSBmYWxzZSwKICAgICAgICAgICAgdGVhbWNoZWNrID0gZmFsc2UsCiAgICAgICAgICAgIHNsZWVwY2hlY2sgPSBmYWxzZSwKICAgICAgICAgICAgYWxsb3dlZCA9IHt9CiAgICAgICAgfSwKICAgICAgICBzZXR0aW5ncyA9IHsKICAgICAgICAgICAgZW5lbXkgPSB7CiAgICAgICAgICAgICAgICBlbmFibGVkID0gZmFsc2UsCiAgICAKICAgICAgICAgICAgICAgIGJveCA9IGZhbHNlLAogICAgICAgICAgICAgICAgYm94X2ZpbGwgPSBmYWxzZSwKICAgICAgICAgICAgICAgIHJlYWxuYW1lID0gZmFsc2UsCiAgICAgICAgICAgICAgICBkaXN0ID0gZmFsc2UsCiAgICAgICAgICAgICAgICB3ZWFwb24gPSBmYWxzZSwKICAgICAgICAgICAgICAgIHNrZWxldG9uID0gZmFsc2UsCiAgICAKICAgICAgICAgICAgICAgIGJveF9vdXRsaW5lID0gZmFsc2UsCiAgICAgICAgICAgICAgICByZWFsbmFtZV9vdXRsaW5lID0gZmFsc2UsCiAgICAgICAgICAgICAgICBkaXN0X291dGxpbmUgPSBmYWxzZSwKICAgICAgICAgICAgICAgIHdlYXBvbl9vdXRsaW5lID0gZmFsc2UsCiAgICAKICAgICAgICAgICAgICAgIGJveF9jb2xvciA9IHsgQ29sb3IzLm5ldygxLCAxLCAxKSwgMSB9LAogICAgICAgICAgICAgICAgYm94X2ZpbGxfY29sb3IgPSB7IENvbG9yMy5uZXcoMSwgMCwgMCksIDAuMyB9LAogICAgICAgICAgICAgICAgcmVhbG5hbWVfY29sb3IgPSB7IENvbG9yMy5uZXcoMSwgMSwgMSksIDEgfSwKICAgICAgICAgICAgICAgIGRpc3RfY29sb3IgPSB7IENvbG9yMy5uZXcoMSwgMSwgMSksIDEgfSwKICAgICAgICAgICAgICAgIHdlYXBvbl9jb2xvciA9IHsgQ29sb3IzLm5ldygxLCAxLCAxKSwgMSB9LAogICAgICAgICAgICAgICAgc2tlbGV0b25fY29sb3IgPSB7IENvbG9yMy5uZXcoMSwgMSwgMSksIDEgfSwKICAgIAogICAgICAgICAgICAgICAgYm94X291dGxpbmVfY29sb3IgPSB7IENvbG9yMy5uZXcoKSwgMSB9LAogICAgICAgICAgICAgICAgcmVhbG5hbWVfb3V0bGluZV9jb2xvciA9IENvbG9yMy5uZXcoKSwKICAgICAgICAgICAgICAgIGRpc3Rfb3V0bGluZV9jb2xvciA9IENvbG9yMy5uZXcoKSwKICAgICAgICAgICAgICAgIHdlYXBvbl9vdXRsaW5lX2NvbG9yID0gQ29sb3IzLm5ldygpLAogICAgCiAgICAgICAgICAgICAgICBjaGFtcyA9IGZhbHNlLAogICAgICAgICAgICAgICAgY2hhbXNfdmlzaWJsZV9vbmx5ID0gZmFsc2UsCiAgICAgICAgICAgICAgICBjaGFtc19maWxsX2NvbG9yID0geyBDb2xvcjMubmV3KDEsIDEsIDEpLCAwLjUgfSwKICAgICAgICAgICAgICAgIGNoYW1zb3V0bGluZV9jb2xvciA9IHsgQ29sb3IzLm5ldygxLCAxLCAxKSwgMCB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9iamVjdCA9IHsKICAgICAgICAgICAgICAgIGVuYWJsZWQgPSBmYWxzZSwKICAgICAgICAgICAgICAgIGFsbGVuYWJsZWQgPSBmYWxzZSwKCiAgICAgICAgICAgICAgICByZWFsbmFtZSA9IGZhbHNlLAogICAgICAgICAgICAgICAgcmVhbG5hbWVfb3V0bGluZSA9IGZhbHNlLAoKICAgICAgICAgICAgICAgIHJlYWxuYW1lX2NvbG9yID0geyBDb2xvcjMubmV3KDEsIDEsIDEpLCAxIH0sCiAgICAgICAgICAgICAgICByZWFsbmFtZV9vdXRsaW5lX2NvbG9yID0gQ29sb3IzLm5ldygpLAoKICAgICAgICAgICAgICAgIGNoYW1zID0gZmFsc2UsCiAgICAgICAgICAgICAgICBjaGFtc192aXNpYmxlX29ubHkgPSBmYWxzZSwKICAgICAgICAgICAgICAgIGNoYW1zX2ZpbGxfY29sb3IgPSB7IENvbG9yMy5uZXcoMSwgMSwgMSksIDAuNSB9LAogICAgICAgICAgICAgICAgY2hhbXNvdXRsaW5lX2NvbG9yID0geyBDb2xvcjMubmV3KDEsIDEsIDEpLCAwIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGxvY2FsIGxvYWRlZF9wbHJzID0ge30KICAgIC0tIChwbGVhc2UgdXBkYXRlIG1lKSB2YXJzCiAgICBsb2NhbCBjYW1lcmEgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYQoKICAgIC0tIGNvbnN0YW50cwogICAgbG9jYWwgVkVSVElDRVMgPSB7CiAgICAgICAgX1ZlY3RvcjNuZXcoLTEsIC0xLCAtMSksCiAgICAgICAgX1ZlY3RvcjNuZXcoLTEsIDEsIC0xKSwKICAgICAgICBfVmVjdG9yM25ldygtMSwgMSwgMSksCiAgICAgICAgX1ZlY3RvcjNuZXcoLTEsIC0xLCAxKSwKICAgICAgICBfVmVjdG9yM25ldygxLCAtMSwgLTEpLAogICAgICAgIF9WZWN0b3IzbmV3KDEsIDEsIC0xKSwKICAgICAgICBfVmVjdG9yM25ldygxLCAxLCAxKSwKICAgICAgICBfVmVjdG9yM25ldygxLCAtMSwgMSkKICAgIH0KICAgIGxvY2FsIHNrZWxldG9uX29yZGVyID0gewogICAgICAgIFsiTGVmdEZvb3QiXSA9ICJMZWZ0TG93ZXJMZWciLAogICAgICAgIFsiTGVmdExvd2VyTGVnIl0gPSAiTGVmdFVwcGVyTGVnIiwKICAgICAgICBbIkxlZnRVcHBlckxlZyJdID0gIkxvd2VyVG9yc28iLAogICAgCiAgICAgICAgWyJSaWdodEZvb3QiXSA9ICJSaWdodExvd2VyTGVnIiwKICAgICAgICBbIlJpZ2h0TG93ZXJMZWciXSA9ICJSaWdodFVwcGVyTGVnIiwKICAgICAgICBbIlJpZ2h0VXBwZXJMZWciXSA9ICJMb3dlclRvcnNvIiwKICAgIAogICAgICAgIFsiTGVmdEhhbmQiXSA9ICJMZWZ0TG93ZXJBcm0iLAogICAgICAgIFsiTGVmdExvd2VyQXJtIl0gPSAiTGVmdFVwcGVyQXJtIiwKICAgICAgICBbIkxlZnRVcHBlckFybSJdID0gIlRvcnNvIiwKICAgIAogICAgICAgIFsiUmlnaHRIYW5kIl0gPSAiUmlnaHRMb3dlckFybSIsCiAgICAgICAgWyJSaWdodExvd2VyQXJtIl0gPSAiUmlnaHRVcHBlckFybSIsCiAgICAgICAgWyJSaWdodFVwcGVyQXJtIl0gPSAiVG9yc28iLAogICAgCiAgICAgICAgWyJMb3dlclRvcnNvIl0gPSAiVG9yc28iLAogICAgICAgIFsiVG9yc28iXSA9ICJIZWFkIgogICAgfQogICAgLS0gdXB2YWx1ZXMKICAgIGxvY2FsIHBsYXllcl9tZW1vcnkgPSB7fQogICAgLS0gZ2FtZSBzcGVjaWZpYyBmdW5jdGlvbgogICAgbG9jYWwgZnVuY3Rpb24gZ2V0Y3VycmVudHdlYXBvbihlbnRpdHkpCiAgICAgICAgLS1yZXR1cm4gIk5vbmUiCiAgICAgICAgbG9jYWwgZ3VuID0gIk5vbmUiCiAgICAgICAgaWYgdHlwZShlbnRpdHkpID09ICJ0YWJsZSIgYW5kIHR5cGUocmF3Z2V0KGVudGl0eSwgImVxdWlwcGVkSXRlbSIpKSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHJhd2dldChyYXdnZXQoZW50aXR5LCAiZXF1aXBwZWRJdGVtIiksICJ0eXBlIikKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gZ3VuCiAgICBlbmQKICAgIC0tIGZ1bmN0aW9ucwogICAgbG9jYWwgZXNwID0ge30KICAgIGVzcC5jcmVhdGVfb2JqID0gZnVuY3Rpb24odHlwZSwgYXJncykKICAgICAgICBsb2NhbCBvYmogPSBEcmF3aW5nLm5ldyh0eXBlKQogICAgICAgIGZvciBpLCB2IGluIGFyZ3MgZG8KICAgICAgICAgICAgb2JqW2ldID0gdgogICAgICAgIGVuZAogICAgICAgIHJldHVybiBvYmoKICAgIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gaXNCb2R5UGFydChuYW1lKQogICAgICAgIHJldHVybiBuYW1lID09ICJIZWFkIiBvciBuYW1lOmZpbmQoIlRvcnNvIikgb3IgbmFtZTpmaW5kKCJMZWciKSBvciBuYW1lOmZpbmQoIkFybSIpCiAgICBlbmQKICAgIGxvY2FsIGZ1bmN0aW9uIGdldEJvdW5kaW5nQm94KHBhcnRzKQogICAgICAgIGxvY2FsIG1pbiwgbWF4CiAgICAgICAgZm9yIGkgPSAxLCAjcGFydHMgZG8KICAgICAgICAgICAgbG9jYWwgcGFydCA9IHBhcnRzW2ldCiAgICAgICAgICAgIGxvY2FsIGNmcmFtZSwgc2l6ZSA9IHBhcnQuQ0ZyYW1lLCBwYXJ0LlNpemUKICAgIAogICAgICAgICAgICBtaW4gPSBfVmVjdG9yM3plcm9taW4obWluIG9yIGNmcmFtZS5Qb3NpdGlvbiwgKGNmcmFtZSAtIHNpemUgKiAwLjUpLlBvc2l0aW9uKQogICAgICAgICAgICBtYXggPSBfVmVjdG9yM3plcm9tYXgobWF4IG9yIGNmcmFtZS5Qb3NpdGlvbiwgKGNmcmFtZSArIHNpemUgKiAwLjUpLlBvc2l0aW9uKQogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgY2VudGVyID0gKG1pbiArIG1heCkgKiAwLjUKICAgICAgICBsb2NhbCBmcm9udCA9IF9WZWN0b3IzbmV3KGNlbnRlci5YLCBjZW50ZXIuWSwgbWF4LlopCiAgICAgICAgcmV0dXJuIF9DRnJhbWVuZXcoY2VudGVyLCBmcm9udCksIG1heCAtIG1pbgogICAgZW5kCiAgICBsb2NhbCBmdW5jdGlvbiB3b3JsZFRvU2NyZWVuKHdvcmxkKQogICAgICAgIGxvY2FsIHNjcmVlbiwgaW5Cb3VuZHMgPSBfV29ybGRUb1ZpZXdwb3J0UG9pbnQoY2FtZXJhLCB3b3JsZCkKICAgICAgICByZXR1cm4gX1ZlY3RvcjJuZXcoc2NyZWVuLlgsIHNjcmVlbi5ZKSwgaW5Cb3VuZHMsIHNjcmVlbi5aCiAgICBlbmQKICAgIAogICAgbG9jYWwgZnVuY3Rpb24gY2FsY3VsYXRlQ29ybmVycyhjZnJhbWUsIHNpemUpCiAgICAgICAgbG9jYWwgY29ybmVycyA9IHRhYmxlY3JlYXRlKCNWRVJUSUNFUykKICAgICAgICBmb3IgaSA9IDEsICNWRVJUSUNFUyBkbwogICAgICAgICAgICBjb3JuZXJzW2ldID0gd29ybGRUb1NjcmVlbigoY2ZyYW1lICsgc2l6ZSAqIDAuNSAqIFZFUlRJQ0VTW2ldKS5Qb3NpdGlvbikKICAgICAgICBlbmQKICAgIAogICAgICAgIGxvY2FsIG1pbiA9IF9WZWN0b3IyemVyb21pbihjYW1lcmEuVmlld3BvcnRTaXplLCB1bnBhY2soY29ybmVycykpCiAgICAgICAgbG9jYWwgbWF4ID0gX1ZlY3RvcjJ6ZXJvbWF4KFZlY3RvcjIuemVybywgdW5wYWNrKGNvcm5lcnMpKQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNvcm5lcnMgPSBjb3JuZXJzLAogICAgICAgICAgICB0b3BMZWZ0ID0gX1ZlY3RvcjJuZXcobWF0aGZsb29yKG1pbi5YKSwgbWF0aGZsb29yKG1pbi5ZKSksCiAgICAgICAgICAgIHRvcFJpZ2h0ID0gX1ZlY3RvcjJuZXcobWF0aGZsb29yKG1heC5YKSwgbWF0aGZsb29yKG1pbi5ZKSksCiAgICAgICAgICAgIGJvdHRvbUxlZnQgPSBfVmVjdG9yMm5ldyhtYXRoZmxvb3IobWluLlgpLCBtYXRoZmxvb3IobWF4LlkpKSwKICAgICAgICAgICAgYm90dG9tUmlnaHQgPSBfVmVjdG9yMm5ldyhtYXRoZmxvb3IobWF4LlgpLCBtYXRoZmxvb3IobWF4LlkpKQogICAgICAgIH0KICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGNhbGN1bGF0ZUNvcm5lcnNTaW1wbGUoaGVhZCwgaHJwKQogICAgICAgIC0tW1sKICAgICAgICAgICAgYXV0byBoZWFkX3Bvc2l0aW9uID0gcm9ibG94OjpXb3JsZFRvU2NyZWVuKHZlY3RvcjNfc3ViKGhlYWQuR2V0UGFydFBvc2l0aW9uKCksIHsgMCwgLTAuNSwgMCB9KSwgZGltZW5zaW9ucywgdmlld21hdHJpeCk7CgkJCWF1dG8gbGVnX3Bvc2l0aW9uID0gcm9ibG94OjpXb3JsZFRvU2NyZWVuKHZlY3RvcjNfc3ViKHJvb3RwYXJ0LkdldFBhcnRQb3NpdGlvbigpLCB7IDAsIDMuNSwgMCB9KSwgZGltZW5zaW9ucywgdmlld21hdHJpeCk7CiAgICAgICAgICAgIGZsb2F0IGhlaWdodCA9IGxlZ19wb3NpdGlvbi55IC0gaGVhZF9wb3NpdGlvbi55OwoJCQlmbG9hdCB3aWR0aCA9IGhlaWdodCAvIDMuNmY7CiAgICAgICAgICAgIGNvcm5lcnMgPSB7CgkJCSAgICB7CgkJCSAgICAgICAgc3RhdGljX2Nhc3Q8aW50Pihyb3VuZChoZWFkX3Bvc2l0aW9uLnggLSB3aWR0aCkpLAoJCQkgICAgICAgIHN0YXRpY19jYXN0PGludD4ocm91bmQoaGVhZF9wb3NpdGlvbi55KSkKCQkJICAgIH0sIC8vIHVwIGxlZnQgY29ybmVyCgkJCQl7CgkJCSAgICAgICAgc3RhdGljX2Nhc3Q8aW50Pihyb3VuZChoZWFkX3Bvc2l0aW9uLnggLSB3aWR0aCkpLAoJCQkgICAgICAgIHN0YXRpY19jYXN0PGludD4ocm91bmQobGVnX3Bvc2l0aW9uLnkpKQoJCQkgICAgfSwgLy8gZG93biBsZWZ0IGNvcm5lcgoJCQkJewoJCQkgICAgICAgIHN0YXRpY19jYXN0PGludD4ocm91bmQoaGVhZF9wb3NpdGlvbi54ICsgd2lkdGgpKSwKCQkJICAgICAgICBzdGF0aWNfY2FzdDxpbnQ+KHJvdW5kKGhlYWRfcG9zaXRpb24ueSkpCgkJCSAgICB9LCAvLyB1cCByaWdodCBjb3JuZXIKCQkJICAgIHsKCQkJICAgICAgICBzdGF0aWNfY2FzdDxpbnQ+KHJvdW5kKGhlYWRfcG9zaXRpb24ueCArIHdpZHRoKSksCgkJCSAgICAgICAgc3RhdGljX2Nhc3Q8aW50Pihyb3VuZChsZWdfcG9zaXRpb24ueSkpCgkJCSAgICB9IC8vIGRvd24gcmlnaHQgY29ybmVyCgkJCX07CiAgICAgICAgXV0KICAgICAgICBsb2NhbCBoZWFkX3Bvc2l0aW9uID0gd29ybGRUb1NjcmVlbihoZWFkLlBvc2l0aW9uIC0gVmVjdG9yMy55QXhpcyAqIDAuNSkKICAgICAgICBsb2NhbCBsZWdfcG9zaXRpb24gPSB3b3JsZFRvU2NyZWVuKGhycC5Qb3NpdGlvbiAtIFZlY3RvcjMueUF4aXMgKiAzLjUpCiAgICAgICAgbG9jYWwgaGVhZHgsIGhlYWR5ID0gaGVhZF9wb3NpdGlvbi5YLCBoZWFkX3Bvc2l0aW9uLlkKICAgICAgICBsb2NhbCBsZWd4LCBsZWd5ID0gbGVnX3Bvc2l0aW9uLlgsIGxlZ19wb3NpdGlvbi5ZCiAgICAgICAgbG9jYWwgaGVpZ2h0ID0gbGVneSAtIGhlYWR5OwogICAgICAgIGxvY2FsIHdpZHRoID0gaGVpZ2h0IC8gMy42CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdG9wTGVmdCA9IF9WZWN0b3IybmV3KGhlYWR4IC0gd2lkdGgsIGhlYWR5KSwKICAgICAgICAgICAgdG9wUmlnaHQgPSBfVmVjdG9yMm5ldyhoZWFkeCAtIHdpZHRoLCBsZWd5KSwKICAgICAgICAgICAgYm90dG9tTGVmdCA9IF9WZWN0b3IybmV3KGhlYWR4ICsgd2lkdGgsIGhlYWR5KSwKICAgICAgICAgICAgYm90dG9tUmlnaHQgPV9WZWN0b3IybmV3KGhlYWR4ICsgd2lkdGgsIGxlZ3kpCiAgICAgICAgfQogICAgZW5kCgogICAgbG9jYWwgZW50dGl5aWRlbnRpZmljYXRpb24gPSB7fQogICAgZm9yIGksIHYgaW4gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlNoYXJlZC5lbnRpdGllczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgbG9jYWwgbW9kZWwgPSBfRmluZEZpcnN0Q2hpbGQodiwgIk1vZGVsIikKICAgICAgICBpZiBtb2RlbCBhbmQgbW9kZWwuUHJpbWFyeVBhcnQgdGhlbgogICAgICAgICAgICBlbnR0aXlpZGVudGlmaWNhdGlvblt2Lk5hbWVdID0gewogICAgICAgICAgICAgICAgQ29sbGlzaW9uR3JvdXAgPSBtb2RlbC5QcmltYXJ5UGFydC5Db2xsaXNpb25Hcm91cCwKICAgICAgICAgICAgICAgIE1hdGVyaWFsID0gbW9kZWwuUHJpbWFyeVBhcnQuTWF0ZXJpYWwsCiAgICAgICAgICAgICAgICBDb2xvciA9IG1vZGVsLlByaW1hcnlQYXJ0LkNvbG9yCiAgICAgICAgICAgIH0KICAgICAgICBlbmQKICAgIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gaWRlbnRpZnlfbW9kZWwobW9kZWwpCiAgICAgICAgaWYgbW9kZWwuQ2xhc3NOYW1lIH49ICJNb2RlbCIgdGhlbiByZXR1cm4gZmFsc2UsIGZhbHNlIGVuZAogICAgICAgIGlmIF9GaW5kRmlyc3RDaGlsZE9mQ2xhc3MobW9kZWwsICJNZXNoUGFydCIpIGFuZCBfRmluZEZpcnN0Q2hpbGRPZkNsYXNzKG1vZGVsLCAiTWVzaFBhcnQiKS5NZXNoSWQgPT0gInJieGFzc2V0aWQ6Ly8xMjkzOTAzNjA1NiIgdGhlbgogICAgICAgICAgICBpZiAjbW9kZWw6R2V0Q2hpbGRyZW4oKSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAiU3RvbmUiLCBtb2RlbDpHZXRDaGlsZHJlbigpWzFdCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZvciBfLCBwYXJ0IGluIG1vZGVsOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBwYXJ0LkNvbG9yID09IENvbG9yMy5mcm9tUkdCKDI0OCwgMjQ4LCAyNDgpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJOaXRyYXRlIiwgcGFydAogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBwYXJ0LkNvbG9yID09IENvbG9yMy5mcm9tUkdCKDE5OSwgMTcyLCAxMjApIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJJcm9uIiwgcGFydAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGlmIG5vdCBtb2RlbC5QcmltYXJ5UGFydCB0aGVuIHJldHVybiBlbmQKICAgICAgICBsb2NhbCBwcmltcGFydCA9IG1vZGVsLlByaW1hcnlQYXJ0CiAgICAgICAgZm9yIG5hbWUsIGVudGl0eSBpbiBlbnR0aXlpZGVudGlmaWNhdGlvbiBkbwogICAgICAgICAgICBpZiBlbnRpdHkuQ29sb3IgPT0gcHJpbXBhcnQuQ29sb3IgYW5kIGVudGl0eS5NYXRlcmlhbCA9PSBwcmltcGFydC5NYXRlcmlhbCBhbmQgZW50aXR5LkNvbGxpc2lvbkdyb3VwID09IHByaW1wYXJ0LkNvbGxpc2lvbkdyb3VwIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBuYW1lLCBwcmltcGFydAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gZmFsc2UsIGZhbHNlCiAgICBlbmQKCiAgICAtLSBNQUlOTgogICAgbG9jYWwgZnVuY3Rpb24gY3JlYXRlX2VzcChtb2RlbCkKICAgICAgICBpZiBtb2RlbCBhbmQgX0ZpbmRGaXJzdENoaWxkKG1vZGVsLCAiSGVhZCIpIGFuZCBfRmluZEZpcnN0Q2hpbGQobW9kZWwsICJMb3dlclRvcnNvIikgdGhlbgogICAgICAgICAgICBsb2NhbCBlbnRpdHk7CiAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgZm9yIF8sIGVudCBpbiBnZXR1cHZhbHVlKGdhcmJhZ2UuZW50aXR5bGlzdCwgMSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiByYXdnZXQoZW50LCAibW9kZWwiKSA9PSBtb2RlbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eSA9IGVudAogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBub3QgZW50aXR5IHRoZW4gdGFzay53YWl0KC4xKSBlbmQKICAgICAgICAgICAgdW50aWwgZW50aXR5CiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBlbnRpdHlfdHlwZSA9IHJhd2dldChlbnRpdHksICJ0eXBlIikKICAgICAgICAgICAgbG9jYWwgZW50aXR5X2lkID0gcmF3Z2V0KGVudGl0eSwgImlkIikKCiAgICAgICAgICAgIGxvY2FsIHNldHRpbmdzID0gZXNwX3RhYmxlLnNldHRpbmdzLmVuZW15CiAgICAgICAgICAgIGxvYWRlZF9wbHJzW21vZGVsXSA9IHsKICAgICAgICAgICAgICAgIG9iaiA9IHsKICAgICAgICAgICAgICAgICAgICBib3hfZmlsbCA9IGVzcC5jcmVhdGVfb2JqKCJTcXVhcmUiLCB7IEZpbGxlZCA9IHRydWUsIFZpc2libGUgPSBmYWxzZSB9KSwKICAgICAgICAgICAgICAgICAgICBib3hfb3V0bGluZSA9IGVzcC5jcmVhdGVfb2JqKCJTcXVhcmUiLCB7IEZpbGxlZCA9IGZhbHNlLCBUaGlja25lc3MgPSAzLCBWaXNpYmxlID0gZmFsc2UsIFpJbmRleCA9IC0xfSksCiAgICAgICAgICAgICAgICAgICAgYm94ID0gZXNwLmNyZWF0ZV9vYmooIlNxdWFyZSIsIHsgRmlsbGVkID0gZmFsc2UsIFRoaWNrbmVzcyA9IDEsIFZpc2libGUgPSBmYWxzZSB9KSwKICAgICAgICAgICAgICAgICAgICByZWFsbmFtZSA9IGVzcC5jcmVhdGVfb2JqKCJUZXh0IiwgeyBDZW50ZXIgPSB0cnVlLCBWaXNpYmxlID0gZmFsc2UgfSksCiAgICAgICAgICAgICAgICAgICAgZGlzdCA9IGVzcC5jcmVhdGVfb2JqKCJUZXh0IiwgeyBDZW50ZXIgPSB0cnVlLCBWaXNpYmxlID0gZmFsc2UgfSksCiAgICAgICAgICAgICAgICAgICAgd2VhcG9uID0gZXNwLmNyZWF0ZV9vYmooIlRleHQiLCB7IENlbnRlciA9IHRydWUsIFZpc2libGUgPSBmYWxzZSB9KSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlc3AgPSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudF9ndW4gPSAiIiwKICAgICAgICAgICAgICAgICAgICBjb3JuZXJzID0gbmlsLAogICAgICAgICAgICAgICAgICAgIGhlYWQgPSBuaWwsCiAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyID0gbmlsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2hhbXNfb2JqZWN0ID0gSW5zdGFuY2UubmV3KCJIaWdobGlnaHQiLCBjb250YWluZXIpLAogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciByZXF1aXJlZCwgXyBpbiBuZXh0LCBza2VsZXRvbl9vcmRlciBkbwogICAgICAgICAgICAgICAgbG9hZGVkX3BscnNbbW9kZWxdLm9ialsic2tlbGV0b25fIiAuLiByZXF1aXJlZF0gPSBlc3AuY3JlYXRlX29iaigiTGluZSIsIHsgVmlzaWJsZSA9IGZhbHNlIH0pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gbW9kZWwKICAgICAgICAgICAgbG9jYWwgaGVhZCA9IF9GaW5kRmlyc3RDaGlsZChjaGFyYWN0ZXIsICJIZWFkIikKICAgICAgICAgICAgbG9jYWwgbG93ZXJ0b3JzbyA9IF9GaW5kRmlyc3RDaGlsZChjaGFyYWN0ZXIsICJMb3dlclRvcnNvIikKCgogICAgICAgICAgICBsb2NhbCBwbHIgPSBsb2FkZWRfcGxyc1ttb2RlbF0KICAgICAgICAgICAgbG9jYWwgb2JqID0gcGxyLm9iagoKICAgICAgICAgICAgbG9jYWwgY2hhbSA9IHBsci5jaGFtc19vYmplY3QKICAgICAgICAgICAgbG9jYWwgYm94ID0gb2JqLmJveAogICAgICAgICAgICBsb2NhbCBib3hfb3V0bGluZSA9IG9iai5ib3hfb3V0bGluZQogICAgICAgICAgICBsb2NhbCBib3hfZmlsbCA9IG9iai5ib3hfZmlsbAogICAgICAgICAgICBsb2NhbCByZWFsbmFtZSA9IG9iai5yZWFsbmFtZQogICAgICAgICAgICBsb2NhbCBkaXN0ID0gb2JqLmRpc3QKICAgICAgICAgICAgbG9jYWwgd2VhcG9uID0gb2JqLndlYXBvbgoKICAgICAgICAgICAgbG9jYWwgbWFpbl9zZXR0aW5ncyA9IGVzcF90YWJsZS5tYWluX3NldHRpbmdzCiAgICAgICAgICAgIGxvY2FsIHNldHRpbmdzID0gZXNwX3RhYmxlLnNldHRpbmdzLmVuZW15CgogICAgICAgICAgICBsb2NhbCBzZXR2aXNfY2FjaGUgPSBmYWxzZQoKICAgICAgICAgICAgZnVuY3Rpb24gcGxyOmZvcmNldXBkYXRlKCkKICAgICAgICAgICAgICAgIGNoYW0uRGVwdGhNb2RlID0gc2V0dGluZ3MuY2hhbXNfdmlzaWJsZV9vbmx5IGFuZCBFbnVtLkhpZ2hsaWdodERlcHRoTW9kZS5PY2NsdWRlZCBvciBub3Qgc2V0dGluZ3MuY2hhbXNfdmlzaWJsZV9vbmx5IGFuZCBFbnVtLkhpZ2hsaWdodERlcHRoTW9kZS5BbHdheXNPblRvcCAKICAgICAgICAgICAgICAgIGNoYW0uRmlsbENvbG9yID0gc2V0dGluZ3MuY2hhbXNfZmlsbF9jb2xvclsxXQogICAgICAgICAgICAgICAgY2hhbS5GaWxsVHJhbnNwYXJlbmN5ID0gc2V0dGluZ3MuY2hhbXNfZmlsbF9jb2xvclsyXQogICAgICAgICAgICAgICAgY2hhbS5PdXRsaW5lQ29sb3IgPSBzZXR0aW5ncy5jaGFtc291dGxpbmVfY29sb3JbMV0KICAgICAgICAgICAgICAgIGNoYW0uT3V0bGluZVRyYW5zcGFyZW5jeSA9IHNldHRpbmdzLmNoYW1zb3V0bGluZV9jb2xvclsyXQoKICAgICAgICAgICAgICAgIGJveC5UcmFuc3BhcmVuY3kgPSBzZXR0aW5ncy5ib3hfY29sb3JbMl0KICAgICAgICAgICAgICAgIGJveC5Db2xvciA9IHNldHRpbmdzLmJveF9jb2xvclsxXQogICAgICAgICAgICAgICAgYm94X291dGxpbmUuVHJhbnNwYXJlbmN5ID0gc2V0dGluZ3MuYm94X291dGxpbmVfY29sb3JbMl0KICAgICAgICAgICAgICAgIGJveF9vdXRsaW5lLkNvbG9yID0gc2V0dGluZ3MuYm94X291dGxpbmVfY29sb3JbMV0KICAgICAgICAgICAgICAgIGJveF9maWxsLkNvbG9yID0gc2V0dGluZ3MuYm94X2ZpbGxfY29sb3JbMV0KICAgICAgICAgICAgICAgIGJveF9maWxsLlRyYW5zcGFyZW5jeSA9IHNldHRpbmdzLmJveF9maWxsX2NvbG9yWzJdCgogICAgICAgICAgICAgICAgcmVhbG5hbWUuU2l6ZSA9IG1haW5fc2V0dGluZ3MudGV4dFNpemUKICAgICAgICAgICAgICAgIHJlYWxuYW1lLkZvbnQgPSBtYWluX3NldHRpbmdzLnRleHRGb250CiAgICAgICAgICAgICAgICByZWFsbmFtZS5Db2xvciA9IHNldHRpbmdzLnJlYWxuYW1lX2NvbG9yWzFdCiAgICAgICAgICAgICAgICByZWFsbmFtZS5PdXRsaW5lID0gc2V0dGluZ3MucmVhbG5hbWVfb3V0bGluZQogICAgICAgICAgICAgICAgcmVhbG5hbWUuT3V0bGluZUNvbG9yID0gc2V0dGluZ3MucmVhbG5hbWVfb3V0bGluZV9jb2xvcgogICAgICAgICAgICAgICAgcmVhbG5hbWUuVHJhbnNwYXJlbmN5ID0gc2V0dGluZ3MucmVhbG5hbWVfY29sb3JbMl0KCiAgICAgICAgICAgICAgICBkaXN0LlNpemUgPSBtYWluX3NldHRpbmdzLnRleHRTaXplCiAgICAgICAgICAgICAgICBkaXN0LkZvbnQgPSBtYWluX3NldHRpbmdzLnRleHRGb250CiAgICAgICAgICAgICAgICBkaXN0LkNvbG9yID0gc2V0dGluZ3MuZGlzdF9jb2xvclsxXQogICAgICAgICAgICAgICAgZGlzdC5PdXRsaW5lID0gc2V0dGluZ3MuZGlzdF9vdXRsaW5lCiAgICAgICAgICAgICAgICBkaXN0Lk91dGxpbmVDb2xvciA9IHNldHRpbmdzLmRpc3Rfb3V0bGluZV9jb2xvcgogICAgICAgICAgICAgICAgZGlzdC5UcmFuc3BhcmVuY3kgPSBzZXR0aW5ncy5kaXN0X2NvbG9yWzJdCgogICAgICAgICAgICAgICAgd2VhcG9uLlNpemUgPSBtYWluX3NldHRpbmdzLnRleHRTaXplCiAgICAgICAgICAgICAgICB3ZWFwb24uRm9udCA9IG1haW5fc2V0dGluZ3MudGV4dEZvbnQKICAgICAgICAgICAgICAgIHdlYXBvbi5Db2xvciA9IHNldHRpbmdzLndlYXBvbl9jb2xvclsxXQogICAgICAgICAgICAgICAgd2VhcG9uLk91dGxpbmUgPSBzZXR0aW5ncy53ZWFwb25fb3V0bGluZQogICAgICAgICAgICAgICAgd2VhcG9uLk91dGxpbmVDb2xvciA9IHNldHRpbmdzLndlYXBvbl9vdXRsaW5lX2NvbG9yCiAgICAgICAgICAgICAgICB3ZWFwb24uVHJhbnNwYXJlbmN5ID0gc2V0dGluZ3Mud2VhcG9uX2NvbG9yWzJdCgogICAgICAgICAgICAgICAgZm9yIHJlcXVpcmVkLCBfIGluIG5leHQsIHNrZWxldG9uX29yZGVyIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2tlbGV0b25vYmogPSBvYmpbInNrZWxldG9uXyIgLi4gcmVxdWlyZWRdCiAgICAgICAgICAgICAgICAgICAgaWYgKHNrZWxldG9ub2JqKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNrZWxldG9ub2JqLkNvbG9yID0gc2V0dGluZ3Muc2tlbGV0b25fY29sb3JbMV0KICAgICAgICAgICAgICAgICAgICAgICAgc2tlbGV0b25vYmouVHJhbnNwYXJlbmN5ID0gc2V0dGluZ3Muc2tlbGV0b25fY29sb3JbMl0KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIHNldHZpc19jYWNoZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgY2hhbS5FbmFibGVkID0gc2V0dGluZ3MuY2hhbXMKICAgICAgICAgICAgICAgICAgICBib3guVmlzaWJsZSA9IHNldHRpbmdzLmJveAogICAgICAgICAgICAgICAgICAgIGJveF9vdXRsaW5lLlZpc2libGUgPSBzZXR0aW5ncy5ib3hfb3V0bGluZQogICAgICAgICAgICAgICAgICAgIGJveF9maWxsLlZpc2libGUgPSBzZXR0aW5ncy5ib3hfZmlsbAogICAgICAgICAgICAgICAgICAgIHJlYWxuYW1lLlZpc2libGUgPSBzZXR0aW5ncy5yZWFsbmFtZQogICAgICAgICAgICAgICAgICAgIGRpc3QuVmlzaWJsZSA9IHNldHRpbmdzLmRpc3QKICAgICAgICAgICAgICAgICAgICB3ZWFwb24uVmlzaWJsZSA9IHNldHRpbmdzLndlYXBvbgogICAgICAgICAgICAgICAgICAgIGZvciByZXF1aXJlZCwgXyBpbiBuZXh0LCBza2VsZXRvbl9vcmRlciBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBza2VsZXRvbm9iaiA9IG9ialsic2tlbGV0b25fIiAuLiByZXF1aXJlZF0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNrZWxldG9ub2JqKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2VsZXRvbm9iai5WaXNpYmxlID0gc2V0dGluZ3Muc2tlbGV0b24KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBwbHI6dG9nZ2xldmlzKGJvb2wpCiAgICAgICAgICAgICAgICBpZiBzZXR2aXNfY2FjaGUgfj0gYm9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2V0dmlzX2NhY2hlID0gYm9vbAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBib29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gb2JqIGRvIHYuVmlzaWJsZSA9IGZhbHNlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBjaGFtLkVuYWJsZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbS5FbmFibGVkID0gc2V0dGluZ3MuY2hhbXMKICAgICAgICAgICAgICAgICAgICAgICAgYm94LlZpc2libGUgPSBzZXR0aW5ncy5ib3gKICAgICAgICAgICAgICAgICAgICAgICAgYm94X291dGxpbmUuVmlzaWJsZSA9IHNldHRpbmdzLmJveF9vdXRsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgIGJveF9maWxsLlZpc2libGUgPSBzZXR0aW5ncy5ib3hfZmlsbAogICAgICAgICAgICAgICAgICAgICAgICByZWFsbmFtZS5WaXNpYmxlID0gc2V0dGluZ3MucmVhbG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgZGlzdC5WaXNpYmxlID0gc2V0dGluZ3MuZGlzdAogICAgICAgICAgICAgICAgICAgICAgICB3ZWFwb24uVmlzaWJsZSA9IHNldHRpbmdzLndlYXBvbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgcmVxdWlyZWQsIF8gaW4gbmV4dCwgc2tlbGV0b25fb3JkZXIgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHNrZWxldG9ub2JqID0gb2JqWyJza2VsZXRvbl8iIC4uIHJlcXVpcmVkXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNrZWxldG9ub2JqKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tlbGV0b25vYmouVmlzaWJsZSA9IHNldHRpbmdzLnNrZWxldG9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBwbHIuY29ubmVjdGlvbiA9IGNoZWF0LnV0aWxpdHkubmV3X3JlbmRlcnN0ZXBwZWQoZnVuY3Rpb24oZGVsdGEpCiAgICAgICAgICAgICAgICBpZiBub3QgKAogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmVuYWJsZWQgYW5kCiAgICAgICAgICAgICAgICAgICAgaGVhZCBhbmQKICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIgYW5kCiAgICAgICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgICAgICBtYWluX3NldHRpbmdzLnNsZWVwY2hlY2sgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdCByYXdnZXQoZW50aXR5LCAic2xlZXBpbmciKSBvcgogICAgICAgICAgICAgICAgICAgICAgICBub3QgbWFpbl9zZXR0aW5ncy5zbGVlcGNoZWNrCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBscjp0b2dnbGV2aXMoZmFsc2UpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGxvY2FsIF8sIG9uU2NyZWVuID0gd29ybGRUb1NjcmVlbihoZWFkLlBvc2l0aW9uKQogICAgICAgICAgICAgICAgaWYgbm90IG9uU2NyZWVuIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxyOnRvZ2dsZXZpcyhmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKGNhbWVyYS5DRnJhbWUucCAtIGhlYWQuUG9zaXRpb24pLk1hZ25pdHVkZQoKICAgICAgICAgICAgICAgIGxvY2FsIGNvcm5lcnMgaWYgbWFpbl9zZXR0aW5ncy5zaW1wbGVjYWxjIHRoZW4KICAgICAgICAgICAgICAgICAgICBjb3JuZXJzID0gY2FsY3VsYXRlQ29ybmVyc1NpbXBsZShoZWFkLCBsb3dlcnRvcnNvKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGNhY2hlID0ge30KICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGlsZHJlbiA9IGNoYXJhY3RlcjpHZXRDaGlsZHJlbigpCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLCAjY2hpbGRyZW4gZG8KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGFydCA9IGNoaWxkcmVuW2ldCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9Jc0EocGFydCwgIkJhc2VQYXJ0IikgYW5kIGlzQm9keVBhcnQocGFydC5OYW1lKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZVsjY2FjaGUgKyAxXSA9IHBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgY29ybmVycyA9IGNhbGN1bGF0ZUNvcm5lcnMoZ2V0Qm91bmRpbmdCb3goY2FjaGUpKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgbm90IGNvcm5lcnMgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbHI6dG9nZ2xldmlzKGZhbHNlKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcGxyOnRvZ2dsZXZpcyh0cnVlKQoKICAgICAgICAgICAgICAgIGNoYW0uQWRvcm5lZSA9IGNoYXJhY3RlcgogICAgICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwb3MgPSBjb3JuZXJzLnRvcExlZnQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBzaXplID0gY29ybmVycy5ib3R0b21SaWdodCAtIGNvcm5lcnMudG9wTGVmdAogICAgICAgICAgICAgICAgICAgIGJveC5Qb3NpdGlvbiA9IHBvcwogICAgICAgICAgICAgICAgICAgIGJveC5TaXplID0gc2l6ZQogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5EcmF3aW5nRml4IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYm94X291dGxpbmUuUG9zaXRpb24gPSBwb3MgLSBfVmVjdG9yMm5ldygxLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBib3hfb3V0bGluZS5TaXplID0gc2l6ZSArIF9WZWN0b3IybmV3KDIsIDIpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBib3hfb3V0bGluZS5Qb3NpdGlvbiA9IHBvcwogICAgICAgICAgICAgICAgICAgICAgICBib3hfb3V0bGluZS5TaXplID0gc2l6ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGJveF9maWxsLlBvc2l0aW9uID0gcG9zCiAgICAgICAgICAgICAgICAgICAgYm94X2ZpbGwuU2l6ZSA9IHNpemUKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW50aXR5X25hbWUgPSByYXdnZXQoZW50aXR5LCAiTmFtZSIpCiAgICAgICAgICAgICAgICAgICAgcmVhbG5hbWUuVGV4dCA9IHBsYXllcl9tZW1vcnlbZW50aXR5X2lkXSBvciBlbnRpdHlfbmFtZSBvciBlbnRpdHlfdHlwZQogICAgICAgICAgICAgICAgICAgIGlmIGVudGl0eV90eXBlID09ICJQbGF5ZXIiIGFuZCBlbnRpdHlfbmFtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9tZW1vcnlbZW50aXR5X2lkXSA9IGVudGl0eV9uYW1lCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgcmVhbG5hbWUuUG9zaXRpb24gPSAoY29ybmVycy50b3BMZWZ0ICsgY29ybmVycy50b3BSaWdodCkgKiAwLjUgLQogICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IyLnlBeGlzICogcmVhbG5hbWUuVGV4dEJvdW5kcy5ZIC0gX1ZlY3RvcjJuZXcoMCwgMikKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYm90dG9tID0gKGNvcm5lcnMuYm90dG9tTGVmdCArIGNvcm5lcnMuYm90dG9tUmlnaHQpICogMC41CiAgICAgICAgICAgICAgICAgICAgZGlzdC5UZXh0ID0gdG9zdHJpbmcobWF0aHJvdW5kKGRpc3RhbmNlKSkgLi4gIiBzdHVkcyIKICAgICAgICAgICAgICAgICAgICBkaXN0LlBvc2l0aW9uID0gYm90dG9tCiAgICAgICAgICAgICAgICAgICAgd2VhcG9uLlRleHQgPSBnZXRjdXJyZW50d2VhcG9uKGVudGl0eSkKICAgICAgICAgICAgICAgICAgICB3ZWFwb24uUG9zaXRpb24gPSBib3R0b20gKyAoZGlzdC5WaXNpYmxlIGFuZCBWZWN0b3IyLnlBeGlzICogZGlzdC5UZXh0Qm91bmRzLlkgLSBfVmVjdG9yMm5ldygwLCAyKSBvciBWZWN0b3IyLnplcm8pCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBzZXR0aW5ncy5za2VsZXRvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHBhcnQgaW4gbmV4dCwgY2hhcmFjdGVyOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGFydF9uYW1lID0gcGFydC5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHNrZWxldG9ub2JqID0gb2JqWyJza2VsZXRvbl8iIC4uIHBhcnRfbmFtZV0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGFyZW50X3BhcnQgPSBza2VsZXRvbl9vcmRlcltwYXJ0X25hbWVdIGFuZCBfRmluZEZpcnN0Q2hpbGQoY2hhcmFjdGVyLCBza2VsZXRvbl9vcmRlcltwYXJ0X25hbWVdKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBza2VsZXRvbm9iaiBhbmQgcGFyZW50X3BhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGFydF9wb3NpdGlvbiwgXyA9IF9Xb3JsZFRvVmlld3BvcnRQb2ludChjYW1lcmEsIHBhcnQuUG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwYXJlbnRfcGFydF9wb3NpdGlvbiwgXyA9IF9Xb3JsZFRvVmlld3BvcnRQb2ludCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEsIHBhcmVudF9wYXJ0LkNGcmFtZS5wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2VsZXRvbm9iai5Gcm9tID0gX1ZlY3RvcjJuZXcocGFydF9wb3NpdGlvbi5YLCBwYXJ0X3Bvc2l0aW9uLlkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2VsZXRvbm9iai5UbyA9IF9WZWN0b3IybmV3KHBhcmVudF9wYXJ0X3Bvc2l0aW9uLlgsIHBhcmVudF9wYXJ0X3Bvc2l0aW9uLlkpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHBscjpmb3JjZXVwZGF0ZSgpCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbCBlc3BuYW1lLCBtYWlucGFydCA9IGlkZW50aWZ5X21vZGVsKG1vZGVsKQogICAgICAgICAgICBpZiBub3QgKGVzcG5hbWUgYW5kIG1haW5wYXJ0KSB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgbG9hZGVkX3BscnNbbW9kZWxdID0gewogICAgICAgICAgICAgICAgb2JqID0gewogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBlc3AuY3JlYXRlX29iaigiVGV4dCIsIHsgQ2VudGVyID0gdHJ1ZSwgVmlzaWJsZSA9IGZhbHNlLCBUZXh0ID0gZXNwbmFtZSB9KSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBsb2NhbCBwbHIgPSBsb2FkZWRfcGxyc1ttb2RlbF0KICAgICAgICAgICAgbG9jYWwgb2JqID0gcGxyLm9iagoKICAgICAgICAgICAgbG9jYWwgcmVhbG5hbWUgPSBvYmoubmFtZQoKICAgICAgICAgICAgbG9jYWwgbWFpbl9zZXR0aW5ncyA9IGVzcF90YWJsZS5tYWluX29iamVjdF9zZXR0aW5ncwogICAgICAgICAgICBsb2NhbCBzZXR0aW5ncyA9IGVzcF90YWJsZS5zZXR0aW5ncy5vYmplY3QKICAgICAgICAgICAgbG9jYWwgYWxsb3dlZG9ianMgPSBtYWluX3NldHRpbmdzLmFsbG93ZWQKCiAgICAgICAgICAgIGxvY2FsIHNldHZpc19jYWNoZSA9IGZhbHNlCgogICAgICAgICAgICBmdW5jdGlvbiBwbHI6Zm9yY2V1cGRhdGUoKQogICAgICAgICAgICAgICAgcmVhbG5hbWUuU2l6ZSA9IG1haW5fc2V0dGluZ3MudGV4dFNpemUKICAgICAgICAgICAgICAgIHJlYWxuYW1lLkZvbnQgPSBtYWluX3NldHRpbmdzLnRleHRGb250CiAgICAgICAgICAgICAgICByZWFsbmFtZS5Db2xvciA9IHNldHRpbmdzLnJlYWxuYW1lX2NvbG9yWzFdCiAgICAgICAgICAgICAgICByZWFsbmFtZS5PdXRsaW5lID0gc2V0dGluZ3MucmVhbG5hbWVfb3V0bGluZQogICAgICAgICAgICAgICAgcmVhbG5hbWUuT3V0bGluZUNvbG9yID0gc2V0dGluZ3MucmVhbG5hbWVfb3V0bGluZV9jb2xvcgogICAgICAgICAgICAgICAgcmVhbG5hbWUuVHJhbnNwYXJlbmN5ID0gc2V0dGluZ3MucmVhbG5hbWVfY29sb3JbMl0KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBwbHI6dG9nZ2xldmlzKGJvb2wpCiAgICAgICAgICAgICAgICBpZiBzZXR2aXNfY2FjaGUgfj0gYm9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gb2JqIGRvIHYuVmlzaWJsZSA9IGJvb2wgZW5kCiAgICAgICAgICAgICAgICAgICAgc2V0dmlzX2NhY2hlID0gYm9vbAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcGxyLmNvbm5lY3Rpb24gPSBjaGVhdC51dGlsaXR5Lm5ld19oZWFydGJlYXQoZnVuY3Rpb24oZGVsdGEpCiAgICAgICAgICAgICAgICBsb2NhbCBwbHIgPSBsb2FkZWRfcGxyc1ttb2RlbF0KICAgICAgICAgICAgICAgIGlmIG5vdCAoc2V0dGluZ3MuZW5hYmxlZCBhbmQgbWFpbnBhcnQgYW5kIChzZXR0aW5ncy5hbGxlbmFibGVkIG9yIGFsbG93ZWRvYmpzW2VzcG5hbWVdKSkgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbHI6dG9nZ2xldmlzKGZhbHNlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBsb2NhbCBwb3NpdGlvbiwgb25zY3JlZW4gPSB3b3JsZFRvU2NyZWVuKG1haW5wYXJ0LlBvc2l0aW9uKQogICAgICAgICAgICAgICAgaWYgbm90IG9uc2NyZWVuIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxyOnRvZ2dsZXZpcyhmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcGxyOnRvZ2dsZXZpcyh0cnVlKQogICAgICAgICAgICAgICAgcmVhbG5hbWUuUG9zaXRpb24gPSBwb3NpdGlvbgogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBwbHI6Zm9yY2V1cGRhdGUoKQogICAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBmdW5jdGlvbiBkZXN0cm95X2VzcChtb2RlbCkKICAgICAgICBsb2NhbCBwbHJfb2JqZWN0ID0gbG9hZGVkX3BscnNbbW9kZWxdCiAgICAgICAgaWYgbm90IHBscl9vYmplY3QgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgcGxyX29iamVjdC5jb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIGZvciBpLCB2IGluIHBscl9vYmplY3Qub2JqIGRvCiAgICAgICAgICAgIHY6UmVtb3ZlKCkKICAgICAgICBlbmQKICAgICAgICBpZiBwbHJfb2JqZWN0LmNoYW1zX29iamVjdCB0aGVuCiAgICAgICAgICAgIHBscl9vYmplY3QuY2hhbXNfb2JqZWN0OkRlc3Ryb3koKQogICAgICAgIGVuZAogICAgICAgIGxvYWRlZF9wbHJzW21vZGVsXSA9IG5pbAogICAgZW5kCiAgICAKICAgIGZ1bmN0aW9uIGVzcF90YWJsZS5sb2FkKCkKICAgICAgICBhc3NlcnQobm90IGVzcF90YWJsZS5fX2xvYWRlZCwgIltFU1BdIGFscmVhZHkgbG9hZGVkIik7CiAgICAKICAgICAgICBmb3IgaSwgdiBpbiBuZXh0LCB3b3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgIGNyZWF0ZV9lc3AodikKICAgICAgICBlbmQKICAgIAogICAgICAgIGVzcF90YWJsZS5wbGF5ZXJBZGRlZCA9IHdvcmtzcGFjZS5DaGlsZEFkZGVkOkNvbm5lY3QoY3JlYXRlX2VzcCk7CiAgICAgICAgZXNwX3RhYmxlLnBsYXllclJlbW92aW5nID0gd29ya3NwYWNlLkNoaWxkUmVtb3ZlZDpDb25uZWN0KGRlc3Ryb3lfZXNwKTsKICAgICAgICBlc3BfdGFibGUuX19sb2FkZWQgPSB0cnVlOwogICAgZW5kCiAgICAKICAgIGZ1bmN0aW9uIGVzcF90YWJsZS51bmxvYWQoKQogICAgICAgIGFzc2VydChlc3BfdGFibGUuX19sb2FkZWQsICJbRVNQXSBub3QgbG9hZGVkIHlldCIpOwogICAgCiAgICAgICAgZm9yIGksIHYgaW4gbmV4dCwgd29ya3NwYWNlOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgZGVzdHJveV9lc3AodikKICAgICAgICBlbmQKICAgIAogICAgICAgIGVzcF90YWJsZS5wbGF5ZXJBZGRlZDpEaXNjb25uZWN0KCk7CiAgICAgICAgZXNwX3RhYmxlLnBsYXllclJlbW92aW5nOkRpc2Nvbm5lY3QoKTsKICAgICAgICBlc3BfdGFibGUuX19sb2FkZWQgPSBmYWxzZTsKICAgIGVuZAogICAgCiAgICBmdW5jdGlvbiBlc3BfdGFibGUuaWNhY2EoKQogICAgICAgIGZvciBfLCB2IGluIGxvYWRlZF9wbHJzIGRvCiAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKSB2OmZvcmNldXBkYXRlKCkgZW5kKQogICAgICAgIGVuZAogICAgZW5kCgogICAgY2hlYXQuRXNwTGlicmFyeSA9IGVzcF90YWJsZQplbmQpKCk7Cgpsb2NhbCB2aXNjaGVja19wYXJhbXMgPSBSYXljYXN0UGFyYW1zLm5ldygpCnZpc2NoZWNrX3BhcmFtcy5GaWx0ZXJEZXNjZW5kYW50c0luc3RhbmNlcyA9IHsgd29ya3NwYWNlLkNvbnN0Lklnbm9yZSB9CnZpc2NoZWNrX3BhcmFtcy5GaWx0ZXJUeXBlID0gRW51bS5SYXljYXN0RmlsdGVyVHlwZS5FeGNsdWRlCnZpc2NoZWNrX3BhcmFtcy5Db2xsaXNpb25Hcm91cCA9ICJXZWFwb25SYXljYXN0Igp2aXNjaGVja19wYXJhbXMuSWdub3JlV2F0ZXIgPSB0cnVlCgpsb2NhbCBmdW5jdGlvbiBpc192aXNpYmxlKHBvc2l0aW9uLCB0YXJnZXQsIHRhcmdldF9wYXJ0KQogICAgaWYgbm90ICh0YXJnZXQgYW5kIHRhcmdldF9wYXJ0IGFuZCBwb3NpdGlvbikgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICBsb2NhbCBjYXN0cmVzdWx0cyA9IF9SYXljYXN0KHdvcmtzcGFjZSwgcG9zaXRpb24sIHRhcmdldF9wYXJ0LkNGcmFtZS5wIC0gcG9zaXRpb24sIHZpc2NoZWNrX3BhcmFtcykKICAgIHJldHVybiBjYXN0cmVzdWx0cyBhbmQgY2FzdHJlc3VsdHMuSW5zdGFuY2UgYW5kIGNhc3RyZXN1bHRzLkluc3RhbmNlLlBhcmVudCA9PSB0YXJnZXQKZW5kCgpsb2NhbCBmdW5jdGlvbiBpc19wb3NpdGlvbl92aXNpYmxlKHBvc19mcm9tLCBwb3NfdG8pCiAgICBpZiBub3QgKHBvc190byBhbmQgcG9zX2Zyb20pIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgbG9jYWwgY2FzdHJlc3VsdHMgPSBfUmF5Y2FzdCh3b3Jrc3BhY2UsIHBvc19mcm9tLCBwb3NfdG8gLSBwb3NfZnJvbSwgdmlzY2hlY2tfcGFyYW1zKQogICAgcmV0dXJuIG5vdCBjYXN0cmVzdWx0cwplbmQKCgpsb2NhbCBmdW5jdGlvbiBwcmVkaWN0X2VudGl0eShwYXJ0LCBlbnRpdHksIHByb2plY3RpbGVfc3BlZWQsIHByb2plY3RpbGVfZHJvcCwgb3JpZ2luKQogICAgbG9jYWwgcGFydF9jZnJhbWUgPSBwYXJ0LkNGcmFtZQogICAgbG9jYWwgdmVsb2NpdHkgPSAocmF3Z2V0KGVudGl0eSwgImdvYWxQb3NpdGlvbiIpIC0gcmF3Z2V0KGVudGl0eSwgInN0YXJ0UG9zaXRpb24iKSkgLyAwLjE1ICogX1ZlY3RvcjNuZXcoMSwgMCwgMSkKICAgIGxvY2FsIGRpc3RhbmNlID0gKG9yaWdpbiAtIHBhcnRfY2ZyYW1lLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgIGxvY2FsIHRpbWVfdG9faGl0ID0gKGRpc3RhbmNlIC8gcHJvamVjdGlsZV9zcGVlZCkKICAgIGxvY2FsIHByZWRpY3RlZF9wb3NpdGlvbiA9IHBhcnRfY2ZyYW1lLlBvc2l0aW9uICsgKHZlbG9jaXR5ICogdGltZV90b19oaXQpCiAgICBsb2NhbCBkZWx0YSA9IChwcmVkaWN0ZWRfcG9zaXRpb24gLSBwYXJ0X2NmcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICB0aW1lX3RvX2hpdCA9IHRpbWVfdG9faGl0ICsgKGRlbHRhIC8gcHJvamVjdGlsZV9zcGVlZCkKICAgIHJldHVybiBwcmVkaWN0ZWRfcG9zaXRpb24gKyBWZWN0b3IzLnlBeGlzICogKHByb2plY3RpbGVfZHJvcCBeICh0aW1lX3RvX2hpdCAqIHByb2plY3RpbGVfZHJvcCkgLSAxKQplbmQKbG9jYWwgZnVuY3Rpb24gZ2V0X2FjdHVhbF9oaXRwb3MocHJvamVjdGlsZV9zcGVlZCwgcHJvamVjdGlsZV9kcm9wLCBvcmlnaW4sIHBvc2l0aW9uKQogICAgbG9jYWwgZGlzdGFuY2UgPSAob3JpZ2luIC0gcG9zaXRpb24pLk1hZ25pdHVkZQogICAgbG9jYWwgdGltZV90b19oaXQgPSAoZGlzdGFuY2UgLyBwcm9qZWN0aWxlX3NwZWVkKQogICAgbG9jYWwgZHJvcF9kaXN0YW5jZSA9IHByb2plY3RpbGVfZHJvcCBeICh0aW1lX3RvX2hpdCAqIHByb2plY3RpbGVfZHJvcCkgLSAxCiAgICBsb2NhbCBsb29rX3ZlY3RvciA9IENGcmFtZS5sb29rQXQob3JpZ2luLCBwb3NpdGlvbiArIFZlY3RvcjMueUF4aXMgKiBkcm9wX2Rpc3RhbmNlKQogICAgcmV0dXJuIGxvb2tfdmVjdG9yLCAobG9va192ZWN0b3IgKiBfQ0ZyYW1lbmV3KDAsIC1wcm9qZWN0aWxlX2Ryb3AgXiAodGltZV90b19oaXQgKiBwcm9qZWN0aWxlX2Ryb3ApICsgMSwgLXRpbWVfdG9faGl0ICogcHJvamVjdGlsZV9zcGVlZCkpLlBvc2l0aW9uCmVuZApsb2NhbCBmdW5jdGlvbiBwcmVkaWN0X2Ryb3BfcG9zaXRpb24ocG9zaXRpb24sIHByb2plY3RpbGVfc3BlZWQsIHByb2plY3RpbGVfZHJvcCwgb3JpZ2luKQogICAgbG9jYWwgb3JpZ2luID0gb3JpZ2luIG9yIENhbWVyYS5DRnJhbWUucAogICAgbG9jYWwgZGlzdGFuY2UgPSAob3JpZ2luIC0gcG9zaXRpb24pLk1hZ25pdHVkZQogICAgbG9jYWwgdGltZV90b19oaXQgPSAoZGlzdGFuY2UgLyBwcm9qZWN0aWxlX3NwZWVkKQogICAgbG9jYWwgZHJvcF90aW1pbmcgPSBwcm9qZWN0aWxlX2Ryb3AgXiAodGltZV90b19oaXQgKiBwcm9qZWN0aWxlX2Ryb3ApIC0gMQogICAgaWYgbm90IChkcm9wX3RpbWluZyB+PSBkcm9wX3RpbWluZykgdGhlbgogICAgICAgIHJldHVybiBkcm9wX3RpbWluZywgdGltZV90b19oaXQKICAgIGVuZAogICAgcmV0dXJuIDAKZW5kCgpsb2NhbCBmdW5jdGlvbiBnZXRfbWFuaXB1bGF0aW9uX3BvcyhvcmlnaW5fcG9zLCB0YXJnZXQsIHRhcmdldF9wYXJ0LCByYW5nZSwgZW5hYmxlZCkKICAgIGlmIG5vdCBvcmlnaW5fcG9zIHRoZW4gb3JpZ2luX3BvcyA9IENhbWVyYS5DRnJhbWUucCBlbmQKICAgIGlmIG5vdCBlbmFibGVkIHRoZW4KICAgICAgICBsb2NhbCB2aXNpYmxlID0gaXNfdmlzaWJsZShvcmlnaW5fcG9zLCB0YXJnZXQsIHRhcmdldF9wYXJ0KQogICAgICAgIGlmIHZpc2libGUgdGhlbgogICAgICAgICAgICByZXR1cm4gb3JpZ2luX3BvcwogICAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBmaW5hbCwgbWF4bWFnID0gbmlsLCBtYXRoLmh1Z2U7CiAgICBmb3IgXywgdmVjdG9yIGluIHZlY3RvcnMgZG8KICAgICAgICBsb2NhbCBjdXJ2ZWN0b3IgPSAodmVjdG9yICogcmFuZ2UpCiAgICAgICAgbG9jYWwgbW9kaWZpZWQgPSBvcmlnaW5fcG9zICsgY3VydmVjdG9yCiAgICAgICAgbG9jYWwgcG9zdmlzaWJsZSwgdmlzaWJsZSA9IGlzX3Bvc2l0aW9uX3Zpc2libGUob3JpZ2luX3BvcywgbW9kaWZpZWQpLCBpc192aXNpYmxlKG1vZGlmaWVkLCB0YXJnZXQsIHRhcmdldF9wYXJ0KQogICAgICAgIGlmIGN1cnZlY3Rvci5NYWduaXR1ZGUgPD0gbWF4bWFnIGFuZCBwb3N2aXNpYmxlIGFuZCB2aXNpYmxlIHRoZW4KICAgICAgICAgICAgZmluYWwgPSBtb2RpZmllZAogICAgICAgICAgICBtYXhtYWcgPSBjdXJ2ZWN0b3IuTWFnbml0dWRlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBmaW5hbAplbmQKCmxvY2FsIGZ1bmN0aW9uIGdldF9zaW11bGF0aW9uX3BvcyhvcmlnaW5fcG9zLCB0YXJnZXQsIHRhcmdldF9wYXJ0LCBzaW10YWJsZSwgcHJvamVjdGlsZV9zcGVlZCwgcHJvamVjdGlsZV9kcm9wKQogICAgbG9jYWwgZmluYWwsIG1heG1hZyA9IG5pbCwgbWF0aC5odWdlOwogICAgbG9jYWwgdGFyZ2V0cG9zID0gdGFyZ2V0X3BhcnQuUG9zaXRpb24KICAgIGZvciBfLCB2ZWN0b3IgaW4gc2ltdGFibGUgZG8KICAgICAgICBsb2NhbCBtb2RpZmllZCA9IHRhcmdldHBvcyArIHZlY3RvcgogICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKG9yaWdpbl9wb3MgLSBtb2RpZmllZCkuTWFnbml0dWRlCiAgICAgICAgbG9jYWwgdmlzaWJsZSA9IGlzX3Zpc2libGUobW9kaWZpZWQsIHRhcmdldCwgdGFyZ2V0X3BhcnQpCiAgICAgICAgaWYgdmlzaWJsZSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBvc3Zpc2libGUgPSBpc19wb3NpdGlvbl92aXNpYmxlKG9yaWdpbl9wb3MsIG1vZGlmaWVkKQogICAgICAgICAgICBpZiBwb3N2aXNpYmxlIGFuZCBkaXN0YW5jZSA8PSBtYXhtYWcgdGhlbgogICAgICAgICAgICAgICAgZmluYWwgPSBtb2RpZmllZAogICAgICAgICAgICAgICAgbWF4bWFnID0gZGlzdGFuY2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBmaW5hbAplbmQKCmxvY2FsIGZ1bmN0aW9uIGdldF9jbG9zZXN0X3RhcmdldCh1c2Vmb3YsIGZvdl9zaXplLCBhaW1wYXJ0LCBzbGVlcCwgdGVhbSkKICAgIGxvY2FsIHBhcnQsIGVudGl0eSA9IG5pbCwgbmlsCiAgICBsb2NhbCBtYXhpbXVtX2Rpc3RhbmNlID0gdXNlZm92IGFuZCBmb3Zfc2l6ZSBvciBtYXRoLmh1Z2UKICAgIGxvY2FsIG1vdXNlcG9zID0gX1ZlY3RvcjJuZXcoTW91c2UuWCwgTW91c2UuWSkKICAgIGxvY2FsIHZhbGlkX3R5cGVzID0gdHJpZGVudC52YWxpZF90eXBlcwogICAgTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgIGZvciBfLCB0YmwgaW4gZ2V0dXB2YWx1ZShnYXJiYWdlLmVudGl0eWxpc3QsIDEpIGRvCiAgICAgICAgICAgIGxvY2FsIG1vZGVsID0gcmF3Z2V0KHRibCwgIm1vZGVsIikKICAgICAgICAgICAgbG9jYWwgZW50dHlwZSA9IHJhd2dldCh0YmwsICJ0eXBlIikKICAgICAgICAgICAgbG9jYWwgc2xlZXBpbmcgPSByYXdnZXQodGJsLCAic2xlZXBpbmciKQogICAgICAgICAgICBsb2NhbCBoaXRwYXJ0ID0gbW9kZWwgYW5kIF9GaW5kRmlyc3RDaGlsZChtb2RlbCwgYWltcGFydCkKICAgICAgICAgICAgaWYgKGhpdHBhcnQgYW5kIHZhbGlkX3R5cGVzW2VudHR5cGVdKSBhbmQgKHNsZWVwIGFuZCBub3Qgc2xlZXBpbmcgb3Igbm90IHNsZWVwKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwb3NpdGlvbiwgb25zY3JlZW4gPSBfV29ybGRUb1ZpZXdwb3J0UG9pbnQoQ2FtZXJhLCBoaXRwYXJ0LlBvc2l0aW9uKQogICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAoX1ZlY3RvcjJuZXcocG9zaXRpb24uWCwgcG9zaXRpb24uWSAtIEd1aUluc2V0LlkpIC0gbW91c2Vwb3MpLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgaWYgKHVzZWZvdiBhbmQgb25zY3JlZW4gb3Igbm90IHVzZWZvdikgYW5kIGRpc3RhbmNlIDwgbWF4aW11bV9kaXN0YW5jZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGFydCA9IGhpdHBhcnQKICAgICAgICAgICAgICAgICAgICBlbnRpdHkgPSB0YmwKICAgICAgICAgICAgICAgICAgICBtYXhpbXVtX2Rpc3RhbmNlID0gZGlzdGFuY2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkoKQogICAgcmV0dXJuIHBhcnQsIGVudGl0eQplbmQKbG9jYWwgZnVuY3Rpb24gbWFrZV9iZWFtKE9yaWdpbiwgUG9zaXRpb24sIENvbG9yKQogICAgbG9jYWwgcGFydDEsIHBhcnQyID0gSW5zdGFuY2UubmV3KCJQYXJ0Iiwgd29ya3NwYWNlLkNvbnN0Lklnbm9yZSksIEluc3RhbmNlLm5ldygiUGFydCIsIHdvcmtzcGFjZS5Db25zdC5JZ25vcmUpCiAgICBwYXJ0MS5Qb3NpdGlvbiA9IE9yaWdpbjsgcGFydDIuUG9zaXRpb24gPSBQb3NpdGlvbjsKICAgIHBhcnQxLlRyYW5zcGFyZW5jeSA9IDE7IHBhcnQyLlRyYW5zcGFyZW5jeSA9IDE7CiAgICBwYXJ0MS5DYW5Db2xsaWRlID0gZmFsc2U7IHBhcnQyLkNhbkNvbGxpZGUgPSBmYWxzZTsKICAgIHBhcnQxLlNpemUgPSBWZWN0b3IzLnplcm87IHBhcnQyLlNpemUgPSBWZWN0b3IzLnplcm87CiAgICBwYXJ0MS5BbmNob3JlZCA9IHRydWU7IHBhcnQyLkFuY2hvcmVkID0gdHJ1ZTsKICAgIGxvY2FsIE9yaWdpbkF0dGFjaG1lbnQgPSBJbnN0YW5jZS5uZXcoIkF0dGFjaG1lbnQiLCBwYXJ0MSkKICAgIGxvY2FsIFBvc2l0aW9uQXR0YWNobWVudCA9IEluc3RhbmNlLm5ldygiQXR0YWNobWVudCIsIHBhcnQyKQogICAgbG9jYWwgQmVhbSA9IEluc3RhbmNlLm5ldygiQmVhbSIsIHdvcmtzcGFjZS5Db25zdC5JZ25vcmUpCiAgICBCZWFtLk5hbWUgPSAiQmVhbSIKICAgIEJlYW0uQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ld3sKICAgICAgICBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsQ29sb3IpLAogICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSxDb2xvcikKICAgIH07CiAgICBCZWFtLkxpZ2h0RW1pc3Npb24gPSAxCiAgICBCZWFtLkxpZ2h0SW5mbHVlbmNlID0gMQogICAgQmVhbS5UZXh0dXJlTW9kZSA9IEVudW0uVGV4dHVyZU1vZGUuU3RhdGljCiAgICBCZWFtLlRleHR1cmVTcGVlZCA9IDAKICAgIEJlYW0uVHJhbnNwYXJlbmN5ID0gTnVtYmVyU2VxdWVuY2UubmV3KDApCiAgICBCZWFtLkF0dGFjaG1lbnQwID0gT3JpZ2luQXR0YWNobWVudAogICAgQmVhbS5BdHRhY2htZW50MSA9IFBvc2l0aW9uQXR0YWNobWVudAogICAgQmVhbS5GYWNlQ2FtZXJhID0gdHJ1ZQogICAgQmVhbS5TZWdtZW50cyA9IDEKICAgIEJlYW0uV2lkdGgwID0gMC4xCiAgICBCZWFtLldpZHRoMSA9IDAuMQogICAgcmV0dXJuIEJlYW0sIHBhcnQxLCBwYXJ0MgplbmQKbG9jYWwgZnVuY3Rpb24gbWFrZV9iZWFtX2RyYXdpbmcoT3JpZ2luLCBQb3NpdGlvbiwgQ29sb3IpCiAgICBsb2NhbCBwYXJ0MSwgcGFydDIgPSBJbnN0YW5jZS5uZXcoIlBhcnQiLCB3b3Jrc3BhY2UuQ29uc3QuSWdub3JlKSwgSW5zdGFuY2UubmV3KCJQYXJ0Iiwgd29ya3NwYWNlLkNvbnN0Lklnbm9yZSkKICAgIHBhcnQxLlBvc2l0aW9uID0gT3JpZ2luOyBwYXJ0Mi5Qb3NpdGlvbiA9IFBvc2l0aW9uOwogICAgcGFydDEuVHJhbnNwYXJlbmN5ID0gMTsgcGFydDIuVHJhbnNwYXJlbmN5ID0gMTsKICAgIHBhcnQxLkNhbkNvbGxpZGUgPSBmYWxzZTsgcGFydDIuQ2FuQ29sbGlkZSA9IGZhbHNlOwogICAgcGFydDEuU2l6ZSA9IFZlY3RvcjMuemVybzsgcGFydDIuU2l6ZSA9IFZlY3RvcjMuemVybzsKICAgIHBhcnQxLkFuY2hvcmVkID0gdHJ1ZTsgcGFydDIuQW5jaG9yZWQgPSB0cnVlOwogICAgbG9jYWwgT3JpZ2luQXR0YWNobWVudCA9IEluc3RhbmNlLm5ldygiQXR0YWNobWVudCIsIHBhcnQxKQogICAgbG9jYWwgUG9zaXRpb25BdHRhY2htZW50ID0gSW5zdGFuY2UubmV3KCJBdHRhY2htZW50IiwgcGFydDIpCiAgICBsb2NhbCBCZWFtID0gSW5zdGFuY2UubmV3KCJCZWFtIiwgd29ya3NwYWNlLkNvbnN0Lklnbm9yZSkKICAgIEJlYW0uTmFtZSA9ICJCZWFtIgogICAgQmVhbS5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3ewogICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMCxDb2xvciksCiAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLENvbG9yKQogICAgfTsKICAgIEJlYW0uTGlnaHRFbWlzc2lvbiA9IDEKICAgIEJlYW0uTGlnaHRJbmZsdWVuY2UgPSAxCiAgICBCZWFtLlRleHR1cmVNb2RlID0gRW51bS5UZXh0dXJlTW9kZS5TdGF0aWMKICAgIEJlYW0uVGV4dHVyZVNwZWVkID0gMAogICAgQmVhbS5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXcoMCkKICAgIEJlYW0uQXR0YWNobWVudDAgPSBPcmlnaW5BdHRhY2htZW50CiAgICBCZWFtLkF0dGFjaG1lbnQxID0gUG9zaXRpb25BdHRhY2htZW50CiAgICBCZWFtLkZhY2VDYW1lcmEgPSB0cnVlCiAgICBCZWFtLlNlZ21lbnRzID0gMQogICAgQmVhbS5XaWR0aDAgPSAwLjEKICAgIEJlYW0uV2lkdGgxID0gMC4xCiAgICByZXR1cm4gQmVhbSwgcGFydDEsIHBhcnQyCmVuZApsb2NhbCBmdW5jdGlvbiBjcmVhdGVfY29vbF9iZWFtKHBvczEsIHBvczIsIGNvbG9yLCByYWluYm93KQogICAgTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIGRyYXdpbmcsIGRlbGV0ZW1lLCBkZWxldGVtZTE7CiAgICAgICAgbG9jYWwgcmVhbF9zaWdtYSwgZmFrZWVycm9yID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBkcmF3aW5nLCBkZWxldGVtZSwgZGVsZXRlbWUxID0gbWFrZV9iZWFtKHBvczEsIHBvczIsIGNvbG9yKQogICAgICAgIGVuZCkKICAgICAgICBpZiBub3QgcmVhbF9zaWdtYSB0aGVuCiAgICAgICAgICAgIHJldHVybiBwcmludChmYWtlZXJyb3IpCiAgICAgICAgZW5kCiAgICAgICAgbG9jYWwgd3RmID0gLTEKICAgICAgICBsb2NhbCBjb25uOyBjb25uID0gY2hlYXQudXRpbGl0eS5uZXdfcmVuZGVyc3RlcHBlZChmdW5jdGlvbihkZWx0YSkKICAgICAgICAgICAgd3RmID0gd3RmICsgZGVsdGEKICAgICAgICAgICAgZHJhd2luZy5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXcobWF0aC5jbGFtcCh3dGYsIDAsIDEpKQogICAgICAgICAgICBpZiByYWluYm93IHRoZW4KICAgICAgICAgICAgICAgIGRyYXdpbmcuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ld3sKICAgICAgICAgICAgICAgICAgICBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbG9yMy5mcm9tSFNWKHd0ZiAlIDEsIDEsIDEpKSwKICAgICAgICAgICAgICAgICAgICBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIENvbG9yMy5mcm9tSFNWKHd0ZiAlIDEsIDEsIDEpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgd3RmID49IDEgdGhlbgogICAgICAgICAgICAgICAgZHJhd2luZzpEZXN0cm95KCkKICAgICAgICAgICAgICAgIGRlbGV0ZW1lOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgZGVsZXRlbWUxOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgY29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kKSgpCmVuZApsb2NhbCBmdW5jdGlvbiB2aXN1YWxpemVfYnVsbGV0X3BhdGgoY2ZyYW1lZGlyLCBwb3NpdGlvbiwgcHJvamVjdGlsZV9zcGVlZCwgcHJvamVjdGlsZV9kcm9wLCBjb2xvciwgcmFpbmJvdykKICAgIGxvY2FsIGRpc3RhbmNlID0gKGNmcmFtZWRpci5wIC0gcG9zaXRpb24pLk1hZ25pdHVkZQogICAgbG9jYWwgdGltZV90b19oaXQgPSAoZGlzdGFuY2UgLyBwcm9qZWN0aWxlX3NwZWVkKQogICAgTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIG5ld3BvcyA9IGNmcmFtZWRpci5wCiAgICAgICAgbG9jYWwgcHJlZGljdGlvbnMgPSBtYXRoLmNlaWwoZGlzdGFuY2UvMTApCiAgICAgICAgaWYgcHJlZGljdGlvbnMgPT0gMCB0aGVuIHJldHVybiBlbmQKICAgICAgICBmb3IgaT0xLHByZWRpY3Rpb25zIGRvCiAgICAgICAgICAgIGxvY2FsIG5ld190aW1lID0gKGkvcHJlZGljdGlvbnMpKnRpbWVfdG9faGl0CiAgICAgICAgICAgIGxvY2FsIG9sZHBvcyA9IG5ld3BvcwogICAgICAgICAgICBsb2NhbCBuZXdwb3MxID0gKGNmcmFtZWRpciAqIF9DRnJhbWVuZXcoMCwgLXByb2plY3RpbGVfZHJvcCBeIChuZXdfdGltZSAqIHByb2plY3RpbGVfZHJvcCkgKyAxLCAtbmV3X3RpbWUgKiBwcm9qZWN0aWxlX3NwZWVkKSkuUG9zaXRpb24KICAgICAgICAgICAgbmV3cG9zID0gbmV3cG9zMQogICAgICAgICAgICAtLXByaW50KG9sZHBvcywgbmV3cG9zMSkKICAgICAgICAgICAgbG9jYWwgZHJhd2luZywgZGVsZXRlbWUsIGRlbGV0ZW1lMTsKICAgICAgICAgICAgbG9jYWwgcmVhbF9zaWdtYSwgZmFrZWVycm9yID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZHJhd2luZywgZGVsZXRlbWUsIGRlbGV0ZW1lMSA9IG1ha2VfYmVhbShvbGRwb3MsIG5ld3BvczEsIGNvbG9yKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGlmIG5vdCByZWFsX3NpZ21hIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBwcmludChmYWtlZXJyb3IpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCB3dGYgPSAtMQogICAgICAgICAgICBsb2NhbCBjb25uOyBjb25uID0gY2hlYXQudXRpbGl0eS5uZXdfcmVuZGVyc3RlcHBlZChmdW5jdGlvbihkZWx0YSkKICAgICAgICAgICAgICAgIHd0ZiA9IHd0ZiArIGRlbHRhCiAgICAgICAgICAgICAgICBuZXdfdGltZSA9IG5ld190aW1lICsgZGVsdGEKICAgICAgICAgICAgICAgIGRyYXdpbmcuVHJhbnNwYXJlbmN5ID0gTnVtYmVyU2VxdWVuY2UubmV3KG1hdGguY2xhbXAod3RmLCAwLCAxKSkKICAgICAgICAgICAgICAgIGlmIHJhaW5ib3cgdGhlbgogICAgICAgICAgICAgICAgICAgIGRyYXdpbmcuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ld3sKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb2xvcjMuZnJvbUhTVihuZXdfdGltZSAvIDIgJSAxLCAxLCAxKSksCiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29sb3IzLmZyb21IU1YobmV3X3RpbWUgLyAyICUgMSwgMSwgMSkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiB3dGYgPj0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZHJhd2luZzpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBkZWxldGVtZTpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBkZWxldGVtZTE6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgY29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQpKCkKZW5kCgotLVtbCgotLV1dCmxvY2FsIG1vZHVsZWNvbW0gPSB7CiAgICBlbmFibGVkID0gZmFsc2UsCiAgICByZXNvbHZlciA9IGZhbHNlLAogICAgY2FtZXJhID0gZmFsc2UsCiAgICBzaWxlbnQgPSBmYWxzZSwKICAgIHNsZWVwX2NoZWNrID0gZmFsc2UsCiAgICB0ZWFtX2NoZWNrID0gZmFsc2UsCiAgICBwYXJ0ID0gIkhlYWQiLAogICAgbWFuaXB1bGF0aW9uID0gZmFsc2UsCiAgICBtYW5pcHVsYXRpb25fcmFuZ2UgPSA1LAogICAgZm92ID0gZmFsc2UsCiAgICBmb3Zfc2hvdyA9IGZhbHNlLAogICAgZm92X2NvbG9yID0gQ29sb3IzLm5ldygxLCAxLCAxKSwKICAgIGZvdl9vdXRsaW5lID0gZmFsc2UsCiAgICBmb3Zfb3V0bGluZV9jb2xvciA9IENvbG9yMy5uZXcoMCwgMCwgMCksCiAgICBmb3Zfc2l6ZSA9IDEwMCwKICAgIGluZGljYXRvciA9IGZhbHNlLAogICAgaW5kaWNhdG9yX3RleHQgPSAiIiwKICAgIGp1bXBzaG9vdCA9IGZhbHNlLAogICAgbm9zbG93ZG93biA9IGZhbHNlLAogICAgbm9zcHJlYWQgPSBmYWxzZSwKICAgIGZvcmNlaGVhZCA9IGZhbHNlLAogICAgaW52aXMgPSBmYWxzZSwKICAgIG1hdGhodWdlID0gZmFsc2UsCiAgICBoaXRib3hlcyA9IGZhbHNlLAogICAgaGJieXBhc3MgPSBmYWxzZSwKICAgIGluc3RhbnQgPSBmYWxzZSwKICAgIGZseSA9IGZhbHNlLAogICAgc2lsZW50d2FsayA9IGZhbHNlLAogICAgZG93bmhpbGwgPSBmYWxzZSwKICAgIHZlbG9icmVhayA9IGZhbHNlLAogICAgdmVsb2JyZWFrc3RyZW5naHQgPSA2LAogICAgaW5maW5pdGVyZWdpc3RlciA9IGZhbHNlLAogICAgc2ltdWxhdGlvbiA9IGZhbHNlLAogICAgc2ltdWxhdGlvbl90aW1lID0gInNpbXBsZSIsCiAgICBzaW11bGF0aW9uX3RhYmxlID0ge30sCiAgICB0YXJnZXQgPSB7fSwKICAgIGFudGlhaW0gPSB7CiAgICAgICAgYW50aWFpbSA9IGZhbHNlLAogICAgICAgIGFudGlhaW15YXcgPSAibm9uZSIsIC0tIG5vbmUsIHNwaW4sIHN0YXRpYywgaml0dGVyLCBpbnZpc2libGUKICAgICAgICBhbnRpYWltcGl0Y2ggPSAibm9uZSIsIC0tIG5vbmUsIGRvd24sIHVwLCBqaXR0ZXIsIGN1c3RvbQogICAgICAgIHNwaW5zcGVlZCA9IDAuMSwKICAgICAgICBiYWNrd2FyZHMgPSBmYWxzZSwKICAgICAgICB5YXdvZmZzZXQgPSAwLAogICAgICAgIHlhd2ppdHRlcnNpemUgPSAwLAogICAgICAgIHBpdGNoaml0dGVyc2l6ZSA9IDAsCiAgICAgICAgcGl0Y2hjdXN0b20gPSAwLAoKICAgICAgICBjYXIgPSBmYWxzZSwKICAgICAgICBjYXJ0cmlwbW9kZSA9ICJzaWRlIiwgLS0gbm9uZSwgbGVmdCBzaWRlLCByaWdodCBzaWRlLCBmcm9udCwgYmFjaywgemVybwogICAgICAgIGNhcnlhdyA9ICJub25lIiwgLS0gbm9uZSwgZ29kLCBzcGluLCBqaXR0ZXIsIGludmlzaWJsZQogICAgICAgIGNhcnNwaW5zcGVlZCA9IDAuMSwKICAgIH0sCn0KZG8KICAgIGxvY2FsIG5vcmVjb2lsID0gZmFsc2UKICAgIGxvY2FsIHRhcmdldF9wYXJ0LCB0YXJnZXRfZW50aXR5LCBtYW5pcHVsYXRpb25fcG9zOwogICAgbG9jYWwgZXh0cmVtZXJlc29sdmVyLCByZXNvbHZlciA9IGZhbHNlLCBmYWxzZQogICAgbG9jYWwgc2Fsb2JveCA9IHVpLmJveC5haW1ib3Q6QWRkVGFiKCdhaW1ib3R6eicpCiAgICBsb2NhbCBndW5tb2Rib3ggPSB1aS5ib3gubW9kczpBZGRUYWIoJ2d1biBtb2RzJykKICAgIGxvY2FsIGFhYm94ID0gdWkuYm94LmFudGlhaW06QWRkVGFiKCdhbnRpYWltJykKICAgIGRvCiAgICAgICAgbG9jYWwgYWFzZXQgPSBtb2R1bGVjb21tLmFudGlhaW0KICAgICAgICBhYWJveDpBZGRUb2dnbGUoJ2FudGlhaW1fZW5hYmxlZCcsIHtUZXh0ID0gJ2FudGlhaW0nLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBhYXNldC5hbnRpYWltID0gZmlyc3QKICAgICAgICBlbmR9KQogICAgICAgIGFhYm94OkFkZERyb3Bkb3duKCdhbnRpYWltX3lhdycsIHtWYWx1ZXM9eyJub25lIiwgInNwaW4iLCAic3RhdGljIiwgImppdHRlciIsICJpbnZpc2libGUifSxEZWZhdWx0ID0gMSxNdWx0aSA9IGZhbHNlLFRleHQgPSAneWF3IG1vZGlmaWVyJyxDYWxsYmFjaz1mdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgYWFzZXQuYW50aWFpbXlhdyA9IFZhbHVlCiAgICAgICAgZW5kfSkKICAgICAgICBhYWJveDpBZGREcm9wZG93bignYW50aWFpbV9waXRjaCcsIHtWYWx1ZXM9eyJub25lIiwgImRvd24iLCAidXAiLCAiaml0dGVyIiwgImN1c3RvbSJ9LERlZmF1bHQgPSAxLE11bHRpID0gZmFsc2UsVGV4dCA9ICdwaXRjaCBtb2RpZmllcicsQ2FsbGJhY2s9ZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgIGFhc2V0LmFudGlhaW1waXRjaCA9IFZhbHVlCiAgICAgICAgZW5kfSkKICAgICAgICAtLS0tLS0tLS0tLS0tLT4+PiB5YXcKICAgICAgICAtLT4gc3BpbgogICAgICAgIGRvCiAgICAgICAgICAgIGxvY2FsIGFhZGVwYm94ID0gYWFib3g6QWRkRGVwZW5kZW5jeUJveCgpOwogICAgICAgICAgICBhYWRlcGJveDpBZGRTbGlkZXIoJ2FudGlhaW1fc3BpbnNwZWVkJyx7VGV4dCA9ICdzcGluIHNwZWVkIChycG0pJyxEZWZhdWx0ID0gNjAsTWluID0gNjAsTWF4ID0gMzYwLFJvdW5kaW5nID0gMCxDb21wYWN0ID0gdHJ1ZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFN0YXRlKQogICAgICAgICAgICAgICAgYWFzZXQuc3BpbnNwZWVkID0gU3RhdGUKICAgICAgICAgICAgZW5kfSkKICAgICAgICAgICAgYWFkZXBib3g6U2V0dXBEZXBlbmRlbmNpZXMoewogICAgICAgICAgICAgICAgeyBjaGVhdC5PcHRpb25zLmFudGlhaW1feWF3LCAic3BpbiIgfQogICAgICAgICAgICB9KTsKICAgICAgICBlbmQKICAgICAgICAtLT4gaml0dGVyCiAgICAgICAgZG8KICAgICAgICAgICAgbG9jYWwgYWFkZXBib3ggPSBhYWJveDpBZGREZXBlbmRlbmN5Qm94KCk7CiAgICAgICAgICAgIGFhZGVwYm94OkFkZFNsaWRlcignYW50aWFpbV9qaXR0ZXJzaXplJyx7VGV4dCA9ICd5YXcgaml0dGVyIChkKScsRGVmYXVsdCA9IDQ1LE1pbiA9IDAsTWF4ID0gMTgwLFJvdW5kaW5nID0gMCxDb21wYWN0ID0gdHJ1ZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFN0YXRlKQogICAgICAgICAgICAgICAgYWFzZXQueWF3aml0dGVyc2l6ZSA9IFN0YXRlCiAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgIGFhZGVwYm94OlNldHVwRGVwZW5kZW5jaWVzKHsKICAgICAgICAgICAgICAgIHsgY2hlYXQuT3B0aW9ucy5hbnRpYWltX3lhdywgImppdHRlciIgfQogICAgICAgICAgICB9KTsKICAgICAgICBlbmQKICAgICAgICAtLT4gc3RhdGljLCBqaXR0ZXIKICAgICAgICBkbwogICAgICAgICAgICBsb2NhbCBhYWRlcGJveCA9IGFhYm94OkFkZERlcGVuZGVuY3lCb3goKTsKICAgICAgICAgICAgYWFkZXBib3g6QWRkVG9nZ2xlKCdhbnRpYWltX2JhY2t3YXJkcycsIHtUZXh0ID0gJ2JhY2t3YXJkcycsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBhYXNldC5iYWNrd2FyZHMgPSBWYWx1ZQogICAgICAgICAgICBlbmR9KQogICAgICAgICAgICBhYWRlcGJveDpBZGRTbGlkZXIoJ2FudGlhaW1feWF3b2Zmc2V0Jyx7VGV4dCA9ICd5YXcgb2Zmc2V0JyxEZWZhdWx0ID0gMCxNaW4gPSAtOTAsTWF4ID0gOTAsUm91bmRpbmcgPSAwLENvbXBhY3QgPSB0cnVlLENhbGxiYWNrID0gZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgICAgICAgICBhYXNldC55YXdvZmZzZXQgPSBTdGF0ZQogICAgICAgICAgICBlbmR9KQogICAgICAgICAgICBhYWRlcGJveDpTZXR1cERlcGVuZGVuY2llcyh7CiAgICAgICAgICAgICAgICB7IGNoZWF0Lk9wdGlvbnMuYW50aWFpbV95YXcsICJzdGF0aWMiIH0sCiAgICAgICAgICAgICAgICB7IGNoZWF0Lk9wdGlvbnMuYW50aWFpbV95YXcsICJqaXR0ZXIiIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgZW5kCiAgICAgICAgLS0tLS0tLS0tLS0tLS0+Pj4gcGl0Y2gKICAgICAgICAtLT4gcGl0Y2ggaml0dGVyIHNpemUKICAgICAgICBkbwogICAgICAgICAgICBsb2NhbCBhYWRlcGJveCA9IGFhYm94OkFkZERlcGVuZGVuY3lCb3goKTsKICAgICAgICAgICAgYWFkZXBib3g6QWRkU2xpZGVyKCdhbnRpYWltX3BpdGNoaml0dGVyc2l6ZScse1RleHQgPSAncGl0Y2ggaml0dGVyJyxEZWZhdWx0ID0gOTAsTWluID0gMCxNYXggPSA5MCxSb3VuZGluZyA9IDAsQ29tcGFjdCA9IHRydWUsQ2FsbGJhY2sgPSBmdW5jdGlvbihTdGF0ZSkKICAgICAgICAgICAgICAgIGFhc2V0LnBpdGNoaml0dGVyc2l6ZSA9IFN0YXRlCiAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgIGFhZGVwYm94OlNldHVwRGVwZW5kZW5jaWVzKHsKICAgICAgICAgICAgICAgIHsgY2hlYXQuT3B0aW9ucy5hbnRpYWltX3BpdGNoLCAiaml0dGVyIiB9CiAgICAgICAgICAgIH0pOwogICAgICAgIGVuZAogICAgICAgIC0tPiBjdXN0b20gcGl0Y2gKICAgICAgICBkbwogICAgICAgICAgICBsb2NhbCBhYWRlcGJveCA9IGFhYm94OkFkZERlcGVuZGVuY3lCb3goKTsKICAgICAgICAgICAgYWFkZXBib3g6QWRkU2xpZGVyKCdhbnRpYWltX2N1c3RvbXBpdGNoJyx7VGV4dCA9ICdwaXRjaCAoLTkwPWRvd24sIDkwPXVwKScsRGVmYXVsdCA9IDAsTWluID0gLTkwLE1heCA9IDkwLFJvdW5kaW5nID0gMCxDb21wYWN0ID0gdHJ1ZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFN0YXRlKQogICAgICAgICAgICAgICAgYWFzZXQucGl0Y2hjdXN0b20gPSBTdGF0ZQogICAgICAgICAgICBlbmR9KQogICAgICAgICAgICBhYWRlcGJveDpTZXR1cERlcGVuZGVuY2llcyh7CiAgICAgICAgICAgICAgICB7IGNoZWF0Lk9wdGlvbnMuYW50aWFpbV9waXRjaCwgImN1c3RvbSIgfQogICAgICAgICAgICB9KTsKICAgICAgICBlbmQKICAgIGVuZAogICAgZ3VubW9kYm94OkFkZFRvZ2dsZSgnZ3VubW9kc19ub3JlY29pbCcsIHtUZXh0ID0gJ25vIHJlY29pbCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgc2V0Y29uc3RhbnQoZGVidWcuZ2V0cHJvdG8oZ2FyYmFnZS5yZWNvaWwsIDEpLCAyLCBmaXJzdCBhbmQgcmF3Z2V0KHJhd2dldChjbGFzc2VzLCAiSW5wdXRNYW5hZ2VyIiksICJJbnB1dERldmljZSIpIG9yICJNb2JpbGUiKQogICAgZW5kfSkKICAgIC0tZ3VubW9kYm94OkFkZFRvZ2dsZSgnZ3VubW9kc19qdW1wc2hvb3QnLCB7VGV4dCA9ICdqdW1wIHNob290JyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgIC0tICAgIG1vZHVsZWNvbW0uanVtcHNob290ID0gZmlyc3QKICAgIC0tZW5kfSkKICAgIGd1bm1vZGJveDpBZGRUb2dnbGUoJ2d1bm1vZHNfbm9zcHJlYWQnLCB7VGV4dCA9ICdubyBzcHJlYWQnLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIG1vZHVsZWNvbW0ubm9zcHJlYWQgPSBmaXJzdAogICAgZW5kfSkKICAgIGd1bm1vZGJveDpBZGRUb2dnbGUoJ2d1bm1vZHNfbm9zbG93ZG93bicsIHtUZXh0ID0gJ25vIHNsb3dkb3duJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBtb2R1bGVjb21tLm5vc2xvd2Rvd24gPSBmaXJzdAogICAgZW5kfSkKICAgIGd1bm1vZGJveDpBZGRUb2dnbGUoJ2d1bm1vZHNfZm9yY2VoZWFkJywge1RleHQgPSAnZm9yY2UgaGVhZCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgbW9kdWxlY29tbS5mb3JjZWhlYWQgPSBmaXJzdAogICAgZW5kfSkKCiAgICBzYWxvYm94OkFkZFRvZ2dsZSgnYWltYm90X2VuYWJsZWQnLCB7VGV4dCA9ICdhaW1ib3QnLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIG1vZHVsZWNvbW0uZW5hYmxlZCA9IGZpcnN0CiAgICBlbmR9KQogICAgc2Fsb2JveDpBZGRUb2dnbGUoJ2FpbWJvdF9yZXNvbHZlcicsIHtUZXh0ID0gJ3Jlc29sdmVyJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICByZXNvbHZlciA9IGZpcnN0CiAgICBlbmR9KQoKICAgIC0tW1tzYWxvYm94OkFkZFRvZ2dsZSgnYWltYm90X2luc3RhbnQnLCB7VGV4dCA9ICdpbnN0YW50IGhpdCAoVEVTVCknLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIG1vZHVsZWNvbW0uaW5zdGFudCA9IGZpcnN0CiAgICBlbmR9KV1dCgogICAgc2Fsb2JveDpBZGRUb2dnbGUoJ2FpbWJvdF9jYW1lcmEnLCB7VGV4dCA9ICdjYW1lcmEgKG1iMiknLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIG1vZHVsZWNvbW0uY2FtZXJhID0gZmlyc3QKICAgIGVuZH0pCiAgICBzYWxvYm94OkFkZFRvZ2dsZSgnYWltYm90X3NpbGVudCcsIHtUZXh0ID0gJ3NpbGVudCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgbW9kdWxlY29tbS5zaWxlbnQgPSBmaXJzdAogICAgZW5kfSkKCiAgICBzYWxvYm94OkFkZFRvZ2dsZSgnYWltYm90X2luZGljYXRvcicsIHtUZXh0ID0gJ2luZGljYXRvciAoY3Jvc3NoYWlyIG5lZWRlZCknLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIG1vZHVsZWNvbW0uaW5kaWNhdG9yID0gZmlyc3QKICAgIGVuZH0pCgogICAgc2Fsb2JveDpBZGRUb2dnbGUoJ2FpbWJvdF9zbGVlcF9jaGVjaycsIHtUZXh0ID0gJ3NsZWVwZXIgY2hlY2snLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIG1vZHVsZWNvbW0uc2xlZXBfY2hlY2sgPSBmaXJzdAogICAgZW5kfSkKCiAgICBzYWxvYm94OkFkZFRvZ2dsZSgnYWltYm90X3RlYW1fY2hlY2snLCB7VGV4dCA9ICd0ZWFtIGNoZWNrJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBtb2R1bGVjb21tLnRlYW1fY2hlY2sgPSBmaXJzdAogICAgZW5kfSkKCiAgICBzYWxvYm94OkFkZFRvZ2dsZSgnYWltYm90X2ZvdicsIHtUZXh0ID0gJ3VzZSBmb3YnLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIG1vZHVsZWNvbW0uZm92ID0gVmFsdWUKICAgIGVuZH0pCgogICAgbG9jYWwgRGVwYm94MSA9IHNhbG9ib3g6QWRkRGVwZW5kZW5jeUJveCgpOwoKICAgIERlcGJveDE6QWRkVG9nZ2xlKCdhaW1ib3RfZm92X3Nob3cnLCB7VGV4dCA9ICdzaG93IGZvdicsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgbW9kdWxlY29tbS5mb3Zfc2hvdyA9IFZhbHVlCiAgICBlbmR9KTpBZGRDb2xvclBpY2tlcignYWltYm90X2Zvdl9jb2xvcicse0RlZmF1bHQgPSBDb2xvcjMubmV3KDEsIDEsIDEpLFRpdGxlID0gJ2ZvdiBjb2xvcicsVHJhbnNwYXJlbmN5ID0gMCxDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIG1vZHVsZWNvbW0uZm92X2NvbG9yID0gVmFsdWUKICAgIGVuZH0pCgogICAgRGVwYm94MTpBZGRUb2dnbGUoJ2FpbWJvdF9mb3Zfb3V0bGluZScsIHtUZXh0ID0gJ2ZvdiBvdXRsaW5lJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBtb2R1bGVjb21tLmZvdl9vdXRsaW5lID0gVmFsdWUKICAgIGVuZH0pCgogICAgRGVwYm94MTpBZGRTbGlkZXIoJ2FpbWJvdF9mb3Zfc2l6ZScse1RleHQgPSAndGFyZ2V0IGZvdicsRGVmYXVsdCA9IDEwMCxNaW4gPSAxMCxNYXggPSAxMDAwLFJvdW5kaW5nID0gMCxDb21wYWN0ID0gdHJ1ZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFN0YXRlKQogICAgICAgIG1vZHVsZWNvbW0uZm92X3NpemUgPSBTdGF0ZQogICAgZW5kfSkKCiAgICBEZXBib3gxOlNldHVwRGVwZW5kZW5jaWVzKHsKICAgICAgICB7IGNoZWF0LlRvZ2dsZXMuYWltYm90X2ZvdiwgdHJ1ZSB9CiAgICB9KTsKICAgIHNhbG9ib3g6QWRkVG9nZ2xlKCdzaWxlbnRhaW1fbWFuaXB1bGF0aW9uJywge1RleHQgPSAnc2lsZW50IG1hbmlwdWxhdGlvbicsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgbW9kdWxlY29tbS5tYW5pcHVsYXRpb24gPSBWYWx1ZQogICAgZW5kfSkKCiAgICBsb2NhbCBEZXBib3gyID0gc2Fsb2JveDpBZGREZXBlbmRlbmN5Qm94KCk7CiAgICAKICAgIERlcGJveDI6QWRkU2xpZGVyKCdzaWxlbnRhaW1fbWFuaXB1bGF0aW9uX3JhbmdlJyx7VGV4dCA9ICdtYW5pcHVsYXRpb24gcmFuZ2UnLERlZmF1bHQgPSA1LE1pbiA9IDEsTWF4ID0gNSxSb3VuZGluZyA9IDEsQ29tcGFjdCA9IHRydWUsQ2FsbGJhY2sgPSBmdW5jdGlvbihTdGF0ZSkKICAgICAgICBtb2R1bGVjb21tLm1hbmlwdWxhdGlvbl9yYW5nZSA9IFN0YXRlCiAgICBlbmR9KQoKICAgIERlcGJveDI6U2V0dXBEZXBlbmRlbmNpZXMoewogICAgICAgIHsgY2hlYXQuVG9nZ2xlcy5zaWxlbnRhaW1fbWFuaXB1bGF0aW9uLCB0cnVlIH0KICAgIH0pOwogICAgbG9jYWwgc2ltdWxhdGlvbl90YWJsZSA9IHt9IGRvCiAgICAgICAgbG9jYWwgZW5hYmxlZCwgcmFuZ2UsIHlyYW5nZSwgc2xpY2VzLCByZWZyZXNoX3RpbWUgPSBmYWxzZSwgMTAsIDUsIDUsIDAuMQoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZW5lcmF0ZV9zaW11bGF0aW9uX3RhYmxlKCkgTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgICAgICBzaW11bGF0aW9uX3RhYmxlID0ge30KICAgICAgICAgICAgaWYgbm90IG1vZHVsZWNvbW0uc2ltdWxhdGlvbiB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgZm9yIHggPSAtcmFuZ2UsIHJhbmdlLCByYW5nZS9zbGljZXMgZG8KICAgICAgICAgICAgICAgIGZvciB6ID0gLXJhbmdlLCByYW5nZSwgcmFuZ2Uvc2xpY2VzIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgeXJhbmdlID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB5ID0gLXlyYW5nZSwgeXJhbmdlLCB5cmFuZ2Uvc2xpY2VzIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW11bGF0aW9uX3RhYmxlWyNzaW11bGF0aW9uX3RhYmxlICsgMV0gPSBfVmVjdG9yM25ldyh4LCB5LCB6KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHNpbXVsYXRpb25fdGFibGVbI3NpbXVsYXRpb25fdGFibGUgKyAxXSA9IF9WZWN0b3IzbmV3KHgsIDAsIHopCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKSgpIGVuZAogICAgICAgIHNhbG9ib3g6QWRkVG9nZ2xlKCdzaWxlbnRhaW1fc2ltdWxhdGlvbicsIHtUZXh0ID0gJ3BsYXllciBzaW11bGF0aW9uJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgbW9kdWxlY29tbS5zaW11bGF0aW9uID0gVmFsdWUKICAgICAgICAgICAgZ2VuZXJhdGVfc2ltdWxhdGlvbl90YWJsZSgpCiAgICAgICAgZW5kfSkKICAgICAgICBzYWxvYm94OkFkZFNsaWRlcignc2lsZW50YWltX3NpbXVsYXRpb25fcmFuZ2UnLHtUZXh0ID0gJ3NpbXVsYXRpb24gcmFuZ2UnLERlZmF1bHQgPSAxMCxNaW4gPSAxMCxNYXggPSA1MDAwLFJvdW5kaW5nID0gMCxDb21wYWN0ID0gdHJ1ZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFN0YXRlKQogICAgICAgICAgICByYW5nZSA9IFN0YXRlCiAgICAgICAgICAgIGdlbmVyYXRlX3NpbXVsYXRpb25fdGFibGUoKQogICAgICAgIGVuZH0pCiAgICAgICAgc2Fsb2JveDpBZGRTbGlkZXIoJ3NpbGVudGFpbV9zaW11bGF0aW9uX3lyYW5nZScse1RleHQgPSAnc2ltdWxhdGlvbiB5IHJhbmdlJyxEZWZhdWx0ID0gMCxNaW4gPSAwLE1heCA9IDEwLFJvdW5kaW5nID0gMCxDb21wYWN0ID0gdHJ1ZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFN0YXRlKQogICAgICAgICAgICB5cmFuZ2UgPSBTdGF0ZQogICAgICAgICAgICBnZW5lcmF0ZV9zaW11bGF0aW9uX3RhYmxlKCkKICAgICAgICBlbmR9KQogICAgICAgIHNhbG9ib3g6QWRkU2xpZGVyKCdzaWxlbnRhaW1fc2ltdWxhdGlvbl9zbGljZXMnLHtUZXh0ID0gJ3NpbXVsYXRpb24gc2xpY2VzJyxEZWZhdWx0ID0gNSxNaW4gPSAxLE1heCA9IDIwLFJvdW5kaW5nID0gMCxDb21wYWN0ID0gdHJ1ZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFN0YXRlKQogICAgICAgICAgICBzbGljZXMgPSBTdGF0ZQogICAgICAgICAgICBnZW5lcmF0ZV9zaW11bGF0aW9uX3RhYmxlKCkKICAgICAgICBlbmR9KQogICAgICAgIHNhbG9ib3g6QWRkU2xpZGVyKCdzaWxlbnRhaW1fc2ltdWxhdGlvbl9yZWZyZXNoJyx7VGV4dCA9ICdyZWZyZXNoIHRpbWUnLERlZmF1bHQgPSAwLjEsTWluID0gMC4xLE1heCA9IDEsUm91bmRpbmcgPSAxLENvbXBhY3QgPSB0cnVlLENhbGxiYWNrID0gZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgICAgIHJlZnJlc2hfdGltZSA9IFN0YXRlCiAgICAgICAgICAgIGdlbmVyYXRlX3NpbXVsYXRpb25fdGFibGUoKQogICAgICAgIGVuZH0pCiAgICAgICAgc2Fsb2JveDpBZGREcm9wZG93bignc2lsZW50YWltX3NpbXVsYXRpb25fdGltZScsIHtWYWx1ZXMgPSB7J3NpbXBsZScsJ2NvbXBsZXgtc2ltcGxlJywnY29tcGxleCd9LERlZmF1bHQgPSAxLE11bHRpID0gZmFsc2UsVGV4dCA9ICdzaW11bGF0aW9uIHRpbWUgdHlwZScsQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgbW9kdWxlY29tbS5zaW11bGF0aW9uX3RpbWUgPSBWYWx1ZQogICAgICAgIGVuZH0pCiAgICAgICAgZ2VuZXJhdGVfc2ltdWxhdGlvbl90YWJsZSgpCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIHRhc2sud2FpdChyZWZyZXNoX3RpbWUpIGRvCiAgICAgICAgICAgICAgICBpZiBtb2R1bGVjb21tLnRhcmdldFsxXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbW9kdWxlY29tbS5zaW11bGF0aW9uX3BvcyA9IG1vZHVsZWNvbW0uc2ltdWxhdGlvbiBhbmQgZ2V0X3NpbXVsYXRpb25fcG9zKENhbWVyYS5DRnJhbWUucCwgbW9kdWxlY29tbS50YXJnZXRbMV0uUGFyZW50LCBtb2R1bGVjb21tLnRhcmdldFsxXSwgc2ltdWxhdGlvbl90YWJsZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKICAgIGxvY2FsIENpcmNsZU91dGxpbmUgPSBEcmF3aW5nLm5ldygiQ2lyY2xlIikKICAgIGxvY2FsIENpcmNsZUlubGluZSA9IERyYXdpbmcubmV3KCJDaXJjbGUiKQogICAgQ2lyY2xlSW5saW5lLlRyYW5zcGFyZW5jeSA9IDEKICAgIENpcmNsZUlubGluZS5UaGlja25lc3MgPSAxCiAgICBDaXJjbGVJbmxpbmUuWkluZGV4ID0gMgogICAgQ2lyY2xlT3V0bGluZS5UaGlja25lc3MgPSAzCiAgICBDaXJjbGVPdXRsaW5lLkNvbG9yID0gQ29sb3IzLm5ldygpCiAgICBDaXJjbGVPdXRsaW5lLlpJbmRleCA9IDEKICAgIC0tbG9jYWwgY2xhc3NlcyA9IGdhcmJhZ2UuY2xhc3NlcwoKICAgIGNoZWF0LnV0aWxpdHkubmV3X3JlbmRlcnN0ZXBwZWQoTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgIENpcmNsZU91dGxpbmUuUG9zaXRpb24gPSAoX1ZlY3RvcjJuZXcoTW91c2UuWCwgTW91c2UuWSArIEd1aUluc2V0LlkpKQogICAgICAgIENpcmNsZUlubGluZS5Qb3NpdGlvbiA9IChfVmVjdG9yMm5ldyhNb3VzZS5YLCBNb3VzZS5ZICsgR3VpSW5zZXQuWSkpCiAgICAgICAgQ2lyY2xlSW5saW5lLlJhZGl1cyA9IG1vZHVsZWNvbW0uZm92X3NpemUKICAgICAgICBDaXJjbGVJbmxpbmUuQ29sb3IgPSBtb2R1bGVjb21tLmZvdl9jb2xvcgogICAgICAgIENpcmNsZUlubGluZS5WaXNpYmxlID0gbW9kdWxlY29tbS5mb3YgYW5kIG1vZHVsZWNvbW0uZm92X3Nob3cKICAgICAgICBDaXJjbGVPdXRsaW5lLlJhZGl1cyA9IG1vZHVsZWNvbW0uZm92X3NpemUKICAgICAgICBDaXJjbGVPdXRsaW5lLlZpc2libGUgPSAobW9kdWxlY29tbS5mb3YgYW5kIG1vZHVsZWNvbW0uZm92X3Nob3cgYW5kIG1vZHVsZWNvbW0uZm92X291dGxpbmUpCiAgICAgICAgaWYgbW9kdWxlY29tbS5ub3Nsb3dkb3duIHRoZW4KICAgICAgICAgICAgcmF3c2V0KGdhcmJhZ2UuY2hhcmFjdGVyLCAic3ByaW50QmxvY2tlZCIsIGZhbHNlKQogICAgICAgIGVuZAogICAgZW5kKSkKICAgIGNoZWF0LnV0aWxpdHkubmV3X2hlYXJ0YmVhdChMUEhfSklUX01BWChmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgaW5kdHh0ID0gIiIKICAgICAgICB0YXJnZXRfcGFydCwgdGFyZ2V0X2VudGl0eSA9IGdldF9jbG9zZXN0X3RhcmdldChtb2R1bGVjb21tLmZvdiwgbW9kdWxlY29tbS5mb3Zfc2l6ZSwgbW9kdWxlY29tbS5wYXJ0LCBtb2R1bGVjb21tLnNsZWVwX2NoZWNrLCBtb2R1bGVjb21tLnRlYW1fY2hlY2spOwogICAgICAgIG1vZHVsZWNvbW0udGFyZ2V0ID0ge3RhcmdldF9wYXJ0LCB0YXJnZXRfZW50aXR5fQogICAgICAgIGlmIHRhcmdldF9wYXJ0IGFuZCB0YXJnZXRfZW50aXR5IHRoZW4KICAgICAgICAgICAgbWFuaXB1bGF0aW9uX3BvcyA9IHRhcmdldF9wYXJ0IGFuZCB0YXJnZXRfZW50aXR5IGFuZCBnZXRfbWFuaXB1bGF0aW9uX3Bvcyhtb2R1bGVjb21tLmV4dGVuZGVkX21hbmlwdWxhdGlvbiBhbmQgdHJpZGVudC5sYXN0cG9zIG9yIENhbWVyYS5DRnJhbWUucCwgdGFyZ2V0X3BhcnQuUGFyZW50LCB0YXJnZXRfcGFydCwgbW9kdWxlY29tbS5tYW5pcHVsYXRpb25fcmFuZ2UgKyAobW9kdWxlY29tbS5leHRlbmRlZF9tYW5pcHVsYXRpb24gYW5kIDUgb3IgMCksIG1vZHVsZWNvbW0ubWFuaXB1bGF0aW9uKSBvciBuaWw7CiAgICAgICAgICAgIGluZHR4dCA9IGluZHR4dC4uKHJhd2dldCh0YXJnZXRfZW50aXR5LCAibmFtZSIpIG9yIHJhd2dldCh0YXJnZXRfZW50aXR5LCAidHlwZSIpKQogICAgICAgICAgICBpZiBtb2R1bGVjb21tLm1hbmlwdWxhdGlvbiBhbmQgbWFuaXB1bGF0aW9uX3BvcyB0aGVuCiAgICAgICAgICAgICAgICBpbmR0eHQgPSBpbmR0eHQuLiIgKHZpc2libGUpIgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgbW9kdWxlY29tbS5zaW11bGF0aW9uX3BvcyB0aGVuCiAgICAgICAgICAgICAgICBpbmR0eHQgPSBpbmR0eHQuLiIgKHNpbXVsYXRlZCkiCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgaW5kdHh0ID0gIiIKICAgICAgICBlbmQKICAgICAgICBtb2R1bGVjb21tLmluZGljYXRvcl90ZXh0ID0gaW5kdHh0CiAgICBlbmQpKQogICAgLS1bWwogICAgZm9yIF8sIHYgaW4gZ2V0Z2ModHJ1ZSkgZG8KICAgICAgICBpZiB0eXBlKHYpID09ICJ0YWJsZSIgYW5kIHJhd2dldCh2LCAidHlwZSIpID09ICJNaW5pbmdEcmlsbCIgdGhlbgogICAgICAgICAgICB2LkF0dGFja0Nvb2xkb3duID0gMAogICAgICAgIGVuZAogICAgZW5kCiAgICBdXQogICAgLS1bW1J1blNlcnZpY2U6QmluZFRvUmVuZGVyU3RlcCh0b3N0cmluZyhtYXRoLnJhbmRvbSgpKSwgRW51bS5SZW5kZXJQcmlvcml0eS5DaGFyYWN0ZXIuVmFsdWUgKyAxLCBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgaWYgbW9kdWxlY29tbS5qdW1wc2hvb3QgdGhlbgogICAgICAgICAgICBzZXR1cHZhbHVlKGdhcmJhZ2UuaXNncm91bmRlZCwgMSwgdHJ1ZSkKICAgICAgICAgICAgc2V0dXB2YWx1ZShnYXJiYWdlLmlzZ3JvdW5kZWQsIDQsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQpKV1dCiAgICBkbwogICAgICAgIGxvY2FsIGVudGxpc3QgPSBnZXR1cHZhbHVlKGdhcmJhZ2UuZW50aXR5bGlzdCwgMSkKICAgICAgICBSdW5TZXJ2aWNlOkJpbmRUb1JlbmRlclN0ZXAodG9zdHJpbmcobWF0aC5yYW5kb20oKSksIDAsIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgcmVzb2x2ZXIgdGhlbgogICAgICAgICAgICAgICAgZm9yIGlkLCBlbnRpdHkgaW4gZW50bGlzdCBkbyBpZiByYXdnZXQoZW50aXR5LCAic3RhcnRBbmdsZVkiKSBhbmQgcmF3Z2V0KGVudGl0eSwgInN0YXJ0QW5nbGVYIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJhd3NldChlbnRpdHksICJzdGFydEFuZ2xlWSIsIDApCiAgICAgICAgICAgICAgICAgICAgcmF3c2V0KGVudGl0eSwgImdvYWxBbmdsZVkiLCAwKQogICAgICAgICAgICAgICAgICAgIHJhd3NldChlbnRpdHksICJzdGFydEFuZ2xlWCIsIDApCiAgICAgICAgICAgICAgICAgICAgcmF3c2V0KGVudGl0eSwgImdvYWxBbmdsZVgiLCAwKQogICAgICAgICAgICAgICAgICAgIHJhd3NldChlbnRpdHksICJyb3QiLCBWZWN0b3IzLnplcm8pCiAgICAgICAgICAgICAgICBlbmQgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgZXF1aXBwZWRpdGVtID0gZ2V0dXB2YWx1ZShnYXJiYWdlLmVxdWlwcGVkaXRlbSwgMSkKICAgICAgICAgICAgdHJpZGVudC5ndW5pbmZvID0gY2xhc3NlcyBhbmQgZXF1aXBwZWRpdGVtIGFuZCByYXdnZXQoY2xhc3NlcywgcmF3Z2V0KGVxdWlwcGVkaXRlbSwgInR5cGUiKSkKICAgIAogICAgICAgICAgICBpZiBtb2R1bGVjb21tLmVuYWJsZWQgYW5kIG1vZHVsZWNvbW0uY2FtZXJhIGFuZCB0YXJnZXRfcGFydCBhbmQgdGFyZ2V0X2VudGl0eSBhbmQgVXNlcklucHV0U2VydmljZTpJc01vdXNlQnV0dG9uUHJlc3NlZChFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24yKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBndW5pbmZvICAgID0gdHJpZGVudC5ndW5pbmZvCiAgICAgICAgICAgICAgICBsb2NhbCBwcm9qX3NwZWVkID0gZ3VuaW5mbyBhbmQgcmF3Z2V0KGd1bmluZm8sICJQcm9qZWN0aWxlU3BlZWQiKQogICAgICAgICAgICAgICAgbG9jYWwgcHJval9kcm9wICA9IGd1bmluZm8gYW5kIHJhd2dldChndW5pbmZvLCAiUHJvamVjdGlsZURyb3AiKSBvciAwCiAgICAgICAgICAgICAgICBsb2NhbCBjYW1wb3MgICAgID0gQ2FtZXJhLkNGcmFtZS5wCiAgICAgICAgICAgICAgICBsb2NhbCBwaXRjaCwgeWF3ID0gQ0ZyYW1lLmxvb2tBdChjYW1wb3MsIAogICAgICAgICAgICAgICAgICAgIChndW5pbmZvIGFuZCBwcm9qX3NwZWVkIGFuZCBwcm9qX2Ryb3ApCiAgICAgICAgICAgICAgICBhbmQKICAgICAgICAgICAgICAgICAgICBwcmVkaWN0X2VudGl0eSh0YXJnZXRfcGFydCwgdGFyZ2V0X2VudGl0eSwgcHJval9zcGVlZCwgcHJval9kcm9wLCBjYW1wb3MpCiAgICAgICAgICAgICAgICBvcgogICAgICAgICAgICAgICAgICAgIHRhcmdldF9wYXJ0LkNGcmFtZS5wCiAgICAgICAgICAgICAgICApOlRvT3JpZW50YXRpb24oKQogICAgICAgICAgICAgICAgc2V0dXB2YWx1ZShnYXJiYWdlLnJlY29pbCwgMTMsIF9WZWN0b3IzbmV3KHBpdGNoLCB5YXcsIDApKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpKQogICAgZW5kCiAgICBsb2NhbCBfX3JhbmRvbW5hbWVjYWxsOyBfX3JhbmRvbW5hbWVjYWxsID0gaG9va21ldGFtZXRob2QoUmFuZG9tLm5ldygpLCAiX19uYW1lY2FsbCIsIG5ld2NjbG9zdXJlKExQSF9KSVRfTUFYKGZ1bmN0aW9uKHNlbGYsIC4uLikKICAgICAgICBsb2NhbCBhcmdzID0gey4uLn0KICAgICAgICBpZiBhcmdzWzFdID09IC0xMDAgYW5kIGFyZ3NbMl0gPT0gMTAwIHRoZW4KICAgICAgICAgICAgLS1wcmludChkZWJ1Zy50cmFjZWJhY2soKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHR5cGVvZihnZXRzdGFjaygzLCA0KSkgfj0gIkNGcmFtZSIgdGhlbgogICAgICAgICAgICAgICAgcHJpbnQoInBhc3RpbmcgaGFzIGZhaWxlZC4uLiIsIHR5cGVvZihnZXRzdGFjaygzLCA0KSkpCiAgICAgICAgICAgICAgICByZXR1cm4gX19yYW5kb21uYW1lY2FsbChzZWxmLCAuLi4pCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBtb2R1bGVjb21tLmVuYWJsZWQgYW5kIG1vZHVsZWNvbW0uc2lsZW50IGFuZCB0YXJnZXRfcGFydCBhbmQgdGFyZ2V0X2VudGl0eSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBndW5pbmZvICAgID0gdHJpZGVudC5ndW5pbmZvCiAgICAgICAgICAgICAgICBsb2NhbCBwcm9qX3NwZWVkID0gZ3VuaW5mbyBhbmQgcmF3Z2V0KGd1bmluZm8sICJQcm9qZWN0aWxlU3BlZWQiKQogICAgICAgICAgICAgICAgbG9jYWwgcHJval9kcm9wICA9IGd1bmluZm8gYW5kIHJhd2dldChndW5pbmZvLCAiUHJvamVjdGlsZURyb3AiKSBvciAwCgogICAgICAgICAgICAgICAgaWYgZ3VuaW5mbyBhbmQgcHJval9zcGVlZCBhbmQgcHJval9kcm9wIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBtb2R1bGVjb21tLnNpbXVsYXRpb25fcG9zIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbG9va3RvID0gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlY29tbS5zaW11bGF0aW9uX3BvcyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfVmVjdG9yM25ldygwLCBwcmVkaWN0X2Ryb3BfcG9zaXRpb24obW9kdWxlY29tbS5zaW11bGF0aW9uX3BvcywgcHJval9zcGVlZCwgcHJval9kcm9wLCBDYW1lcmEuQ0ZyYW1lLnApLCAwKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIC0tY3JlYXRlX2Nvb2xfYmVhbShDYW1lcmEuQ0ZyYW1lLnAsIGxvb2t0bywgQ29sb3IzLm5ldygxLDAsMCksIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAtLXZpc3VhbGl6ZV9idWxsZXRfcGF0aChDRnJhbWUubG9va0F0KENhbWVyYS5DRnJhbWUucCwgbG9va3RvKSwgbW9kdWxlY29tbS5zaW11bGF0aW9uX3BvcywgcHJval9zcGVlZCwgcHJval9kcm9wLCBDb2xvcjMubmV3KDEsMSwxKSwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgc2V0c3RhY2soMywgNCwgQ0ZyYW1lLmxvb2tBdChDYW1lcmEuQ0ZyYW1lLnAsIGxvb2t0bykpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX3JhbmRvbW5hbWVjYWxsKHNlbGYsIC4uLikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBvcmlnaW4gPSBtYW5pcHVsYXRpb25fcG9zIGFuZCBtYW5pcHVsYXRpb25fcG9zIG9yIENhbWVyYS5DRnJhbWUucAogICAgICAgICAgICAgICAgICAgIHNldHN0YWNrKDMsIDQsIENGcmFtZS5sb29rQXQob3JpZ2luLAogICAgICAgICAgICAgICAgICAgICAgICBwcmVkaWN0X2VudGl0eSh0YXJnZXRfcGFydCwgdGFyZ2V0X2VudGl0eSwgcHJval9zcGVlZCwgcHJval9kcm9wLCBvcmlnaW4pCiAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgbW9kdWxlY29tbS5ub3NwcmVhZCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBndW5pbmZvID0gdHJpZGVudC5ndW5pbmZvCiAgICAgICAgICAgICAgICBsb2NhbCBwZWxsZXRzID0gZ3VuaW5mbyBhbmQgcmF3Z2V0KGd1bmluZm8sICJQZWxsZXRzIikKICAgICAgICAgICAgICAgIGlmIGd1bmluZm8gYW5kIHBlbGxldHMgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfX3JhbmRvbW5hbWVjYWxsKHNlbGYsIC1wZWxsZXRzIC8gMTAwMDAsIHBlbGxldHMgLyAxMDAwMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcmV0dXJuIF9fcmFuZG9tbmFtZWNhbGwoc2VsZiwgLTEgLyAxMDAwMCwgMSAvIDEwMDAwKQogICAgICAgICAgICBlbmQKCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIF9fcmFuZG9tbmFtZWNhbGwoc2VsZiwgLi4uKQogICAgZW5kKSkpCiAgICAtLVtbbG9jYWwgZ2FtZV9SdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIik7CiAgICBsb2NhbCBfX3J1bnNlcnZpY2VpbmRleDsgX19ydW5zZXJ2aWNlaW5kZXggPSBob29rbWV0YW1ldGhvZChnYW1lX1J1blNlcnZpY2UsICJfX2luZGV4IiwgbmV3Y2Nsb3N1cmUoZnVuY3Rpb24oc2VsZiwga2V5KQogICAgICAgIGlmIGtleSA9PSAiUmVuZGVyU3RlcHBlZCIgYW5kIG1vZHVsZWNvbW0uaW5zdGFudCBhbmQgKGRlYnVnLmlzdmFsaWRsZXZlbCg3KSBhbmQgZGVidWcuZ2V0aW5mbyg3KS5uYW1lID09ICJjcmVhdGVQcm9qZWN0aWxlIikgdGhlbgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgQ29ubmVjdCA9IGZ1bmN0aW9uKHNlbGZjb25uZWN0LCBmdW5jY29ubmVjdCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBndW5pbmZvLCBpbnN0YW50X3RpbWUgPSB0cmlkZW50Lmd1bmluZm8sIG5pbAogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldF9wYXJ0IGFuZCB0YXJnZXRfZW50aXR5IGFuZCBndW5pbmZvIGFuZCBndW5pbmZvLlByb2plY3RpbGVTcGVlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbnRfdGltZSA9IHByZWRpY3RfdGltZSh0YXJnZXRfcGFydCwgdGFyZ2V0X2VudGl0eSwgZ3VuaW5mby5Qcm9qZWN0aWxlU3BlZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCd3b3cnLCBpbnN0YW50X3RpbWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgnZmFpbC4uLicsIG5vdCBub3QgKHRhcmdldF9wYXJ0IGFuZCB0YXJnZXRfZW50aXR5IGFuZCBndW5pbmZvIGFuZCBndW5pbmZvLlByb2plY3RpbGVTcGVlZCkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29ubmVjdGlvbjsgY29ubmVjdGlvbiA9IGdhbWVfUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oZGVsdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmNjb25uZWN0KGluc3RhbnRfdGltZSBvciBkZWx0YSkKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtEaXNjb25uZWN0ID0gZnVuY3Rpb24oKWlmIGNvbm5lY3Rpb24gdGhlbiBjb25uZWN0aW9uOkRpc2Nvbm5lY3QoKSBlbmQgZW5kfQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIH0KICAgICAgICBlbmQKICAgICAgICByZXR1cm4gX19ydW5zZXJ2aWNlaW5kZXgoc2VsZiwga2V5KQogICAgZW5kKSldXQplbmQKCmRvCiAgICBsb2NhbCB2YWxpZGNoYXJhY3RlcnMgPSB7fQogICAgbG9jYWwgaGJjLCBvcmlnaW5hbF9zaXplLCBoYnNpemUgPSBuaWwsIHRyaWRlbnQub3JpZ2luYWxfbW9kZWwuVG9yc28uU2l6ZSwgX1ZlY3RvcjNuZXcoMC41LCAxLCAwLjUpCiAgICBsb2NhbCBkeW5hbWljLCBhbHdheXNoZWFkID0gZmFsc2UsIGZhbHNlCiAgICBsb2NhbCBoaXRib3hoZWFkc2l6ZXgsIGhpdGJveGhlYWRzaXpleSwgaGl0Ym94aGVhZHRyYW5zcGFyZW5jeSwgY2FuY29sbGlkZSA9IDEwLCAxMCwgMC41LCBmYWxzZQogICAgbG9jYWwgZnVuY3Rpb24gYWRkdG92YyhvYmopCiAgICAgICAgaWYgbm90IG9iaiB0aGVuIHJldHVybiBlbmQKICAgICAgICBpZiBub3Qgb2JqOkZpbmRGaXJzdENoaWxkKCJIZWFkIikgYW5kIG5vdCBvYmo6RmluZEZpcnN0Q2hpbGQoIkxvd2VyVG9yc28iKSB0aGVuIHJldHVybiBlbmQKICAgICAgICB2YWxpZGNoYXJhY3RlcnNbb2JqXSA9IG9iagogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gcmVtb3ZlZnJvbXZjKG9iaikKICAgICAgICBpZiBub3QgdmFsaWRjaGFyYWN0ZXJzW29ial0gdGhlbiByZXR1cm4gZW5kCiAgICAgICAgdmFsaWRjaGFyYWN0ZXJzW29ial0gPSBuaWwKICAgIGVuZAoKICAgIGZvciBpLCB2IGluIG5leHQsIHdvcmtzcGFjZTpHZXRDaGlsZHJlbigpIGRvIGFkZHRvdmModikgZW5kCiAgICB3b3Jrc3BhY2UuQ2hpbGRBZGRlZDpDb25uZWN0KGFkZHRvdmMpOwogICAgd29ya3NwYWNlLkNoaWxkUmVtb3ZlZDpDb25uZWN0KHJlbW92ZWZyb212Yyk7CgogICAgbG9jYWwgaGJiID0gdWkuYm94LmFpbWJvdDpBZGRUYWIoImhpdGJveCIpCiAgICBoYmI6QWRkVG9nZ2xlKCdoaXRib3hfZW5hYmxlZCcsIHsKICAgICAgICBUZXh0ID0gJ2hpdGJveCBleHBhbmRlcicsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIG1vZHVsZWNvbW0uaGl0Ym94ZXMgPSB2YWx1ZQogICAgICAgICAgICBpZiBoYmMgdGhlbiBoYmM6RGlzY29ubmVjdCgpIGVuZAogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBoYmMgPSBjaGVhdC51dGlsaXR5Lm5ld19oZWFydGJlYXQoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRyYW5zID0gaGl0Ym94aGVhZHRyYW5zcGFyZW5jeQogICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHZhbGlkY2hhcmFjdGVycyBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwcmltcGFydCA9IHYgYW5kIF9GaW5kRmlyc3RDaGlsZCh2LCAnVG9yc28nKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBwcmltcGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmltcGFydC5TaXplID0gaGJzaXplCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmltcGFydC5UcmFuc3BhcmVuY3kgPSB0cmFucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbXBhcnQuQ2FuQ29sbGlkZSA9IGNhbmNvbGxpZGUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIGhiYyB0aGVuIGhiYzpEaXNjb25uZWN0KCkgZW5kCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiB2YWxpZGNoYXJhY3RlcnMgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwcmltcGFydCA9IHYgYW5kIF9GaW5kRmlyc3RDaGlsZCh2LCAnVG9yc28nKQogICAgICAgICAgICAgICAgICAgIGlmIHByaW1wYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbXBhcnQuU2l6ZSA9IG9yaWdpbmFsX3NpemUKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbXBhcnQuVHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgICAgICAgICBwcmltcGFydC5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKICAgIGhiYjpBZGRUb2dnbGUoJ2hpdGJveF9jYW5jb2xsaWRlJyx7VGV4dCA9ICdjYW4gY29sbGlkZScsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24odikKICAgICAgICBjYW5jb2xsaWRlID0gdgogICAgZW5kfSkKICAgIGhiYjpBZGRTbGlkZXIoJ2hpdGJveF9oZWFkX3RyYW5zcGFyZW5jeScsIHsgVGV4dCA9ICd0cmFuc3BhcmVuY3knLCBEZWZhdWx0ID0gMC41LCBNaW4gPSAwLCBNYXggPSAxLCBSb3VuZGluZyA9IDEsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgaGl0Ym94aGVhZHRyYW5zcGFyZW5jeSA9IFN0YXRlCiAgICBlbmQpCiAgICBoYmI6QWRkU2xpZGVyKCdoaXRib3hfaGVhZF9zaXplX3gnLCB7IFRleHQgPSAnc2l6ZSB4JywgRGVmYXVsdCA9IDEwLCBNaW4gPSAxLCBNYXggPSAxMDAwLCBSb3VuZGluZyA9IDEsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgaGl0Ym94aGVhZHNpemV4ID0gU3RhdGUKICAgICAgICBoYnNpemUgPSBfVmVjdG9yM25ldyhoaXRib3hoZWFkc2l6ZXgsIGhpdGJveGhlYWRzaXpleSwgaGl0Ym94aGVhZHNpemV4KQogICAgZW5kKQogICAgaGJiOkFkZFNsaWRlcignaGl0Ym94X2hlYWRfc2l6ZV95JywgeyBUZXh0ID0gJ3NpemUgeScsIERlZmF1bHQgPSAxMCwgTWluID0gMSwgTWF4ID0gMjUsIFJvdW5kaW5nID0gMSwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBoaXRib3hoZWFkc2l6ZXkgPSBTdGF0ZQogICAgICAgIGhic2l6ZSA9IF9WZWN0b3IzbmV3KGhpdGJveGhlYWRzaXpleCwgaGl0Ym94aGVhZHNpemV5LCBoaXRib3hoZWFkc2l6ZXgpCiAgICBlbmQpCmVuZApkbwogICAgbG9jYWwgZXNwYiA9IHVpLmJveC5lc3A6QWRkVGFiKCJwbGF5ZXIgZXNwIikKICAgIGxvY2FsIGVzID0gY2hlYXQuRXNwTGlicmFyeS5zZXR0aW5ncy5lbmVteQogICAgZXNwYjpBZGREcm9wZG93bignZXNwZm9udCcsIHtWYWx1ZXMgPSB7ICdVSScsICdTeXN0ZW0nLCAnUGxleCcsICdNb25vc3BhY2UnIH0sRGVmYXVsdCA9IDEsTXVsdGkgPSBmYWxzZSxUZXh0ID0gJ2VzcCBmb250JyxUb29sdGlwID0gJ3NlbGVjdCBmb250JyxDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGNoZWF0LkVzcExpYnJhcnkubWFpbl9zZXR0aW5ncy50ZXh0Rm9udCA9IERyYXdpbmcuRm9udHNbVmFsdWVdCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICBlbmR9KQogICAgZXNwYjpBZGRTbGlkZXIoJ2VzcGZvbnRzaXplJywgeyBUZXh0ID0gJ2VzcCBmb250IHNpemUnLCBEZWZhdWx0ID0gMTMsIE1pbiA9IDEsIE1heCA9IDMwLCBSb3VuZGluZyA9IDAsIENvbXBhY3QgPSB0cnVlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5Lm1haW5fc2V0dGluZ3MudGV4dFNpemUgPSBTdGF0ZQogICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgZW5kKQogICAgZXNwYjpBZGRUb2dnbGUoJ2VzcHNpbXBsZWNhbGMnLCB7CiAgICAgICAgVGV4dCA9ICdzaW1wbGVyIGNvcm5lciBjYWxjIChmcHMpJywKICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5tYWluX3NldHRpbmdzLnNpbXBsZWNhbGMgPSBmaXJzdAogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICBlbmQKICAgIH0pCiAgICBlc3BiOkFkZFRvZ2dsZSgnZXNwc3dpdGNoJywgewogICAgICAgIFRleHQgPSAnZW5hYmxlIGVzcCcsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgICAgIGVzLmVuYWJsZWQgPSBmaXJzdAogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICBlbmQKICAgIH0pCiAgICBlc3BiOkFkZFRvZ2dsZSgnZXNwdGVhbXN3aXRjaCcsIHsKICAgICAgICBUZXh0ID0gJ3RlYW0vYWkgY2hlY2snLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5Lm1haW5fc2V0dGluZ3MudGVhbWNoZWNrID0gZmlyc3QKICAgICAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICAgICAgZW5kCiAgICB9KQogICAgZXNwYjpBZGRUb2dnbGUoJ2VzcHNsZWVwZXJzd2l0Y2gnLCB7CiAgICAgICAgVGV4dCA9ICdzbGVlcGVyIGNoZWNrJywKICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5tYWluX3NldHRpbmdzLnNsZWVwY2hlY2sgPSBmaXJzdAogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICBlbmQKICAgIH0pCiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBlc3BiOkFkZFRvZ2dsZSgnZXNwYm94JywgewogICAgICAgIFRleHQgPSAnYm94IGVzcCcsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgICAgIGVzLmJveCA9IGZpcnN0CiAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgIGVuZAogICAgfSk6QWRkQ29sb3JQaWNrZXIoJ2VzcGJveGNvbG9yJywgewogICAgICAgIERlZmF1bHQgPSBDb2xvcjMubmV3KDEsIDEsIDEpLAogICAgICAgIFRpdGxlID0gJ2JveCBjb2xvcicsCiAgICAgICAgVHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICBlcy5ib3hfY29sb3JbMV0gPSBWYWx1ZQogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICBlbmQKICAgIH0pCiAgICAtLS0KICAgIGVzcGI6QWRkVG9nZ2xlKCdlc3Bib3hmaWxsJywgewogICAgICAgIFRleHQgPSAnYm94IGZpbGwnLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBlcy5ib3hfZmlsbCA9IGZpcnN0CiAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgIGVuZAogICAgfSk6QWRkQ29sb3JQaWNrZXIoJ2VzcGJveGZpbGxjb2xvcicsCiAgICAgICAgewogICAgICAgICAgICBEZWZhdWx0ID0gQ29sb3IzLm5ldygxLCAxLCAxKSwKICAgICAgICAgICAgVGl0bGUgPSAnYm94IGZpbGwgY29sb3InLAogICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAwLAogICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgZXMuYm94X2ZpbGxfY29sb3JbMV0gPSBWYWx1ZQogICAgICAgICAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICAgICAgICAgIGVuZAogICAgICAgIH0pCiAgICAtLS0KICAgIGVzcGI6QWRkVG9nZ2xlKCdlc3BvdXRsaW5lYm94JywgewogICAgICAgIFRleHQgPSAnYm94IG91dGxpbmUnLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBlcy5ib3hfb3V0bGluZSA9IGZpcnN0CiAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgIGVuZAogICAgfSk6QWRkQ29sb3JQaWNrZXIoJ2VzcGJveG91dGxpbmVjb2xvcicsCiAgICAgICAgewogICAgICAgICAgICBEZWZhdWx0ID0gQ29sb3IzLm5ldygpLAogICAgICAgICAgICBUaXRsZSA9ICdib3ggb3V0bGluZSBjb2xvcicsCiAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBlcy5ib3hfb3V0bGluZV9jb2xvclsxXSA9IFZhbHVlCiAgICAgICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgfSkKICAgIC0tLQogICAgZXNwYjpBZGRTbGlkZXIoJ2VzcGJveHRyYW5zcGFyZW5jeScsCiAgICAgICAgeyBUZXh0ID0gJ2JveCB0cmFuc3BhcmVuY3knLCBEZWZhdWx0ID0gMCwgTWluID0gMCwgTWF4ID0gMSwgUm91bmRpbmcgPSAxLCBDb21wYWN0ID0gZmFsc2UgfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKAogICAgICAgIFN0YXRlKQogICAgICAgIGVzLmJveF9jb2xvclsyXSA9IDEtU3RhdGUKICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgIGVuZCkKICAgIGVzcGI6QWRkU2xpZGVyKCdlc3BvdXRsaW5lYm94dHJhbnNwYXJlbmN5JywKICAgICAgICB7IFRleHQgPSAnYm94IG91dGxpbmUgdHJhbnNwYXJlbmN5JywgRGVmYXVsdCA9IDAsIE1pbiA9IDAsIE1heCA9IDEsIFJvdW5kaW5nID0gMSwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbigKICAgICAgICBTdGF0ZSkKICAgICAgICBlcy5ib3hfb3V0bGluZV9jb2xvclsyXSA9IFN0YXRlCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICBlbmQpCiAgICBlc3BiOkFkZFNsaWRlcignZXNwYm94ZmlsbHRyYW5zcGFyZW5jeScsCiAgICAgICAgeyBUZXh0ID0gJ2JveCBmaWxsIHRyYW5zcGFyZW5jeScsIERlZmF1bHQgPSAwLjUsIE1pbiA9IDAsIE1heCA9IDEsIFJvdW5kaW5nID0gMSwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbigKICAgICAgICBTdGF0ZSkKICAgICAgICBlcy5ib3hfZmlsbF9jb2xvclsyXSA9IDEtU3RhdGUKICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgIGVuZCkKICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGVzcGI6QWRkVG9nZ2xlKCdlc3ByZWFsbmFtZScsIHsKICAgICAgICBUZXh0ID0gJ25hbWUgZXNwJywKICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICAgICAgZXMucmVhbG5hbWUgPSBmaXJzdAogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICBlbmQKICAgIH0pOkFkZENvbG9yUGlja2VyKCdlc3ByZWFsbmFtZWNvbG9yJywKICAgICAgICB7CiAgICAgICAgICAgIERlZmF1bHQgPSBDb2xvcjMubmV3KDEsIDEsIDEpLAogICAgICAgICAgICBUaXRsZSA9ICduYW1lIGNvbG9yJywKICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgIGVzLnJlYWxuYW1lX2NvbG9yWzFdID0gVmFsdWUKICAgICAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgICAgICBlbmQKICAgICAgICB9KQogICAgZXNwYjpBZGRTbGlkZXIoJ2VzcHJlYWxuYW1ldHJhbnNwYXJlbmN5JywKICAgICAgICB7IFRleHQgPSAnbmFtZSB0cmFuc3BhcmVuY3knLCBEZWZhdWx0ID0gMCwgTWluID0gMCwgTWF4ID0gMSwgUm91bmRpbmcgPSAxLCBDb21wYWN0ID0gZmFsc2UgfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKAogICAgICAgIFN0YXRlKQogICAgICAgIGVzLnJlYWxuYW1lX2NvbG9yWzJdID0gMS1TdGF0ZQogICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgZW5kKQogICAgLS0tCiAgICBlc3BiOkFkZFRvZ2dsZSgnZXNwcmVhbG5hbWVvdXRsaW5lJywgewogICAgICAgIFRleHQgPSAnbmFtZSBvdXRsaW5lJywKICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICAgICAgZXMucmVhbG5hbWVfb3V0bGluZSA9IGZpcnN0CiAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgIGVuZAogICAgfSk6QWRkQ29sb3JQaWNrZXIoJ2VzcHJlYWxuYW1lb3V0bGluZWNvbG9yJywKICAgICAgICB7CiAgICAgICAgICAgIERlZmF1bHQgPSBDb2xvcjMubmV3KCksCiAgICAgICAgICAgIFRpdGxlID0gJ25hbWUgb3V0bGluZSBjb2xvcicsCiAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBlcy5yZWFsbmFtZV9vdXRsaW5lX2NvbG9yID0gVmFsdWUKICAgICAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgICAgICBlbmQKICAgICAgICB9KQoKICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGVzcGI6QWRkVG9nZ2xlKCdlc3BkaXN0YW5jZScsIHsKICAgICAgICBUZXh0ID0gJ2Rpc3RhbmNlIGVzcCcsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgICAgIGVzLmRpc3QgPSBmaXJzdAogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICBlbmQKICAgIH0pOkFkZENvbG9yUGlja2VyKCdlc3BkaXN0YW5jZWNvbG9yJywKICAgICAgICB7CiAgICAgICAgICAgIERlZmF1bHQgPSBDb2xvcjMubmV3KDEsIDEsIDEpLAogICAgICAgICAgICBUaXRsZSA9ICdkaXN0YW5jZSBjb2xvcicsCiAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBlcy5kaXN0X2NvbG9yWzFdID0gVmFsdWUKICAgICAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgICAgICBlbmQKICAgICAgICB9KQogICAgZXNwYjpBZGRTbGlkZXIoJ2VzcGRpc3RhbmNldHJhbnNwYXJlbmN5JywKICAgICAgICB7IFRleHQgPSAnZGlzdGFuY2UgdHJhbnNwYXJlbmN5JywgRGVmYXVsdCA9IDAsIE1pbiA9IDAsIE1heCA9IDEsIFJvdW5kaW5nID0gMSwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbigKICAgICAgICBTdGF0ZSkKICAgICAgICBlcy5kaXN0X2NvbG9yWzJdID0gMS1TdGF0ZQogICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgZW5kKQogICAgLS0tCiAgICBlc3BiOkFkZFRvZ2dsZSgnZXNwZGlzdGFuY2VvdXRsaW5lJywgewogICAgICAgIFRleHQgPSAnZGlzdGFuY2Ugb3V0bGluZScsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgICAgIGVzLmRpc3Rfb3V0bGluZSA9IGZpcnN0CiAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgIGVuZAogICAgfSk6QWRkQ29sb3JQaWNrZXIoJ2VzcGRpc3RhbmNlb3V0bGluZWNvbG9yJywKICAgICAgICB7CiAgICAgICAgICAgIERlZmF1bHQgPSBDb2xvcjMubmV3KCksCiAgICAgICAgICAgIFRpdGxlID0gJ2Rpc3RhbmNlIG91dGxpbmUgY29sb3InLAogICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAwLAogICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgZXMuZGlzdF9vdXRsaW5lX2NvbG9yID0gVmFsdWUKICAgICAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgICAgICBlbmQKICAgICAgICB9KQogICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZXNwYjpBZGRUb2dnbGUoJ2VzcHdlYXBvbicsIHsKICAgICAgICBUZXh0ID0gJ3dlYXBvbiBlc3AnLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBlcy53ZWFwb24gPSBmaXJzdAogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICBlbmQKICAgIH0pOkFkZENvbG9yUGlja2VyKCdlc3B3ZWFwb25jb2xvcicsCiAgICAgICAgewogICAgICAgICAgICBEZWZhdWx0ID0gQ29sb3IzLm5ldygxLCAxLCAxKSwKICAgICAgICAgICAgVGl0bGUgPSAnd2VhcG9uIGNvbG9yJywKICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgIGVzLndlYXBvbl9jb2xvclsxXSA9IFZhbHVlCiAgICAgICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgfSkKICAgIGVzcGI6QWRkU2xpZGVyKCdlc3B3ZWFwb250cmFuc3BhcmVuY3knLAogICAgICAgIHsgVGV4dCA9ICd3ZWFwb24gdHJhbnNwYXJlbmN5JywgRGVmYXVsdCA9IDAsIE1pbiA9IDAsIE1heCA9IDEsIFJvdW5kaW5nID0gMSwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbigKICAgICAgICBTdGF0ZSkKICAgICAgICBlcy53ZWFwb25fY29sb3JbMl0gPSAxLVN0YXRlCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICBlbmQpCiAgICAtLS0KICAgIGVzcGI6QWRkVG9nZ2xlKCdlc3B3ZWFwb25vdXRsaW5lJywgewogICAgICAgIFRleHQgPSAnd2VhcG9uIG91dGxpbmUnLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBlcy53ZWFwb25fb3V0bGluZSA9IGZpcnN0CiAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgIGVuZAogICAgfSk6QWRkQ29sb3JQaWNrZXIoJ2VzcHdlYXBvbm91dGxpbmVjb2xvcicsCiAgICAgICAgewogICAgICAgICAgICBEZWZhdWx0ID0gQ29sb3IzLm5ldygpLAogICAgICAgICAgICBUaXRsZSA9ICd3ZWFwb24gb3V0bGluZSBjb2xvcicsCiAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBlcy53ZWFwb25fb3V0bGluZV9jb2xvciA9IFZhbHVlCiAgICAgICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgfSkKICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGVzcGI6QWRkVG9nZ2xlKCdlc3Bza2VsZXRvbicsIHtUZXh0ID0gJ3NrZWxldG9uIGVzcCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgZXMuc2tlbGV0b24gPSBmaXJzdAogICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgZW5kfSk6QWRkQ29sb3JQaWNrZXIoJ2VzcHNrZWxldG9uY29sb3InLCB7RGVmYXVsdCA9IENvbG9yMy5uZXcoMSwgMSwgMSksVGl0bGUgPSAnc2tlbGV0b24gY29sb3InLFRyYW5zcGFyZW5jeSA9IDAsQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBlcy5za2VsZXRvbl9jb2xvclsxXSA9IFZhbHVlCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICBlbmR9KQogICAgZXNwYjpBZGRTbGlkZXIoJ2VzcHNrZWxldG9udHJhbnNwYXJlbmN5JywgeyBUZXh0ID0gJ3NrZWxldG9uIHRyYW5zcGFyZW5jeScsIERlZmF1bHQgPSAwLCBNaW4gPSAwLCBNYXggPSAxLCBSb3VuZGluZyA9IDEsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgZXMuc2tlbGV0b25fY29sb3JbMl0gPSAxLVN0YXRlCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICBlbmQpCiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBlc3BiOkFkZFRvZ2dsZSgnZXNwY2hhbXMnLCB7CiAgICAgICAgVGV4dCA9ICdjaGFtcycsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgICAgIGVzLmNoYW1zID0gZmlyc3QKICAgICAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICAgICAgZW5kCiAgICB9KQogICAgZXNwYjpBZGRUb2dnbGUoJ2VzcGNoYW1zdmlzaWJsZW9ubHknLCB7CiAgICAgICAgVGV4dCA9ICdjaGFtcyB2aXNpYmxlIG9ubHknLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBlcy5jaGFtc192aXNpYmxlX29ubHkgPSBmaXJzdAogICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICBlbmQKICAgIH0pCiAgICAtLS0KICAgIGVzcGI6QWRkTGFiZWwoImNoYW1zIGZpbGwgY29sb3IiKTpBZGRDb2xvclBpY2tlcignZXNwY2hhbXNmaWxsY29sb3InLAogICAgICAgIHsKICAgICAgICAgICAgRGVmYXVsdCA9IENvbG9yMy5uZXcoKSwKICAgICAgICAgICAgVGl0bGUgPSAnY2hhbXMgZmlsbCBjb2xvcicsCiAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBlcy5jaGFtc19maWxsX2NvbG9yWzFdID0gVmFsdWUKICAgICAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgICAgICBlbmQKICAgICAgICB9KQogICAgZXNwYjpBZGRMYWJlbCgiY2hhbXMgb3V0bGluZSBjb2xvciIpOkFkZENvbG9yUGlja2VyKCdlc3BjaGFtc291dGxpbmVjb2xvcicsCiAgICAgICAgewogICAgICAgICAgICBEZWZhdWx0ID0gQ29sb3IzLm5ldygpLAogICAgICAgICAgICBUaXRsZSA9ICdjaGFtcyBvdXRsaW5lIGNvbG9yJywKICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgIGVzLmNoYW1zb3V0bGluZV9jb2xvclsxXSA9IFZhbHVlCiAgICAgICAgICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgfSkKICAgIC0tLQogICAgZXNwYjpBZGRTbGlkZXIoJ2VzcGNoYW1zZmlsbHRyYW5zcGFyZW5jeScsCiAgICAgICAgeyBUZXh0ID0gJ2ZpbGwgdHJhbnNwYXJlbmN5JywgRGVmYXVsdCA9IDAuNSwgTWluID0gMCwgTWF4ID0gMSwgUm91bmRpbmcgPSAxLCBDb21wYWN0ID0gZmFsc2UgfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKAogICAgICAgIFN0YXRlKQogICAgICAgIGVzLmNoYW1zX2ZpbGxfY29sb3JbMl0gPSBTdGF0ZQogICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgZW5kKQogICAgZXNwYjpBZGRTbGlkZXIoJ2VzcGNoYW1zb3V0bGluZXRyYW5zcGFyZW5jeScsCiAgICAgICAgeyBUZXh0ID0gJ291dGxpbmUgdHJhbnNwYXJlbmN5JywgRGVmYXVsdCA9IDAsIE1pbiA9IDAsIE1heCA9IDEsIFJvdW5kaW5nID0gMSwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbigKICAgICAgICBTdGF0ZSkKICAgICAgICBlcy5jaGFtc291dGxpbmVfY29sb3JbMl0gPSBTdGF0ZQogICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgZW5kKQogICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQplbmQKZG8KICAgIGxvY2FsIGVzcGIgPSB1aS5ib3guZXNwOkFkZFRhYigib2JqZWN0IGVzcCIpCiAgICBsb2NhbCBlcyA9IGNoZWF0LkVzcExpYnJhcnkuc2V0dGluZ3Mub2JqZWN0CiAgICBlc3BiOkFkZERyb3Bkb3duKCdvYmplY3Rlc3Bmb250Jywge1ZhbHVlcyA9IHsgJ1VJJywgJ1N5c3RlbScsICdQbGV4JywgJ01vbm9zcGFjZScgfSxEZWZhdWx0ID0gMSxNdWx0aSA9IGZhbHNlLFRleHQgPSAnZXNwIGZvbnQnLFRvb2x0aXAgPSAnc2VsZWN0IGZvbnQnLENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5tYWluX29iamVjdF9zZXR0aW5ncy50ZXh0Rm9udCA9IERyYXdpbmcuRm9udHNbVmFsdWVdCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICBlbmR9KQogICAgZXNwYjpBZGRTbGlkZXIoJ29iamVjdGVzcGZvbnRzaXplJywgeyBUZXh0ID0gJ2VzcCBmb250IHNpemUnLCBEZWZhdWx0ID0gMTMsIE1pbiA9IDEsIE1heCA9IDMwLCBSb3VuZGluZyA9IDAsIENvbXBhY3QgPSB0cnVlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5Lm1haW5fb2JqZWN0X3NldHRpbmdzLnRleHRTaXplID0gU3RhdGUKICAgICAgICBjaGVhdC5Fc3BMaWJyYXJ5LmljYWNhKCkKICAgIGVuZCkKICAgIGVzcGI6QWRkRHJvcGRvd24oJ29iamVjdGVzcGFsbG93ZWQnLCB7VmFsdWVzID0gewogICAgICAgICdBVFYnLCAnU3RvbmUnLCAnTml0cmF0ZScsICdJcm9uJywgJ0JhY2twYWNrJywKICAgICAgICAnVHJlZTEnLCAnVHJlZTInLCAnVHJlZTMnLCAnVHJlZTQnLAogICAgICAgICdUZXNsYVB5bG9uJywgJ0dhc1RyYXAnLCAnQ2xhaW1Ub3RlbScKICAgIH0sRGVmYXVsdCA9IDAsTXVsdGkgPSB0cnVlLFRleHQgPSAnb2JqZWN0cycsVG9vbHRpcCA9ICdzZWxlY3Qgb2JqZWN0cyB0aGF0cyBnb25uYSBzaG93IHVwJyxDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGNoZWF0LkVzcExpYnJhcnkubWFpbl9vYmplY3Rfc2V0dGluZ3MuYWxsb3dlZCA9IFZhbHVlCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICBlbmR9KQogICAgZXNwYjpBZGRUb2dnbGUoJ29iamVjdGVzcHN3aXRjaCcsIHsKICAgICAgICBUZXh0ID0gJ2VuYWJsZSBlc3AnLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBlcy5lbmFibGVkID0gZmlyc3QKICAgICAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICAgICAgZW5kCiAgICB9KQogICAgZXNwYjpBZGRUb2dnbGUoJ29iamVjdGVzcGFsbHN3aXRjaCcsIHsKICAgICAgICBUZXh0ID0gJ2VzcCBvbiBmdWNraW5nIGV2ZXJ5dGhpbmcgYXBwYXJlbnRseT8/Pz8nLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBlcy5hbGxlbmFibGVkID0gZmlyc3QKICAgICAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICAgICAgZW5kCiAgICB9KQogICAgZXNwYjpBZGRUb2dnbGUoJ29iamVjdGVzcHJlYWxuYW1lJywgewogICAgICAgIFRleHQgPSAnbmFtZSBlc3AnLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBlcy5yZWFsbmFtZSA9IGZpcnN0CiAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgIGVuZAogICAgfSk6QWRkQ29sb3JQaWNrZXIoJ29iamVjdGVzcHJlYWxuYW1lY29sb3InLAogICAgICAgIHsKICAgICAgICAgICAgRGVmYXVsdCA9IENvbG9yMy5uZXcoMSwgMSwgMSksCiAgICAgICAgICAgIFRpdGxlID0gJ25hbWUgY29sb3InLAogICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAwLAogICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgZXMucmVhbG5hbWVfY29sb3JbMV0gPSBWYWx1ZQogICAgICAgICAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICAgICAgICAgIGVuZAogICAgICAgIH0pCiAgICBlc3BiOkFkZFNsaWRlcignb2JqZWN0ZXNwcmVhbG5hbWV0cmFuc3BhcmVuY3knLAogICAgICAgIHsgVGV4dCA9ICduYW1lIHRyYW5zcGFyZW5jeScsIERlZmF1bHQgPSAwLCBNaW4gPSAwLCBNYXggPSAxLCBSb3VuZGluZyA9IDEsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oCiAgICAgICAgU3RhdGUpCiAgICAgICAgZXMucmVhbG5hbWVfY29sb3JbMl0gPSAxLVN0YXRlCiAgICAgICAgY2hlYXQuRXNwTGlicmFyeS5pY2FjYSgpCiAgICBlbmQpCiAgICBlc3BiOkFkZFRvZ2dsZSgnb2JqZWN0ZXNwcmVhbG5hbWVvdXRsaW5lJywgewogICAgICAgIFRleHQgPSAnbmFtZSBvdXRsaW5lJywKICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICAgICAgZXMucmVhbG5hbWVfb3V0bGluZSA9IGZpcnN0CiAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgIGVuZAogICAgfSk6QWRkQ29sb3JQaWNrZXIoJ29iamVjdGVzcHJlYWxuYW1lb3V0bGluZWNvbG9yJywKICAgICAgICB7CiAgICAgICAgICAgIERlZmF1bHQgPSBDb2xvcjMubmV3KCksCiAgICAgICAgICAgIFRpdGxlID0gJ25hbWUgb3V0bGluZSBjb2xvcicsCiAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBlcy5yZWFsbmFtZV9vdXRsaW5lX2NvbG9yID0gVmFsdWUKICAgICAgICAgICAgICAgIGNoZWF0LkVzcExpYnJhcnkuaWNhY2EoKQogICAgICAgICAgICBlbmQKICAgICAgICB9KQplbmQKbG9jYWwgY2FudXNlaW1hZ2VzID0gcGNhbGwoZnVuY3Rpb24oKQogICAgY2hlYXQudXRpbGl0eS5uZXdfZHJhd2luZygiSW1hZ2UiLCB7fSk6UmVtb3ZlKCkKZW5kKSBhbmQgcGNhbGwoZnVuY3Rpb24oKQogICAgbG9jYWwgYSA9IGNoZWF0LnV0aWxpdHkubmV3X2RyYXdpbmcoIkltYWdlIiwge30pCiAgICByYXdnZXQoYSwgIl9mcmFtZSIpLkltYWdlID0gIiIKICAgIGE6UmVtb3ZlKCkKZW5kKQpkbwogICAgbG9jYWwgZW5hYmxlZCwgZHluYW1pYyA9IGZhbHNlLCBmYWxzZTsKICAgIGxvY2FsIGNvbG9yMSwgY29sb3IyID0gQ29sb3IzLm5ldygxLDEsMSksIENvbG9yMy5uZXcoKTsKICAgIGxvY2FsIHdhdGVybWFya3RhYiA9IHVpLmJveC5jaGVhdHZpczpBZGRUYWIoIndhdGVybWFyayIpCiAgICBsb2NhbCB3YXRlcm1hcmt0b2dnbGUgPSB3YXRlcm1hcmt0YWI6QWRkVG9nZ2xlKCd3YXRlcm1hcmtfZW5hYmxlZCcsIHtUZXh0ID0gJ2VuYWJsZWQnLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIGVuYWJsZWQgPSBmaXJzdAogICAgZW5kfSkKICAgIHdhdGVybWFya3RvZ2dsZTpBZGRDb2xvclBpY2tlcignd2F0ZXJtYXJrX2NvbG9yMScse0RlZmF1bHQgPSBDb2xvcjMubmV3KCksVGl0bGUgPSBjYW51c2VpbWFnZXMgYW5kICdjb2xvciBsZWZ0JyBvciAnY29sb3InLFRyYW5zcGFyZW5jeSA9IDAsQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBjb2xvcjEgPSBWYWx1ZQogICAgICAgIGlmIG5vdCBjYW51c2VpbWFnZXMgdGhlbiBjb2xvcjIgPSBWYWx1ZSBlbmQKICAgIGVuZH0pCiAgICBpZiBjYW51c2VpbWFnZXMgdGhlbiB3YXRlcm1hcmt0b2dnbGU6QWRkQ29sb3JQaWNrZXIoJ3dhdGVybWFya19jb2xvcjInLHtEZWZhdWx0ID0gQ29sb3IzLm5ldygpLFRpdGxlID0gJ2NvbG9yIHJpZ2h0JyxUcmFuc3BhcmVuY3kgPSAwLENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgY29sb3IyID0gVmFsdWUKICAgIGVuZH0pOyBlbmQKICAgIHdhdGVybWFya3RhYjpBZGRUb2dnbGUoJ3dhdGVybWFya19yYWluYm93Y29sb3InLCB7VGV4dCA9ICdyYWluYm93JyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBkeW5hbWljID0gZmlyc3QKICAgIGVuZH0pCiAgICBsb2NhbCBsZWZ0Y29sb3IsIHJpZ2h0Y29sb3IsIHdhdGVydGV4dCA9IAogICAgQ29sb3IzLm5ldygwLjAwMDAwMCwgMC42NjY2NjcsIDAuMzMzMzMzKSwgCiAgICBDb2xvcjMubmV3KDAuMzQ5MDIwLCAwLjAwMDAwMCwgMS4wMDAwMDApLAogICAgInN5bnRheC54eXogY2FuYXJ5IHwgSnVsIDI4IDIwMjQgfCBmcHM6IDYzICI7CiAgICBsb2NhbCB3YXRlcnBvcyA9IFZlY3RvcjIubmV3KDEwLCAxMCk7CiAgICBsb2NhbCB0ZXh0ID0gY2hlYXQudXRpbGl0eS5uZXdfZHJhd2luZygiVGV4dCIsIHsKICAgICAgICBaSW5kZXggPSA0LAogICAgICAgIFZpc2libGUgPSB0cnVlLAogICAgICAgIFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgUG9zaXRpb24gPSB3YXRlcnBvcyArIFZlY3RvcjIubmV3KDYsIDUpLAogICAgICAgIENvbG9yID0gQ29sb3IzLm5ldygxLCAxLCAxKSwKICAgICAgICBPdXRsaW5lID0gdHJ1ZSwKICAgICAgICBPdXRsaW5lQ29sb3IgPSBDb2xvcjMubmV3KCksCiAgICAgICAgRm9udCA9IDAsCiAgICAgICAgU2l6ZSA9IDE0LAogICAgICAgIFRleHQgPSB3YXRlcnRleHQKICAgIH0pOwogICAgbG9jYWwgZ3JhZHIsIGdyYWRsID0gY2hlYXQudXRpbGl0eS5uZXdfZHJhd2luZyhjYW51c2VpbWFnZXMgYW5kICJJbWFnZSIgb3IgIlNxdWFyZSIsIHsKICAgICAgICBaSW5kZXggPSAyLAogICAgICAgIFZpc2libGUgPSB0cnVlLAogICAgICAgIFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgUG9zaXRpb24gPSB3YXRlcnBvcywKICAgICAgICBTaXplID0gVmVjdG9yMi5uZXcodGV4dC5UZXh0Qm91bmRzLlggKyAxMCwgdGV4dC5UZXh0Qm91bmRzLlkgKyAxMCksCiAgICAgICAgQ29sb3IgPSByaWdodGNvbG9yCiAgICB9KSwgY2hlYXQudXRpbGl0eS5uZXdfZHJhd2luZyhjYW51c2VpbWFnZXMgYW5kICJJbWFnZSIgb3IgIlNxdWFyZSIsIHsKICAgICAgICBaSW5kZXggPSAyLAogICAgICAgIFZpc2libGUgPSB0cnVlLAogICAgICAgIFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgUG9zaXRpb24gPSB3YXRlcnBvcywKICAgICAgICBTaXplID0gVmVjdG9yMi5uZXcodGV4dC5UZXh0Qm91bmRzLlggKyAxMCwgdGV4dC5UZXh0Qm91bmRzLlkgKyAxMCksCiAgICAgICAgQ29sb3IgPSBsZWZ0Y29sb3IKICAgIH0pOwogICAgbG9jYWwgZ3JhZGJhY2tncm91bmQgPSBjaGVhdC51dGlsaXR5Lm5ld19kcmF3aW5nKCJTcXVhcmUiLCB7CiAgICAgICAgWkluZGV4ID0gMSwKICAgICAgICBWaXNpYmxlID0gdHJ1ZSwKICAgICAgICBUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgIFBvc2l0aW9uID0gd2F0ZXJwb3MsCiAgICAgICAgU2l6ZSA9IFZlY3RvcjIubmV3KHRleHQuVGV4dEJvdW5kcy5YICsgMTAsIHRleHQuVGV4dEJvdW5kcy5ZICsgMTApLAogICAgICAgIENvbG9yID0gbGVmdGNvbG9yOkxlcnAocmlnaHRjb2xvciwgMC41KSwKICAgICAgICBGaWxsZWQgPSB0cnVlCiAgICB9KTsKICAgIGxvY2FsIHRleHRiYWNrZ3JvdW5kID0gY2hlYXQudXRpbGl0eS5uZXdfZHJhd2luZygiU3F1YXJlIiwgewogICAgICAgIFpJbmRleCA9IDMsCiAgICAgICAgVmlzaWJsZSA9IHRydWUsCiAgICAgICAgVHJhbnNwYXJlbmN5ID0gMC4zMzcsCiAgICAgICAgUG9zaXRpb24gPSB3YXRlcnBvcyArIFZlY3RvcjIubmV3KDIsIDIpLAogICAgICAgIFNpemUgPSBWZWN0b3IyLm5ldyh0ZXh0LlRleHRCb3VuZHMuWCArIDYsIHRleHQuVGV4dEJvdW5kcy5ZICsgNiksCiAgICAgICAgQ29sb3IgPSBDb2xvcjMubmV3KDAsMCwwKSwKICAgICAgICBGaWxsZWQgPSB0cnVlLAogICAgICAgIFRoaWNrbmVzcyA9IDAsCiAgICB9KTsKICAgIGlmIGNhbnVzZWltYWdlcyB0aGVuIHJhd2dldChncmFkciwgIl9mcmFtZSIpLkltYWdlID0gZ2V0Y3VzdG9tYXNzZXQoInN5bnRheC9uZXcvZmlsZXMvZ3JhZDkwci5wbmciKTsgZW5kCiAgICBpZiBjYW51c2VpbWFnZXMgdGhlbiByYXdnZXQoZ3JhZGwsICJfZnJhbWUiKS5JbWFnZSA9IGdldGN1c3RvbWFzc2V0KCJzeW50YXgvbmV3L2ZpbGVzL2dyYWQ5MGwucG5nIik7IGVuZAogICAgbG9jYWwgaHVlMSwgaHVlMiwgZnBzdGltZXIsIGZwcywgZmluYWxmcHMgPSAwLCAwLjE1LCB0aWNrKCksIDAsIDYwOwogICAgY2hlYXQudXRpbGl0eS5uZXdfcmVuZGVyc3RlcHBlZChMUEhfSklUX01BWChmdW5jdGlvbihkZWx0YSkKICAgICAgICBmcHMgPSBmcHMgKyAxOwogICAgICAgIGlmIGZwc3RpbWVyICsgMSA8PSB0aWNrKCkgdGhlbgogICAgICAgICAgICBmcHN0aW1lciA9IHRpY2soKTsKICAgICAgICAgICAgZmluYWxmcHMgPSBmcHM7CiAgICAgICAgICAgIGZwcyA9IDA7CiAgICAgICAgZW5kOwogICAgICAgIGh1ZTEsIGh1ZTIgPSB0aWNrKCkgJSAxLCB0aWNrKCkgJSAxICsgMC4xNTsKICAgICAgICBpZiBodWUxID49IDEgdGhlbiBodWUxID0gMCBlbmQgaWYgaHVlMiA+PSAxIHRoZW4gaHVlMiA9IDAgZW5kCiAgICAgICAgcmlnaHRjb2xvciA9IGR5bmFtaWMgYW5kIENvbG9yMy5mcm9tSFNWKGh1ZTEsIDEsIDEpIG9yIGNvbG9yMjsKICAgICAgICBsZWZ0Y29sb3IgPSBkeW5hbWljIGFuZCBDb2xvcjMuZnJvbUhTVihodWUyLCAxLCAxKSBvciBjb2xvcjE7CiAgICAgICAgd2F0ZXJ0ZXh0ID0gKCJzeW50YXggJXMgfCAlcyB8ICVzIHwgJXMgZnBzIik6Zm9ybWF0KFNXR19WZXJzaW9uLCBTV0dfU2hvcnROYW1lLCBvcy5kYXRlKCIlYiAlZCAlWSIpLCB0b3N0cmluZyhmaW5hbGZwcykpOwogICAgICAgIGdyYWRyLkNvbG9yID0gcmlnaHRjb2xvcjsKICAgICAgICBncmFkbC5Db2xvciA9IGxlZnRjb2xvcjsKICAgICAgICBncmFkYmFja2dyb3VuZC5Db2xvciA9IGdyYWRyLkNvbG9yOkxlcnAoZ3JhZGwuQ29sb3IsIDAuNSk7CiAgICAgICAgdGV4dGJhY2tncm91bmQuU2l6ZSA9IFZlY3RvcjIubmV3KHRleHQuVGV4dEJvdW5kcy5YICsgNywgdGV4dC5UZXh0Qm91bmRzLlkgKyA2KTsKICAgICAgICB0ZXh0YmFja2dyb3VuZC5Qb3NpdGlvbiA9IHdhdGVycG9zICsgVmVjdG9yMi5uZXcoMiwgMik7CiAgICAgICAgZ3JhZGJhY2tncm91bmQuU2l6ZSA9IFZlY3RvcjIubmV3KHRleHQuVGV4dEJvdW5kcy5YICsgMTEsIHRleHQuVGV4dEJvdW5kcy5ZICsgMTApOwogICAgICAgIGdyYWRiYWNrZ3JvdW5kLlBvc2l0aW9uID0gd2F0ZXJwb3M7CiAgICAgICAgZ3JhZGwuUG9zaXRpb24gPSB3YXRlcnBvczsKICAgICAgICBncmFkbC5TaXplID0gVmVjdG9yMi5uZXcodGV4dC5UZXh0Qm91bmRzLlggKyAxMSwgdGV4dC5UZXh0Qm91bmRzLlkgKyAxMCk7CiAgICAgICAgZ3JhZHIuUG9zaXRpb24gPSB3YXRlcnBvczsKICAgICAgICBncmFkci5TaXplID0gVmVjdG9yMi5uZXcodGV4dC5UZXh0Qm91bmRzLlggKyAxMSwgdGV4dC5UZXh0Qm91bmRzLlkgKyAxMCk7CiAgICAgICAgdGV4dC5Qb3NpdGlvbiA9IHdhdGVycG9zICsgVmVjdG9yMi5uZXcoNiwgNSk7CiAgICAgICAgdGV4dC5UZXh0ID0gd2F0ZXJ0ZXh0OwoKICAgICAgICB0ZXh0LlZpc2libGUgPSBlbmFibGVkOwogICAgICAgIGdyYWRsLlZpc2libGUgPSBlbmFibGVkOwogICAgICAgIGdyYWRyLlZpc2libGUgPSBlbmFibGVkOwogICAgICAgIGdyYWRiYWNrZ3JvdW5kLlZpc2libGUgPSBlbmFibGVkOwogICAgICAgIHRleHRiYWNrZ3JvdW5kLlZpc2libGUgPSBlbmFibGVkOwogICAgZW5kKSkKZW5kCmRvCgogICAgbG9jYWwgV29ybGRUYWIgPSB1aS5ib3gud29ybGQ6QWRkVGFiKCJ3b3JsZCB2aXN1YWxzIikKICAgIGxvY2FsIGdyYWRpZW50ZW5hYmxlZCA9IGZhbHNlCiAgICBsb2NhbCBncmFkaWVudGNvbG9yMSA9IENvbG9yMy5mcm9tUkdCKDkwLCA5MCwgOTApCiAgICBsb2NhbCBncmFkaWVudGNvbG9yMiA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICBsb2NhbCB0aW1lID0gMTIKICAgIGxvY2FsIHRpbWVjaGFuZ2VyID0gZmFsc2UKICAgIGxvY2FsIG5vZm9nID0gZmFsc2UKICAgIGxvY2FsIG5vc2hhZG93cyA9IGZhbHNlCiAgICBXb3JsZFRhYjpBZGRUb2dnbGUoJ2VuYWJsZXRpbWVjaGFuZ2VyJywge1RleHQgPSAnZW5hYmxlIHRpbWUgY2hhbmdlcicsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgdGltZWNoYW5nZXIgPSBmaXJzdAogICAgZW5kfSkKICAgIFdvcmxkVGFiOkFkZFNsaWRlcigndGltZWNoYW5nZXInLHsgVGV4dCA9ICd0aW1lIGNoYW5nZXInLCBEZWZhdWx0ID0gbWF0aHJvdW5kKExpZ2h0aW5nLkNsb2NrVGltZSksIE1pbiA9IDAsIE1heCA9IDI0LCBSb3VuZGluZyA9IDEsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgdGltZSA9IFN0YXRlCiAgICBlbmQpCiAgICBXb3JsZFRhYjpBZGRUb2dnbGUoJ2FtYmllbnRzd2l0Y2gnLCB7VGV4dCA9ICdlbmFibGUgYW1iaWVudCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgZ3JhZGllbnRlbmFibGVkID0gZmlyc3QKICAgIGVuZH0pOkFkZENvbG9yUGlja2VyKCdhbWJpZW50Y29sb3InLCB7RGVmYXVsdCA9IENvbG9yMy5uZXcoMSwgMSwgMSksVGl0bGUgPSAnYW1iaWVudCBjb2xvcjEnLFRyYW5zcGFyZW5jeSA9IDAsQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBncmFkaWVudGNvbG9yMSA9IFZhbHVlCiAgICBlbmR9KTpBZGRDb2xvclBpY2tlcignYW1iaWVudGNvbG9yMScse0RlZmF1bHQgPSBDb2xvcjMubmV3KDEsIDEsIDEpLFRpdGxlID0gJ2FtYmllbnQgY29sb3IyJyxUcmFuc3BhcmVuY3kgPSAwLENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgZ3JhZGllbnRjb2xvcjIgPSBWYWx1ZQogICAgZW5kfSkKICAgIFdvcmxkVGFiOkFkZFRvZ2dsZSgnZ3Jhc3Nzd2l0Y2gnLCB7CiAgICAgICAgVGV4dCA9ICdubyBncmFzcycsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KF9GaW5kRmlyc3RDaGlsZE9mQ2xhc3Mod29ya3NwYWNlLCAiVGVycmFpbiIpLCAiRGVjb3JhdGlvbiIsIG5vdCBmaXJzdCkKICAgICAgICBlbmQKICAgIH0pCiAgICBXb3JsZFRhYjpBZGRUb2dnbGUoJ2ZvZ3N3aXRjaCcsIHsKICAgICAgICBUZXh0ID0gJ25vIGZvZycsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgICAgIG5vZm9nID0gZmlyc3QKICAgICAgICBlbmQKICAgIH0pCiAgICBXb3JsZFRhYjpBZGRUb2dnbGUoJ3NoYWRvd3N3aXRjaCcsIHsKICAgICAgICBUZXh0ID0gJ25vIHNoYWRvd3MnLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgICAgICBub3NoYWRvd3MgPSBmaXJzdAogICAgICAgIGVuZAogICAgfSkKICAgIGNoZWF0LnV0aWxpdHkubmV3X2hlYXJ0YmVhdChmdW5jdGlvbigpCiAgICAgICAgTGlnaHRpbmcuR2xvYmFsU2hhZG93cyA9IG5vdCBub3NoYWRvd3MKICAgICAgICBpZiBncmFkaWVudGVuYWJsZWQgdGhlbgogICAgICAgICAgICBMaWdodGluZy5BbWJpZW50ID0gZ3JhZGllbnRjb2xvcjEKICAgICAgICAgICAgTGlnaHRpbmcuT3V0ZG9vckFtYmllbnQgPSBncmFkaWVudGNvbG9yMgogICAgICAgIGVuZAogICAgICAgIGlmIHRpbWVjaGFuZ2VyIHRoZW4KICAgICAgICAgICAgTGlnaHRpbmcuQ2xvY2tUaW1lID0gdGltZQogICAgICAgIGVuZAogICAgICAgIExpZ2h0aW5nLkZvZ0VuZCA9IG5vZm9nIGFuZCBtYXRoLmh1Z2Ugb3IgOTAwCiAgICAgICAgTGlnaHRpbmcuRm9nU3RhcnQgPSBub2ZvZyBhbmQgbWF0aC5odWdlIG9yIDAKICAgIGVuZCkKZW5kCgpkbwogICAgbG9jYWwgY3Vyc29yID0gewogICAgICAgIEVuYWJsZWQgPSBmYWxzZSwKICAgICAgICBDdXN0b21Qb3MgPSBmYWxzZSwKICAgICAgICBQb3NpdGlvbiA9IF9WZWN0b3IybmV3KDAsIDApLAogICAgICAgIFNwZWVkID0gNSwKICAgICAgICBSYWRpdXMgPSAyNSwKICAgICAgICBDb2xvciA9IENvbG9yMy5mcm9tUkdCKDE4MCwgNTAsIDI1NSksCiAgICAgICAgVGhpY2tuZXNzID0gMS43LAogICAgICAgIE91dGxpbmUgPSBmYWxzZSwKICAgICAgICBSZXNpemUgPSBmYWxzZSwKICAgICAgICBEb3QgPSBmYWxzZSwKICAgICAgICBHYXAgPSAxMCwKICAgICAgICBUaGVHYXAgPSBmYWxzZSwKICAgICAgICBGb250ID0gRHJhd2luZy5Gb250cy5Nb25vc3BhY2UsCiAgICAgICAgVGV4dCA9IHsKICAgICAgICAgICAgTG9nbyA9IGZhbHNlLAogICAgICAgICAgICBMb2dvQ29sb3IgPSBDb2xvcjMubmV3KDEsIDEsIDEpLAogICAgICAgICAgICBOYW1lID0gZmFsc2UsCiAgICAgICAgICAgIE5hbWVDb2xvciA9IENvbG9yMy5uZXcoMSwgMSwgMSksCiAgICAgICAgICAgIExvZ29GYWRpbmdPZmZzZXQgPSAwLAogICAgICAgIH0KICAgIH0KICAgIGxvY2FsIENyb3NzaGFpclRhYiA9IHVpLmJveC53b3JsZDpBZGRUYWIoImNyb3NzaGFpciIpCiAgICBjdXJzb3IucmFpbmJvdyA9IGZhbHNlCiAgICBjdXJzb3Iuc3Vzc3kgPSBmYWxzZQogICAgQ3Jvc3NoYWlyVGFiOkFkZERyb3Bkb3duKCdlc3Bmb250Jywge1ZhbHVlcyA9IHsgJ1VJJywgJ1N5c3RlbScsICdQbGV4JywgJ01vbm9zcGFjZScgfSxEZWZhdWx0ID0gMSxNdWx0aSA9IGZhbHNlLFRleHQgPSAnZXNwIGZvbnQnLFRvb2x0aXAgPSAnc2VsZWN0IGZvbnQnLENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgY3Vyc29yLkZvbnQgPSBEcmF3aW5nLkZvbnRzW1ZhbHVlXQogICAgZW5kfSkKICAgIENyb3NzaGFpclRhYjpBZGRUb2dnbGUoJ2Nyb3NzaGFpcmVuYWJsZScsIHtUZXh0ID0gJ2VuYWJsZSBjcm9zc2hhaXInLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIGN1cnNvci5FbmFibGVkID0gZmlyc3QKICAgIGVuZH0pOkFkZENvbG9yUGlja2VyKCdjcm9zc2hhaXJjb2xvcicsIHtEZWZhdWx0ID0gQ29sb3IzLm5ldygxLCAxLCAxKSxUaXRsZSA9ICdjcm9zc2hhaXIgY29sb3InLFRyYW5zcGFyZW5jeSA9IDAsQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBjdXJzb3IuQ29sb3IgPSBWYWx1ZQogICAgZW5kfSkKICAgIENyb3NzaGFpclRhYjpBZGRTbGlkZXIoJ2Nyb3NzaGFpcnNwZWVkJywge1RleHQgPSAnc3BlZWQnLERlZmF1bHQgPSAzLE1pbiA9IDAuMSxNYXggPSAxNSxSb3VuZGluZyA9IDEsQ29tcGFjdCA9IHRydWV9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgY3Vyc29yLlNwZWVkID0gU3RhdGUgLyAxMAogICAgZW5kKQogICAgQ3Jvc3NoYWlyVGFiOkFkZFNsaWRlcignY3Jvc3NoYWlycmFkaXVzJywge1RleHQgPSAncmFkaXVzJyxEZWZhdWx0ID0gMjUsTWluID0gMC4xLE1heCA9IDEwMCxSb3VuZGluZyA9IDEsQ29tcGFjdCA9IHRydWUsfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKFN0YXRlKQogICAgICAgIGN1cnNvci5SYWRpdXMgPSBTdGF0ZQogICAgZW5kKQogICAgQ3Jvc3NoYWlyVGFiOkFkZFNsaWRlcignY3Jvc3NoYWlydGhpY2tuZXNzJywge1RleHQgPSAndGhpY2tuZXNzJyxEZWZhdWx0ID0gMS41LE1pbiA9IDAuMSxNYXggPSAxMCxSb3VuZGluZyA9IDEsQ29tcGFjdCA9IHRydWUsfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKFN0YXRlKQogICAgICAgIGN1cnNvci5UaGlja25lc3MgPSBTdGF0ZQogICAgZW5kKQogICAgQ3Jvc3NoYWlyVGFiOkFkZFNsaWRlcignY3Jvc3NoYWlyZ2Fwc2l6ZScsIHtUZXh0ID0gJ2dhcCcsRGVmYXVsdCA9IDUsTWluID0gMCxNYXggPSA1MCxSb3VuZGluZyA9IDEsQ29tcGFjdCA9IHRydWUsfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKFN0YXRlKQogICAgICAgIGN1cnNvci5HYXAgPSBTdGF0ZQogICAgZW5kKQogICAgQ3Jvc3NoYWlyVGFiOkFkZFRvZ2dsZSgnY3Jvc3NoYWlyZW5hYmxlZ2FwJywge1RleHQgPSAnbWF0aCBkaXZpZGUgZ2FwJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBjdXJzb3IuVGhlR2FwID0gZmlyc3QKICAgIGVuZH0pCiAgICBDcm9zc2hhaXJUYWI6QWRkVG9nZ2xlKCdjcm9zc2hhaXJlbmFibGVvdXRsaW5lJywge1RleHQgPSAnb3V0bGluZScsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgY3Vyc29yLk91dGxpbmUgPSBmaXJzdAogICAgZW5kfSkKICAgIENyb3NzaGFpclRhYjpBZGRUb2dnbGUoJ2Nyb3NzaGFpcmVuYWJsZXJlc2l6ZScsIHtUZXh0ID0gJ3Jlc2l6ZSBhbmltYXRpb24nLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIGN1cnNvci5SZXNpemUgPSBmaXJzdAogICAgZW5kfSkKICAgIENyb3NzaGFpclRhYjpBZGRUb2dnbGUoJ2Nyb3NzaGFpcmVuYWJsZWRvdCcsIHtUZXh0ID0gJ2RvdCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgY3Vyc29yLkRvdCA9IGZpcnN0CiAgICBlbmR9KQogICAgQ3Jvc3NoYWlyVGFiOkFkZFRvZ2dsZSgnY3Jvc3NoYWlyZW5hYmxlbmF6aScsIHtUZXh0ID0gJ3N1c3N5JyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBjdXJzb3Iuc3Vzc3kgPSBmaXJzdAogICAgICAgIGVuZH0pCiAgICAgICAgQ3Jvc3NoYWlyVGFiOkFkZFRvZ2dsZSgnY3Jvc3NoYWlyZW5hYmxlZmFnZ290Jywge1RleHQgPSAncmFpbmJvdycsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgY3Vyc29yLnJhaW5ib3cgPSBmaXJzdAogICAgZW5kfSkKICAgIENyb3NzaGFpclRhYjpBZGRUb2dnbGUoJ2Nyb3NzaGFpcnRleHRMb2dvJywge1RleHQgPSAndGV4dCBsb2dvJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBjdXJzb3IuVGV4dC5Mb2dvID0gZmlyc3QKICAgIGVuZH0pOkFkZENvbG9yUGlja2VyKCdjcm9zc2hhaXJsb2dvY29sb3InLCB7RGVmYXVsdCA9IENvbG9yMy5uZXcoMSwgMSwgMSksVGl0bGUgPSAnbG9nbyBjb2xvcicsVHJhbnNwYXJlbmN5ID0gMCxDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGN1cnNvci5UZXh0LkxvZ29Db2xvciA9IFZhbHVlCiAgICBlbmR9KQogICAgQ3Jvc3NoYWlyVGFiOkFkZFRvZ2dsZSgnY3Jvc3NoYWlydGV4dE5hbWUnLCB7VGV4dCA9ICd0ZXh0IG5hbWUnLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIGN1cnNvci5UZXh0Lk5hbWUgPSBmaXJzdAogICAgZW5kfSk6QWRkQ29sb3JQaWNrZXIoJ2Nyb3NzaGFpcnRleHRjb2xvcicsIHtEZWZhdWx0ID0gQ29sb3IzLm5ldygxLCAxLCAxKSxUaXRsZSA9ICd0ZXh0IGNvbG9yJyxUcmFuc3BhcmVuY3kgPSAwLENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgY3Vyc29yLlRleHQuTmFtZUNvbG9yID0gVmFsdWUKICAgIGVuZH0pCiAgICBDcm9zc2hhaXJUYWI6QWRkU2xpZGVyKCdjcm9zc2hhaXJsb2dvb2Zmc2V0Jywge1RleHQgPSAnbG9nbyBmYWRlIG9mZnNldCcsRGVmYXVsdCA9IDAsTWluID0gMCxNYXggPSA1LFJvdW5kaW5nID0gMSxDb21wYWN0ID0gdHJ1ZX0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBjdXJzb3IuVGV4dC5Mb2dvRmFkaW5nT2Zmc2V0ID0gU3RhdGUKICAgIGVuZCkKCiAgICAtLSAvLyBJbml0aWxpc2F0aW9uCiAgICBsb2NhbCBsaW5lcyA9IHt9CiAgICAtLSAvLyBEcmF3aW5ncwogICAgbG9jYWwgb3V0bGluZSA9IGNoZWF0LnV0aWxpdHkubmV3X2RyYXdpbmcoIlNxdWFyZSIsIHsKICAgICAgICBWaXNpYmxlID0gdHJ1ZSwKICAgICAgICBTaXplID0gX1ZlY3RvcjJuZXcoNCwgNCksCiAgICAgICAgQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwKICAgICAgICBGaWxsZWQgPSB0cnVlLAogICAgICAgIFpJbmRleCA9IDEsCiAgICAgICAgVHJhbnNwYXJlbmN5ID0gMQogICAgfSkKICAgIC0tCiAgICBsb2NhbCBkb3QgPSBjaGVhdC51dGlsaXR5Lm5ld19kcmF3aW5nKCJTcXVhcmUiLCB7CiAgICAgICAgVmlzaWJsZSA9IHRydWUsCiAgICAgICAgU2l6ZSA9IF9WZWN0b3IybmV3KDIsIDIpLAogICAgICAgIENvbG9yID0gY3Vyc29yLkNvbG9yLAogICAgICAgIEZpbGxlZCA9IHRydWUsCiAgICAgICAgWkluZGV4ID0gMiwKICAgICAgICBUcmFuc3BhcmVuY3kgPSAxCiAgICB9KQogICAgLS0KICAgIGxvY2FsIGxvZ290ZXh0ID0gY2hlYXQudXRpbGl0eS5uZXdfZHJhd2luZygiVGV4dCIsIHsKICAgICAgICBWaXNpYmxlID0gZmFsc2UsCiAgICAgICAgRm9udCA9IGN1cnNvci5Gb250LAogICAgICAgIFNpemUgPSAxMywKICAgICAgICBDb2xvciA9IENvbG9yMy5mcm9tUkdCKDEzOCwgMTI4LCAyNTUpLAogICAgICAgIFpJbmRleCA9IDMsCiAgICAgICAgVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICBUZXh0ID0gInN5bnRheC54eXoiLAogICAgICAgIENlbnRlciA9IHRydWUsCiAgICAgICAgT3V0bGluZSA9IHRydWUsCiAgICB9KQogICAgbG9jYWwgaW5kaWNhdG9ydGV4dCA9IGNoZWF0LnV0aWxpdHkubmV3X2RyYXdpbmcoIlRleHQiLCB7CiAgICAgICAgVmlzaWJsZSA9IGZhbHNlLAogICAgICAgIEZvbnQgPSBjdXJzb3IuRm9udCwKICAgICAgICBTaXplID0gMTMsCiAgICAgICAgQ29sb3IgPSBDb2xvcjMubmV3KDEsIDEsIDEpLAogICAgICAgIFpJbmRleCA9IDMsCiAgICAgICAgVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICBUZXh0ID0gIiIsCiAgICAgICAgQ2VudGVyID0gdHJ1ZSwKICAgICAgICBPdXRsaW5lID0gdHJ1ZSwKICAgIH0pCiAgICAtLQogICAgZm9yIGkgPSAxLCA0IGRvCiAgICAgICAgbG9jYWwgbGluZV9vdXRsaW5lID0gY2hlYXQudXRpbGl0eS5uZXdfZHJhd2luZygiTGluZSIsIHsKICAgICAgICAgICAgVmlzaWJsZSA9IHRydWUsCiAgICAgICAgICAgIEZyb20gPSBfVmVjdG9yMm5ldygyMDAsIDUwMCksCiAgICAgICAgICAgIFRvID0gX1ZlY3RvcjJuZXcoMjAwLCA1MDApLAogICAgICAgICAgICBDb2xvciA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICBUaGlja25lc3MgPSBjdXJzb3IuVGhpY2tuZXNzICsgMi41LAogICAgICAgICAgICBaSW5kZXggPSAxLAogICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgfSkKICAgICAgICBsb2NhbCBsaW5lID0gY2hlYXQudXRpbGl0eS5uZXdfZHJhd2luZygiTGluZSIsIHsKICAgICAgICAgICAgVmlzaWJsZSA9IHRydWUsCiAgICAgICAgICAgIEZyb20gPSBfVmVjdG9yMm5ldygyMDAsIDUwMCksCiAgICAgICAgICAgIFRvID0gX1ZlY3RvcjJuZXcoMjAwLCA1MDApLAogICAgICAgICAgICBDb2xvciA9IGN1cnNvci5Db2xvciwKICAgICAgICAgICAgVGhpY2tuZXNzID0gY3Vyc29yLlRoaWNrbmVzcywKICAgICAgICAgICAgWkluZGV4ID0gMiwKICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gMQogICAgICAgIH0pCiAgICAgICAgbG9jYWwgbmF6aWxpbmUgPSBjaGVhdC51dGlsaXR5Lm5ld19kcmF3aW5nKCJMaW5lIiwgewogICAgICAgICAgICBWaXNpYmxlID0gdHJ1ZSwKICAgICAgICAgICAgRnJvbSA9IF9WZWN0b3IybmV3KDIwMCwgNTAwKSwKICAgICAgICAgICAgVG8gPSBfVmVjdG9yMm5ldygyMDAsIDUwMCksCiAgICAgICAgICAgIENvbG9yID0gY3Vyc29yLkNvbG9yLAogICAgICAgICAgICBUaGlja25lc3MgPSBjdXJzb3IuVGhpY2tuZXNzLAogICAgICAgICAgICBaSW5kZXggPSAyLAogICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgfSkKICAgICAgICBsaW5lc1tpXSA9IHsgbGluZSwgbGluZV9vdXRsaW5lLCBuYXppbGluZSB9CiAgICBlbmQKICAgIGxvY2FsIGFuZ2xlID0gMAogICAgbG9jYWwgdHJhbnNwID0gMAogICAgbG9jYWwgcmV2ZXJzZSA9IGZhbHNlCiAgICBsb2NhbCBmdW5jdGlvbiBzZXRyZXZlcnNlKHZhbHVlKQogICAgICAgIGlmIHJldmVyc2Ugfj0gdmFsdWUgdGhlbgogICAgICAgICAgICByZXZlcnNlID0gdmFsdWUKICAgICAgICBlbmQKICAgIGVuZAogICAgLS0KICAgIGxvY2FsIHBvcywgcmFpbmJvdywgcm90YXRpb25kZWdyZWUsIGNvbG9yID0gVmVjdG9yMi56ZXJvLCAwLCAwLCBDb2xvcjMubmV3KCkKICAgIGxvY2FsIG1hdGhfY29zLCBtYXRoX2F0YW4sIG1hdGhfcGksIG1hdGhfc2luID0gbWF0aC5jb3MsIG1hdGguYXRhbiwgbWF0aC5waSwgbWF0aC5zaW4KICAgIGxvY2FsIGZ1bmN0aW9uIERFRzJSQUQoeCkgcmV0dXJuIHggKiBtYXRoX3BpIC8gMTgwIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gUkFEMkRFRyh4KSByZXR1cm4geCAqIDE4MCAvIG1hdGhfcGkgZW5kCiAgICBjaGVhdC51dGlsaXR5Lm5ld19yZW5kZXJzdGVwcGVkKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKGRlbHRhKQogICAgICAgIGlmIGN1cnNvci5FbmFibGVkIHRoZW4KICAgICAgICAgICAgcmFpbmJvdyA9IHJhaW5ib3cgKyAoZGVsdGEgKiAwLjUpCiAgICAgICAgICAgIGlmIHJhaW5ib3cgPiAxLjAgdGhlbiByYWluYm93ID0gMC4wIGVuZAogICAgICAgICAgICBjb2xvciA9IENvbG9yMy5mcm9tSFNWKHJhaW5ib3csIDEsIDEpCiAgICAgICAgICAgIGlmIGN1cnNvci5DdXN0b21Qb3MgdGhlbiBwb3MgPSBjdXJzb3IuUG9zaXRpb24gZWxzZSBwb3MgPSBfVmVjdG9yMm5ldygKICAgICAgICAgICAgICAgIE1vdXNlLlgsCiAgICAgICAgICAgICAgICBNb3VzZS5ZICsgR3VpSW5zZXQuWSkgZW5kCiAgICAgICAgICAgIGlmIGN1cnNvci5yYWluYm93IHRoZW4gY29sb3IgPSBDb2xvcjMuZnJvbUhTVihyYWluYm93LCAxLCAxKSBlbHNlIGNvbG9yID0gY3Vyc29yLkNvbG9yIGVuZAogICAgICAgICAgICBpZiB0cmFuc3AgPD0gMS41ICsgY3Vyc29yLlRleHQuTG9nb0ZhZGluZ09mZnNldCBhbmQgbm90IHJldmVyc2UgdGhlbgogICAgICAgICAgICAgICAgdHJhbnNwID0gdHJhbnNwICsgKCgoY3Vyc29yLlNwZWVkID09IDAgYW5kIDEgb3IgY3Vyc29yLlNwZWVkKSAqIDEwKSAqIGRlbHRhKQogICAgICAgICAgICAgICAgaWYgdHJhbnNwID49IDEuNSArIGN1cnNvci5UZXh0LkxvZ29GYWRpbmdPZmZzZXQgdGhlbiBzZXRyZXZlcnNlKHRydWUpIGVuZAogICAgICAgICAgICBlbHNlaWYgcmV2ZXJzZSB0aGVuCiAgICAgICAgICAgICAgICB0cmFuc3AgPSB0cmFuc3AgLSAoKChjdXJzb3IuU3BlZWQgPT0gMCBhbmQgMSBvciBjdXJzb3IuU3BlZWQpICogMTApICogZGVsdGEpCiAgICAgICAgICAgICAgICBpZiB0cmFuc3AgPD0gMCAtIGN1cnNvci5UZXh0LkxvZ29GYWRpbmdPZmZzZXQgdGhlbiBzZXRyZXZlcnNlKGZhbHNlKSBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGxvZ290ZXh0LlBvc2l0aW9uID0gX1ZlY3RvcjJuZXcocG9zLlgsIChwb3MgKyBfVmVjdG9yMm5ldygwLCBjdXJzb3IuUmFkaXVzICsgNSkpLlkpCiAgICAgICAgICAgIGxvZ290ZXh0LlRyYW5zcGFyZW5jeSA9IHRyYW5zcAogICAgICAgICAgICBsb2dvdGV4dC5WaXNpYmxlID0gY3Vyc29yLlRleHQuTG9nbwogICAgICAgICAgICBsb2dvdGV4dC5Db2xvciA9IGN1cnNvci5UZXh0LkxvZ29Db2xvcgogICAgICAgICAgICBsb2dvdGV4dC5Gb250ID0gY3Vyc29yLkZvbnQKICAgICAgICAgICAgLS0KICAgICAgICAgICAgaW5kaWNhdG9ydGV4dC5Qb3NpdGlvbiA9IF9WZWN0b3IybmV3KHBvcy5YLCAocG9zICsgX1ZlY3RvcjJuZXcoMCwgY3Vyc29yLlJhZGl1cyArIChjdXJzb3IuVGV4dC5Mb2dvIGFuZCAxOSBvciA1KSkpLlkpCiAgICAgICAgICAgIGluZGljYXRvcnRleHQuVmlzaWJsZSA9IG1vZHVsZWNvbW0uaW5kaWNhdG9yCiAgICAgICAgICAgIGluZGljYXRvcnRleHQuQ29sb3IgPSBjdXJzb3IuVGV4dC5OYW1lQ29sb3IKICAgICAgICAgICAgaW5kaWNhdG9ydGV4dC5Gb250ID0gY3Vyc29yLkZvbnQKICAgICAgICAgICAgaW5kaWNhdG9ydGV4dC5UZXh0ID0gbW9kdWxlY29tbS5pbmRpY2F0b3JfdGV4dAoKICAgICAgICAgICAgaWYgY3Vyc29yLnN1c3N5IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGZyYW1ldGltZSA9IGRlbHRhCiAgICAgICAgICAgICAgICBsb2NhbCBhID0gY3Vyc29yLlJhZGl1cyAtIDEwCiAgICAgICAgICAgICAgICBsb2NhbCBnYW1tYSA9IG1hdGhfYXRhbihhIC8gYSkKCiAgICAgICAgICAgICAgICBpZiByb3RhdGlvbmRlZ3JlZSA+PSA5MCB0aGVuIHJvdGF0aW9uZGVncmVlID0gMCBlbmQKCiAgICAgICAgICAgICAgICBmb3IgaSA9IDEsIDQgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwXzAgPSAoYSAqIG1hdGhfc2luKERFRzJSQUQocm90YXRpb25kZWdyZWUgKyAoaSAqIDkwKSkpKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBfMSA9IChhICogbWF0aF9jb3MoREVHMlJBRChyb3RhdGlvbmRlZ3JlZSArIChpICogOTApKSkpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcF8yID0gKChhIC8gbWF0aF9jb3MoZ2FtbWEpKSAqIG1hdGhfc2luKERFRzJSQUQocm90YXRpb25kZWdyZWUgKyAoaSAqIDkwKSArIFJBRDJERUcoZ2FtbWEpKSkpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcF8zID0gKChhIC8gbWF0aF9jb3MoZ2FtbWEpKSAqIG1hdGhfY29zKERFRzJSQUQocm90YXRpb25kZWdyZWUgKyAoaSAqIDkwKSArIFJBRDJERUcoZ2FtbWEpKSkpCgoKICAgICAgICAgICAgICAgICAgICBsaW5lc1tpXVsxXS5Gcm9tID0gX1ZlY3RvcjJuZXcocG9zLlgsIHBvcy5ZKQogICAgICAgICAgICAgICAgICAgIGxpbmVzW2ldWzFdLlRvID0gX1ZlY3RvcjJuZXcocG9zLlggKyBwXzAsIHBvcy5ZIC0gcF8xKQogICAgICAgICAgICAgICAgICAgIGxpbmVzW2ldWzFdLkNvbG9yID0gY29sb3IKICAgICAgICAgICAgICAgICAgICBsaW5lc1tpXVsxXS5UaGlja25lc3MgPSBjdXJzb3IuVGhpY2tuZXNzCiAgICAgICAgICAgICAgICAgICAgbGluZXNbaV1bMV0uVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICBsaW5lc1tpXVszXS5Gcm9tID0gX1ZlY3RvcjJuZXcocG9zLlggKyBwXzAsIHBvcy5ZIC0gcF8xKQogICAgICAgICAgICAgICAgICAgIGxpbmVzW2ldWzNdLlRvID0gX1ZlY3RvcjJuZXcocG9zLlggKyBwXzIsIHBvcy5ZIC0gcF8zKQogICAgICAgICAgICAgICAgICAgIGxpbmVzW2ldWzNdLkNvbG9yID0gY29sb3IKICAgICAgICAgICAgICAgICAgICBsaW5lc1tpXVszXS5UaGlja25lc3MgPSBjdXJzb3IuVGhpY2tuZXNzCiAgICAgICAgICAgICAgICAgICAgbGluZXNbaV1bM10uVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcm90YXRpb25kZWdyZWUgPSByb3RhdGlvbmRlZ3JlZSArICgoY3Vyc29yLlNwZWVkICogZnJhbWV0aW1lKSAqIDEwMDApCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFuZ2xlID0gKGN1cnNvci5TcGVlZCA9PSAwIGFuZCAwIG9yIGFuZ2xlICsgKChjdXJzb3IuU3BlZWQgKiAxMCkgKiBkZWx0YSkpCgogICAgICAgICAgICAgICAgaWYgYW5nbGUgPj0gOTAgdGhlbgogICAgICAgICAgICAgICAgICAgIGFuZ2xlID0gMAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgLS0KICAgICAgICAgICAgICAgIGRvdC5WaXNpYmxlID0gY3Vyc29yLkRvdAogICAgICAgICAgICAgICAgZG90LkNvbG9yID0gY29sb3IKICAgICAgICAgICAgICAgIGRvdC5Qb3NpdGlvbiA9IF9WZWN0b3IybmV3KHBvcy5YIC0gMSwgcG9zLlkgLSAxKQogICAgICAgICAgICAgICAgLS0KICAgICAgICAgICAgICAgIG91dGxpbmUuVmlzaWJsZSA9IGN1cnNvci5PdXRsaW5lIGFuZCBjdXJzb3IuRG90CiAgICAgICAgICAgICAgICBvdXRsaW5lLlBvc2l0aW9uID0gX1ZlY3RvcjJuZXcocG9zLlggLSAyLCBwb3MuWSAtIDIpCiAgICAgICAgICAgICAgICAtLQoKICAgICAgICAgICAgICAgIC0tCiAgICAgICAgICAgICAgICBmb3IgaW5kZXgsIGxpbmUgaW4gcGFpcnMobGluZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpbmRleAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHgsIHkgPSB7fSwge30KICAgICAgICAgICAgICAgICAgICBsb2NhbCB4MSwgeTEgPSB7fSwge30KICAgICAgICAgICAgICAgICAgICBpZiBjdXJzb3IuUmVzaXplIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgeCA9IHsgcG9zLlggKwogICAgICAgICAgICAgICAgICAgICAgICAobWF0aC5jb3MoYW5nbGUgKyAoaW5kZXggKiAobWF0aC5waSAvIDIpKSkgKiAoY3Vyc29yLlJhZGl1cyArICgoY3Vyc29yLlJhZGl1cyAqIG1hdGguc2luKGFuZ2xlKSkgLyA5KSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zLlggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1hdGguY29zKGFuZ2xlICsgKGluZGV4ICogKG1hdGgucGkgLyAyKSkpICogKChjdXJzb3IuUmFkaXVzIC0gMjApIC0gKGN1cnNvci5UaGVHYXAgYW5kICgoKGN1cnNvci5SYWRpdXMgLSAyMCkgKiBtYXRoLmNvcyhhbmdsZSkpIC8gNCkgb3IgKCgoY3Vyc29yLlJhZGl1cyAtIDIwKSAqIG1hdGguY29zKGFuZ2xlKSkgLSA0KSkpKSB9CiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSB7IHBvcy5ZICsKICAgICAgICAgICAgICAgICAgICAgICAgKG1hdGguc2luKGFuZ2xlICsgKGluZGV4ICogKG1hdGgucGkgLyAyKSkpICogKGN1cnNvci5SYWRpdXMgKyAoKGN1cnNvci5SYWRpdXMgKiBtYXRoLnNpbihhbmdsZSkpIC8gOSkpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcy5ZICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtYXRoLnNpbihhbmdsZSArIChpbmRleCAqIChtYXRoLnBpIC8gMikpKSAqICgoY3Vyc29yLlJhZGl1cyAtIDIwKSAtIChjdXJzb3IuVGhlR2FwIGFuZCAoKChjdXJzb3IuUmFkaXVzIC0gMjApICogbWF0aC5jb3MoYW5nbGUpKSAvIDQpIG9yICgoKGN1cnNvci5SYWRpdXMgLSAyMCkgKiBtYXRoLmNvcyhhbmdsZSkpIC0gNCkpKSkgfQogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IHsgcG9zLlggKyAobWF0aC5jb3MoYW5nbGUgKyAoaW5kZXggKiAobWF0aC5waSAvIDIpKSkgKiAoY3Vyc29yLlJhZGl1cyArIDEpKSwgcG9zCiAgICAgICAgICAgICAgICAgICAgICAgIC5YICsKICAgICAgICAgICAgICAgICAgICAgICAgKG1hdGguY29zKGFuZ2xlICsgKGluZGV4ICogKG1hdGgucGkgLyAyKSkpICogKChjdXJzb3IuUmFkaXVzIC0gMjAgKyAxKSAtIChjdXJzb3IuVGhlR2FwIGFuZCAoKGN1cnNvci5SYWRpdXMgLSAyMCArIDEpIC8gY3Vyc29yLkdhcCkgb3IgKChjdXJzb3IuUmFkaXVzIC0gMjAgKyAxKSAtIGN1cnNvci5HYXApKSkpIH0KICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSB7IHBvcy5ZICsgKG1hdGguc2luKGFuZ2xlICsgKGluZGV4ICogKG1hdGgucGkgLyAyKSkpICogKGN1cnNvci5SYWRpdXMgKyAxKSksIHBvcwogICAgICAgICAgICAgICAgICAgICAgICAuWSArCiAgICAgICAgICAgICAgICAgICAgICAgIChtYXRoLnNpbihhbmdsZSArIChpbmRleCAqIChtYXRoLnBpIC8gMikpKSAqICgoY3Vyc29yLlJhZGl1cyAtIDIwICsgMSkgLSAoY3Vyc29yLlRoZUdhcCBhbmQgKChjdXJzb3IuUmFkaXVzIC0gMjAgKyAxKSAvIGN1cnNvci5HYXApIG9yICgoY3Vyc29yLlJhZGl1cyAtIDIwICsgMSkgLSBjdXJzb3IuR2FwKSkpKSB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB4ID0geyBwb3MuWCArIChtYXRoLmNvcyhhbmdsZSArIChpbmRleCAqIChtYXRoLnBpIC8gMikpKSAqIChjdXJzb3IuUmFkaXVzKSksIHBvcy5YICsKICAgICAgICAgICAgICAgICAgICAgICAgKG1hdGguY29zKGFuZ2xlICsgKGluZGV4ICogKG1hdGgucGkgLyAyKSkpICogKChjdXJzb3IuUmFkaXVzIC0gMjApIC0gKGN1cnNvci5UaGVHYXAgYW5kICgoY3Vyc29yLlJhZGl1cyAtIDIwKSAvIGN1cnNvci5HYXApIG9yICgoY3Vyc29yLlJhZGl1cyAtIDIwKSAtIGN1cnNvci5HYXApKSkpIH0KICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHsgcG9zLlkgKyAobWF0aC5zaW4oYW5nbGUgKyAoaW5kZXggKiAobWF0aC5waSAvIDIpKSkgKiAoY3Vyc29yLlJhZGl1cykpLCBwb3MuWSArCiAgICAgICAgICAgICAgICAgICAgICAgIChtYXRoLnNpbihhbmdsZSArIChpbmRleCAqIChtYXRoLnBpIC8gMikpKSAqICgoY3Vyc29yLlJhZGl1cyAtIDIwKSAtIChjdXJzb3IuVGhlR2FwIGFuZCAoKGN1cnNvci5SYWRpdXMgLSAyMCkgLyBjdXJzb3IuR2FwKSBvciAoKGN1cnNvci5SYWRpdXMgLSAyMCkgLSBjdXJzb3IuR2FwKSkpKSB9CiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0geyBwb3MuWCArIChtYXRoLmNvcyhhbmdsZSArIChpbmRleCAqIChtYXRoLnBpIC8gMikpKSAqIChjdXJzb3IuUmFkaXVzICsgMSkpLCBwb3MKICAgICAgICAgICAgICAgICAgICAgICAgLlggKwogICAgICAgICAgICAgICAgICAgICAgICAobWF0aC5jb3MoYW5nbGUgKyAoaW5kZXggKiAobWF0aC5waSAvIDIpKSkgKiAoKGN1cnNvci5SYWRpdXMgLSAyMCArIDEpIC0gKGN1cnNvci5UaGVHYXAgYW5kICgoY3Vyc29yLlJhZGl1cyAtIDIwICsgMSkgLyBjdXJzb3IuR2FwKSBvciAoKGN1cnNvci5SYWRpdXMgLSAyMCArIDEpIC0gY3Vyc29yLkdhcCkpKSkgfQogICAgICAgICAgICAgICAgICAgICAgICB5MSA9IHsgcG9zLlkgKyAobWF0aC5zaW4oYW5nbGUgKyAoaW5kZXggKiAobWF0aC5waSAvIDIpKSkgKiAoY3Vyc29yLlJhZGl1cyArIDEpKSwgcG9zCiAgICAgICAgICAgICAgICAgICAgICAgIC5ZICsKICAgICAgICAgICAgICAgICAgICAgICAgKG1hdGguc2luKGFuZ2xlICsgKGluZGV4ICogKG1hdGgucGkgLyAyKSkpICogKChjdXJzb3IuUmFkaXVzIC0gMjAgKyAxKSAtIChjdXJzb3IuVGhlR2FwIGFuZCAoKGN1cnNvci5SYWRpdXMgLSAyMCArIDEpIC8gY3Vyc29yLkdhcCkgb3IgKChjdXJzb3IuUmFkaXVzIC0gMjAgKyAxKSAtIGN1cnNvci5HYXApKSkpIH0KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAtLQogICAgICAgICAgICAgICAgICAgIGxpbmVbMV0uVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICBsaW5lWzFdLkNvbG9yID0gY29sb3IKICAgICAgICAgICAgICAgICAgICBsaW5lWzFdLkZyb20gPSBfVmVjdG9yMm5ldyh4WzJdLCB5WzJdKQogICAgICAgICAgICAgICAgICAgIGxpbmVbMV0uVG8gPSBfVmVjdG9yMm5ldyh4WzFdLCB5WzFdKQogICAgICAgICAgICAgICAgICAgIGxpbmVbMV0uVGhpY2tuZXNzID0gY3Vyc29yLlRoaWNrbmVzcwogICAgICAgICAgICAgICAgICAgIC0tCiAgICAgICAgICAgICAgICAgICAgbGluZVsyXS5WaXNpYmxlID0gY3Vyc29yLk91dGxpbmUKICAgICAgICAgICAgICAgICAgICBsaW5lWzJdLkZyb20gPSBfVmVjdG9yMm5ldyh4MVsyXSwgeTFbMl0pCiAgICAgICAgICAgICAgICAgICAgbGluZVsyXS5UbyA9IF9WZWN0b3IybmV3KHgxWzFdLCB5MVsxXSkKICAgICAgICAgICAgICAgICAgICBsaW5lWzJdLlRoaWNrbmVzcyA9IGN1cnNvci5UaGlja25lc3MgKyAyLjUKCiAgICAgICAgICAgICAgICAgICAgbGluZVszXS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRvdC5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgb3V0bGluZS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgbG9nb3RleHQuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgIGluZGljYXRvcnRleHQuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgIC0tCiAgICAgICAgICAgIGZvciBpbmRleCwgbGluZSBpbiBwYWlycyhsaW5lcykgZG8KICAgICAgICAgICAgICAgIGxpbmVbMV0uVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICBsaW5lWzJdLlZpc2libGUgPSBmYWxzZQogICAgICAgICAgICAgICAgbGluZVszXS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpKQplbmQKCmRvCiAgICBsb2NhbCBtdmIgPSB1aS5ib3gubW92ZTpBZGRUYWIoJ3NwZWVkaGFjaycpCiAgICBsb2NhbCBiaG9wX2VuYWJsZWQsIGJob3Bfc2lsZW50LCBiaG9wX3NpbGVudF9lbmFibGVkLCBzcGVlZCA9IGZhbHNlLCBmYWxzZSwgZmFsc2UsIDU1CiAgICBsb2NhbCBkb3duY2xpZmZfbW9kZSwgZG93bmNsaWZmX3N0YXJ0LCBkb3duY2xpZmZfc3BlZWQsIGRvd25jbGlmZl9hY2NlbCwgZG93bmNsaWZmX2ZhbGwsIGRvd25jbGlmZl91cCA9IGZhbHNlLCA1MCwgMTUwLCA1MCwgNTAsIDUwCiAgICBsb2NhbCBqZXRwYWNrYWJ1c2UsIGFidXNldXBzcGVlZCwgYWJ1c2Vkb3duc3BlZWQgPSBmYWxzZSwgNTUsIDAKICAgIGxvY2FsIGZvcmNlc3ByaW50ID0gZmFsc2UKICAgIGxvY2FsIHNsaWRpbiA9IGZhbHNlCiAgICBtdmI6QWRkVG9nZ2xlKCdzcGVlZGhhY2tfZm9yY2VzcHJpbnQnLCB7VGV4dCA9ICdmb3JjZXNwcmludCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgZm9yY2VzcHJpbnQgPSBmaXJzdAogICAgZW5kfSkKICAgIGlmIFNXR19Qcml2YXRlIHRoZW4KICAgICAgICBtdmI6QWRkVG9nZ2xlKCdqZXRwYWNrYWJ1c2UnLCB7VGV4dCA9ICdqZXRwYWNrIGFidXNlJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICAgICAgamV0cGFja2FidXNlID0gZmlyc3QKICAgICAgICBlbmR9KTpBZGRLZXlQaWNrZXIoJ2pldHBhY2thYnVzZV9iaW5kJywge0RlZmF1bHQgPSAnTm9uZScsU3luY1RvZ2dsZVN0YXRlID0gdHJ1ZSxNb2RlID0gJ1RvZ2dsZScsVGV4dCA9ICdqZXRwYWNrIGFidXNlJyxOb1VJID0gZmFsc2V9KQogICAgICAgIG12YjpBZGRTbGlkZXIoJ2pldHBhY2thYnVzZV91cHNwZWVkJyx7IFRleHQgPSAndXAgc3BlZWQnLCBEZWZhdWx0ID0gNTUsIE1pbiA9IDEwLCBNYXggPSA1MDAsIFJvdW5kaW5nID0gMCwgU3VmZml4ID0gInNwcyIsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgICAgIGFidXNldXBzcGVlZCA9IFN0YXRlCiAgICAgICAgZW5kKQogICAgICAgIG12YjpBZGRTbGlkZXIoJ2pldHBhY2thYnVzZV9kb3duc3BlZWQnLHsgVGV4dCA9ICdkb3duIHNwZWVkJywgRGVmYXVsdCA9IDU1LCBNaW4gPSAxMCwgTWF4ID0gNTAwLCBSb3VuZGluZyA9IDAsIFN1ZmZpeCA9ICJzcHMiLCBDb21wYWN0ID0gZmFsc2UgfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKFN0YXRlKQogICAgICAgICAgICBhYnVzZWRvd25zcGVlZCA9IFN0YXRlCiAgICAgICAgZW5kKQogICAgICAgIG12YjpBZGRMYWJlbCgiaG9sZCBzcGFjZSB0byBnbyB1cCIpCiAgICAgICAgbXZiOkFkZExhYmVsKCJob2xkIHNoaWZ0IHRvIGdvIGRvd24iKQogICAgZWxzZQogICAgICAgIG12YjpBZGRMYWJlbCgiamV0cGFjayBhYnVzZTogcHJpdmF0ZSBvbmx5IikKICAgIGVuZAogICAgbXZiOkFkZFRvZ2dsZSgnc3BlZWRoYWNrX2VuYWJsZWQnLCB7VGV4dCA9ICdzcGVlZGhhY2sgZW5hYmxlZCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgYmhvcF9lbmFibGVkID0gZmlyc3QKICAgIGVuZH0pCiAgICBtdmI6QWRkU2xpZGVyKCdzcGVlZGhhY2tfc3BlZWQnLHsgVGV4dCA9ICdzcGVlZCcsIERlZmF1bHQgPSA1NSwgTWluID0gNTUsIE1heCA9IDcwLCBSb3VuZGluZyA9IDAsIFN1ZmZpeCA9ICJzcHMiLCBDb21wYWN0ID0gZmFsc2UgfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKFN0YXRlKQogICAgICAgIHNwZWVkID0gU3RhdGUKICAgIGVuZCkKICAgIG12YjpBZGRMYWJlbCgiaG9sZCBzaGlmdCBhbmQgQyB0byBzcGVlZCIpCiAgICBtdmI6QWRkVG9nZ2xlKCdkb3duY2xpZmZfbW9kZScseyBUZXh0ID0gJ2Rvd25jbGlmZiBtb2RlJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBkb3duY2xpZmZfbW9kZSA9IGZpcnN0CiAgICBlbmR9KQogICAgbXZiOkFkZFNsaWRlcignZG93bmNsaWZmX2FjY2VsJyx7IFRleHQgPSAnYWNjZWxlcmF0aW9uJywgRGVmYXVsdCA9IDU1LCBNaW4gPSAxLCBNYXggPSAzMDAsIFJvdW5kaW5nID0gMCwgU3VmZml4ID0gInNwcyIsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgZG93bmNsaWZmX2FjY2VsID0gU3RhdGUKICAgIGVuZCkKICAgIG12YjpBZGRTbGlkZXIoJ2Rvd25jbGlmZl9mYWxsJyx7IFRleHQgPSAnZmFsbCBzcGVlZCcsIERlZmF1bHQgPSA1NSwgTWluID0gMTAsIE1heCA9IDIwMCwgUm91bmRpbmcgPSAwLCBTdWZmaXggPSAic3BzIiwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBkb3duY2xpZmZfZmFsbCA9IFN0YXRlCiAgICBlbmQpCiAgICBtdmI6QWRkU2xpZGVyKCdkb3duY2xpZmZfdXAnLHsgVGV4dCA9ICd1cCBzcGVlZCcsIERlZmF1bHQgPSA1NSwgTWluID0gMTAsIE1heCA9IDIwMCwgUm91bmRpbmcgPSAwLCBTdWZmaXggPSAic3BzIiwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBkb3duY2xpZmZfdXAgPSBTdGF0ZQogICAgZW5kKQogICAgbXZiOkFkZExhYmVsKCJob2xkIHNwYWNlIHRvIGdvIHVwIikKICAgIAogICAgbG9jYWwgbWlkZGxlID0gd29ya3NwYWNlLkNvbnN0Lklnbm9yZS5Mb2NhbENoYXJhY3Rlci5NaWRkbGUKICAgIGxvY2FsIGJvdHRvbSA9IHdvcmtzcGFjZS5Db25zdC5JZ25vcmUuTG9jYWxDaGFyYWN0ZXIuQm90dG9tCiAgICBsb2NhbCB0b3AgPSB3b3Jrc3BhY2UuQ29uc3QuSWdub3JlLkxvY2FsQ2hhcmFjdGVyLlRvcAogICAgbG9jYWwgY2hhcmFjdGVycGFyYW1zID0gUmF5Y2FzdFBhcmFtcy5uZXcoKQogICAgY2hhcmFjdGVycGFyYW1zLklnbm9yZVdhdGVyID0gdHJ1ZQogICAgY2hhcmFjdGVycGFyYW1zLkZpbHRlckRlc2NlbmRhbnRzSW5zdGFuY2VzID0geyB3b3Jrc3BhY2UuQ29uc3QuSWdub3JlIH0KICAgIGNoYXJhY3RlcnBhcmFtcy5GaWx0ZXJUeXBlID0gRW51bS5SYXljYXN0RmlsdGVyVHlwZS5FeGNsdWRlCiAgICBjaGFyYWN0ZXJwYXJhbXMuUmVzcGVjdENhbkNvbGxpZGUgPSB0cnVlCgogICAgbG9jYWwgbmlnYSwgd3RmID0gc3BlZWQsIDAKICAgIGxvY2FsIGRjX2J1aWxkdXAsIGRjX29sZHBvcyA9IGRvd25jbGlmZl9zcGVlZCwgbWlkZGxlLlBvc2l0aW9uCgogICAgY2hlYXQudXRpbGl0eS5uZXdfcmVuZGVyc3RlcHBlZChMUEhfSklUX01BWChmdW5jdGlvbihkZWx0YSkKICAgICAgICBsb2NhbCBzaGlmdHByZXNzZWQgPSBfSXNLZXlEb3duKFVzZXJJbnB1dFNlcnZpY2UsIEVudW0uS2V5Q29kZS5MZWZ0U2hpZnQpCiAgICAgICAgbG9jYWwgY3ByZXNzZWQgPSBfSXNLZXlEb3duKFVzZXJJbnB1dFNlcnZpY2UsIEVudW0uS2V5Q29kZS5DKQogICAgICAgIGxvY2FsIHNwYWNlZG93biA9IF9Jc0tleURvd24oVXNlcklucHV0U2VydmljZSwgRW51bS5LZXlDb2RlLlNwYWNlKQogICAgICAgIGxvY2FsIGNhbWVyYWxvb2sgPSBDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IKICAgICAgICBsb2NhbCBkaXJlY3Rpb24gaWYgbWlkZGxlIGFuZCAoY3ByZXNzZWQgb3Igc3BhY2Vkb3duIG9yIHNoaWZ0cHJlc3NlZCBvciBmb3JjZXNwcmludCBvciBqZXRwYWNrYWJ1c2UpIHRoZW4KICAgICAgICAgICAgbG9jYWwgbmV1dHJhbGl6ZWRfbG9vayA9IF9WZWN0b3IzbmV3KGNhbWVyYWxvb2suWCwgMCwgY2FtZXJhbG9vay5aKS5Vbml0CiAgICAgICAgICAgIGRpcmVjdGlvbiA9IFZlY3RvcjMuemVybwogICAgICAgICAgICBkaXJlY3Rpb24gPSBfSXNLZXlEb3duKFVzZXJJbnB1dFNlcnZpY2UsIEVudW0uS2V5Q29kZS5XKSBhbmQgZGlyZWN0aW9uICsgbmV1dHJhbGl6ZWRfbG9vayBvciBkaXJlY3Rpb247CiAgICAgICAgICAgIGRpcmVjdGlvbiA9IF9Jc0tleURvd24oVXNlcklucHV0U2VydmljZSwgRW51bS5LZXlDb2RlLlMpIGFuZCBkaXJlY3Rpb24gLSBuZXV0cmFsaXplZF9sb29rIG9yIGRpcmVjdGlvbjsKICAgICAgICAgICAgZGlyZWN0aW9uID0gX0lzS2V5RG93bihVc2VySW5wdXRTZXJ2aWNlLCBFbnVtLktleUNvZGUuRCkgYW5kIGRpcmVjdGlvbiArIF9WZWN0b3IzbmV3KC0gbmV1dHJhbGl6ZWRfbG9vay5aLCAwLCBuZXV0cmFsaXplZF9sb29rLlgpIG9yIGRpcmVjdGlvbjsKICAgICAgICAgICAgZGlyZWN0aW9uID0gX0lzS2V5RG93bihVc2VySW5wdXRTZXJ2aWNlLCBFbnVtLktleUNvZGUuQSkgYW5kIGRpcmVjdGlvbiArIF9WZWN0b3IzbmV3KG5ldXRyYWxpemVkX2xvb2suWiwgMCwgLSBuZXV0cmFsaXplZF9sb29rLlgpIG9yIGRpcmVjdGlvbjsKICAgICAgICBlbmQKICAgICAgICBpZiBiaG9wX3NpbGVudCB0aGVuIHJldHVybiBlbmQKICAgICAgICBpZiBiaG9wX2VuYWJsZWQgYW5kIG5vdCBkb3duY2xpZmZfbW9kZSBhbmQgbWlkZGxlIGFuZCBjcHJlc3NlZCBhbmQgc2hpZnRwcmVzc2VkIHRoZW4KICAgICAgICAgICAgaWYgbm90IChkaXJlY3Rpb24gPT0gVmVjdG9yMy56ZXJvKSB0aGVuCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBkaXJlY3Rpb24uVW5pdAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbmlnYSA9IG1hdGguY2xhbXAobmlnYS1kZWx0YSoyMCwgMTcsIHNwZWVkKQogICAgICAgICAgICBpZiB3dGYgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB0cGNmLCBtZGNmLCBibWNmID0gdG9wLkNGcmFtZSwgbWlkZGxlLkNGcmFtZSwgYm90dG9tLkNGcmFtZQogICAgICAgICAgICAgICAgbWlkZGxlLkNGcmFtZSA9IG1kY2YgKyBfVmVjdG9yM25ldygwLCA2LCAwKQogICAgICAgICAgICAgICAgYm90dG9tLkNGcmFtZSA9IGJtY2YgKyBfVmVjdG9yM25ldygwLCA2LCAwKQogICAgICAgICAgICAgICAgdG9wLkNGcmFtZSA9IHRwY2YgKyBfVmVjdG9yM25ldygwLCA2LCAwKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbWlkZGxlLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSAoZGlyZWN0aW9uICogbmlnYSkgKyAoVmVjdG9yMy55QXhpcyAqICh3dGYgPCAwLjg1IGFuZCAwIG9yIC03KSkKICAgICAgICAgICAgYm90dG9tLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSAoZGlyZWN0aW9uICogbmlnYSkgKyAoVmVjdG9yMy55QXhpcyAqICh3dGYgPCAwLjg1IGFuZCAwIG9yIC03KSkKICAgICAgICAgICAgdG9wLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSAoZGlyZWN0aW9uICogbmlnYSkgKyAoVmVjdG9yMy55QXhpcyAqICh3dGYgPCAwLjg1IGFuZCAwIG9yIC03KSkKICAgICAgICAgICAgd3RmID0gd3RmICsgZGVsdGEKICAgICAgICBlbHNlaWYgYmhvcF9lbmFibGVkIGFuZCBkb3duY2xpZmZfbW9kZSBhbmQgbWlkZGxlIGFuZCBjcHJlc3NlZCBhbmQgc2hpZnRwcmVzc2VkIHRoZW4KICAgICAgICAgICAgaWYgbm90IChkaXJlY3Rpb24gPT0gVmVjdG9yMy56ZXJvKSB0aGVuCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBkaXJlY3Rpb24uVW5pdAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIC0tW1sKICAgICAgICAgICAgbWlkZGxlLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSAoZGlyZWN0aW9uICogZGNfYnVpbGR1cCkgKyAoVmVjdG9yMy55QXhpcyAqIC0oc3BhY2Vkb3duIGFuZCA3IG9yIGRvd25jbGlmZl9mYWxsKSkKICAgICAgICAgICAgYm90dG9tLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSAoZGlyZWN0aW9uICogZGNfYnVpbGR1cCkgKyAoVmVjdG9yMy55QXhpcyAqIC0oc3BhY2Vkb3duIGFuZCA3IG9yIGRvd25jbGlmZl9mYWxsKSkKICAgICAgICAgICAgdG9wLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSAoZGlyZWN0aW9uICogZGNfYnVpbGR1cCkgKyAoVmVjdG9yMy55QXhpcyAqIC0oc3BhY2Vkb3duIGFuZCA3IG9yIGRvd25jbGlmZl9mYWxsKSkKCiAgICAgICAgICAgIGRjX2J1aWxkdXAgPSBtYXRoLmNsYW1wKGRjX2J1aWxkdXAgKyAoZG93bmNsaWZmX2FjY2VsICogKG1hdGguYWJzKGRjX29sZHBvcy5ZIC0gbWlkZGxlLlBvc2l0aW9uLlkpIC8gMC4xNSkgLSA1MCAtIChzcGFjZWRvd24gYW5kIDcgb3IgMCkpICogZGVsdGEsIDE3LCAzMDApCiAgICAgICAgICAgIGRjX29sZHBvcyA9IG1pZGRsZS5Qb3NpdGlvbgogICAgICAgICAgICBdXQoKICAgICAgICAgICAgbG9jYWwgd2F0dGFzaWdtYSA9IG1pZGRsZS5Qb3NpdGlvbgogICAgICAgICAgICBsb2NhbCBzcGVlZF9kaXIgPSBkaXJlY3Rpb24gKiBkY19idWlsZHVwICogZGVsdGEKICAgICAgICAgICAgbG9jYWwgdmVydGljYWxyYyA9IF9SYXljYXN0KHdvcmtzcGFjZSwgd2F0dGFzaWdtYSwgLVZlY3RvcjMueUF4aXMgKiAyMCwgY2hhcmFjdGVycGFyYW1zKQogICAgICAgICAgICBsb2NhbCBob3Jpem9udGFscmMgPSBfUmF5Y2FzdCh3b3Jrc3BhY2UsIHZlcnRpY2FscmMgYW5kIHZlcnRpY2FscmMuUG9zaXRpb24gb3Igd2F0dGFzaWdtYSwgc3BlZWRfZGlyLCBjaGFyYWN0ZXJwYXJhbXMpCgogICAgICAgICAgICBwcmludChob3Jpem9udGFscmMsIHZlY3J0aWNhbHJjKQogICAgICAgICAgICBwcmludChob3Jpem9udGFscmMgYW5kIGhvcml6b250YWxyYy5Qb3NpdGlvbiwgdmVjcnRpY2FscmMgYW5kIHZlY3J0aWNhbHJjLlBvc2l0aW9uKQoKICAgICAgICAgICAgZGNfYnVpbGR1cCA9IG1hdGguY2xhbXAodmVjcnRpY2FscmMgYW5kIGRjX2J1aWxkdXAgKyBkb3duY2xpZmZfYWNjZWwgKiBtYXRoLmFicyh3YXR0YXNpZ21hLlkgLSB2ZXJ0aWNhbHJjLlBvc2l0aW9uLlkpIG9yIGRjX2J1aWxkdXAgLSBkZWx0YSAqIDMwICwgMTcsIDI1MCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGhvcml6b250YWxyYyBvciB2ZXJ0aWNhbHJjIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIG1pZGRsZV9wb3MgPSAoaG9yaXpvbnRhbHJjIG9yIHZlcnRpY2FscmMpLlBvc2l0aW9uICsgVmVjdG9yMy55QXhpcyAqIDEuNQogICAgICAgICAgICAgICAgbG9jYWwgYm90dG9tX29mZnNldCA9IGJvdHRvbS5Qb3NpdGlvbiAtIG1pZGRsZV9wb3MKICAgICAgICAgICAgICAgIGxvY2FsIHRvcF9vZmZzZXQgPSB0b3AuUG9zaXRpb24gIC0gbWlkZGxlX3BvcwogICAgICAgICAgICAgICAgbWlkZGxlLkNGcmFtZSA9IF9DRnJhbWVuZXcobWlkZGxlX3BvcykKICAgICAgICAgICAgICAgIGJvdHRvbS5DRnJhbWUgPSBfQ0ZyYW1lbmV3KG1pZGRsZV9wb3MgKyBib3R0b21fb2Zmc2V0KQogICAgICAgICAgICAgICAgdG9wLkNGcmFtZSA9IF9DRnJhbWVuZXcobWlkZGxlX3BvcyArIHRvcF9vZmZzZXQpCiAgICAgICAgICAgICAgICBtaWRkbGUuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybyAtLShkaXJlY3Rpb24gKiBkY19idWlsZHVwKQogICAgICAgICAgICAgICAgYm90dG9tLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8gLS0oZGlyZWN0aW9uICogZGNfYnVpbGR1cCkKICAgICAgICAgICAgICAgIHRvcC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvIC0tKGRpcmVjdGlvbiAqIGRjX2J1aWxkdXApCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG1pZGRsZS5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gKGRpcmVjdGlvbiAqIGRjX2J1aWxkdXApICsgKFZlY3RvcjMueUF4aXMgKiAtNykKICAgICAgICAgICAgICAgIGJvdHRvbS5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gKGRpcmVjdGlvbiAqIGRjX2J1aWxkdXApICsgKFZlY3RvcjMueUF4aXMgKiAtNykKICAgICAgICAgICAgICAgIHRvcC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gKGRpcmVjdGlvbiAqIGRjX2J1aWxkdXApICsgKFZlY3RvcjMueUF4aXMgKiAtNykKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAtLVtbCiAgICAgICAgICAgIGlmIHNwYWNlZG93biBhbmQgd3RmID09IDAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdHBjZiwgbWRjZiwgYm1jZiA9IHRvcC5DRnJhbWUsIG1pZGRsZS5DRnJhbWUsIGJvdHRvbS5DRnJhbWUKICAgICAgICAgICAgICAgIG1pZGRsZS5DRnJhbWUgPSBtZGNmICsgX1ZlY3RvcjNuZXcoMCwgNiwgMCkKICAgICAgICAgICAgICAgIGJvdHRvbS5DRnJhbWUgPSBibWNmICsgX1ZlY3RvcjNuZXcoMCwgNiwgMCkKICAgICAgICAgICAgICAgIHRvcC5DRnJhbWUgPSB0cGNmICsgX1ZlY3RvcjNuZXcoMCwgNiwgMCkKICAgICAgICAgICAgICAgIHd0ZiA9IHd0ZiArIGRlbHRhCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBkY19idWlsZHVwID0gbWF0aC5jbGFtcChzcGFjZWRvd24gYW5kIGRjX2J1aWxkdXAtZGVsdGEqMjUgb3IgZGNfYnVpbGR1cCtkZWx0YSpkb3duY2xpZmZfYWNjZWwsIDE3LCAyNTApCiAgICAgICAgICAgIG1pZGRsZS5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gX1ZlY3RvcjNuZXcoCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24uWCAqIGRjX2J1aWxkdXAsCiAgICAgICAgICAgICAgICBzcGFjZWRvd24gYW5kIC03IG9yIC1kb3duY2xpZmZfZmFsbCwKICAgICAgICAgICAgICAgIGRpcmVjdGlvbi5aICogZGNfYnVpbGR1cAogICAgICAgICAgICApCiAgICAgICAgICAgIGJvdHRvbS5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gX1ZlY3RvcjNuZXcoCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24uWCAqIGRjX2J1aWxkdXAsCiAgICAgICAgICAgICAgICBzcGFjZWRvd24gYW5kIC03IG9yIC1kb3duY2xpZmZfZmFsbCwKICAgICAgICAgICAgICAgIGRpcmVjdGlvbi5aICogZGNfYnVpbGR1cAogICAgICAgICAgICApCiAgICAgICAgICAgIHRvcC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gX1ZlY3RvcjNuZXcoCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24uWCAqIGRjX2J1aWxkdXAsCiAgICAgICAgICAgICAgICBzcGFjZWRvd24gYW5kIC03IG9yIC1kb3duY2xpZmZfZmFsbCwKICAgICAgICAgICAgICAgIGRpcmVjdGlvbi5aICogZGNfYnVpbGR1cAogICAgICAgICAgICApXV0KICAgICAgICBlbHNlaWYgamV0cGFja2FidXNlIGFuZCBtaWRkbGUgdGhlbgogICAgICAgICAgICBpZiBub3QgKGRpcmVjdGlvbiA9PSBWZWN0b3IzLnplcm8pIHRoZW4KICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGRpcmVjdGlvbi5Vbml0CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCB5dmVsbyA9IHNwYWNlZG93biBhbmQgYWJ1c2V1cHNwZWVkIG9yIHNoaWZ0cHJlc3NlZCBhbmQgLWFidXNlZG93bnNwZWVkIG9yIChub3Qgc2hpZnRwcmVzc2VkIGFuZCBub3Qgc3BhY2Vkb3duKSBhbmQgMAogICAgICAgICAgICBtaWRkbGUuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IF9WZWN0b3IzbmV3KAogICAgICAgICAgICAgICAgZGlyZWN0aW9uLlggKiAxOCwKICAgICAgICAgICAgICAgIHl2ZWxvLAogICAgICAgICAgICAgICAgZGlyZWN0aW9uLlogKiAxOAogICAgICAgICAgICApCiAgICAgICAgICAgIHRvcC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gX1ZlY3RvcjNuZXcoCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24uWCAqIDE4LAogICAgICAgICAgICAgICAgeXZlbG8sCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24uWiAqIDE4CiAgICAgICAgICAgICkKICAgICAgICAgICAgYm90dG9tLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBfVmVjdG9yM25ldygKICAgICAgICAgICAgICAgIGRpcmVjdGlvbi5YICogMTgsCiAgICAgICAgICAgICAgICB5dmVsbywKICAgICAgICAgICAgICAgIGRpcmVjdGlvbi5aICogMTgKICAgICAgICAgICAgKQogICAgICAgIGVsc2UKICAgICAgICAgICAgaWYgZm9yY2VzcHJpbnQgYW5kIG1pZGRsZSB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgKGRpcmVjdGlvbiA9PSBWZWN0b3IzLnplcm8pIHRoZW4KICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBkaXJlY3Rpb24uVW5pdAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBtaWRkbGUuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IF9WZWN0b3IzbmV3KAogICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbi5YICogMTgsCiAgICAgICAgICAgICAgICAgICAgbWlkZGxlLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkuWSwKICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24uWiAqIDE4CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBuaWdhID0gc3BlZWQKICAgICAgICAgICAgZGNfYnVpbGR1cCA9IDU1CiAgICAgICAgICAgIGRjX29sZHBvcyA9IG1pZGRsZS5Qb3NpdGlvbgogICAgICAgICAgICB3dGYgPSAwCiAgICAgICAgZW5kCiAgICBlbmQpKQplbmQKCmRvCiAgICBsb2NhbCBtdmIgPSB1aS5ib3gubW92ZTpBZGRUYWIoJ2V4cGxvaXRzJykKICAgIGxvY2FsIGVuYWJsZWQsIHNwZWVkLCBwYXJ0ID0gZmFsc2UsIDU1LCAiYm90dG9tIgogICAgbXZiOkFkZFRvZ2dsZSgnZGVzeW5jX2VuYWJsZWQnLCB7VGV4dCA9ICdkZXN5bmMgZW5hYmxlZCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgbW9kdWxlY29tbS5pbnZpcyA9IGZpcnN0CiAgICBlbmR9KTpBZGRLZXlQaWNrZXIoJ2Rlc3luY2JpbmQnLCB7RGVmYXVsdCA9ICdOb25lJyxTeW5jVG9nZ2xlU3RhdGUgPSB0cnVlLE1vZGUgPSAnVG9nZ2xlJyxUZXh0ID0gJ2Rlc3luYycsTm9VSSA9IGZhbHNlfSkKICAgIG12YjpBZGRUb2dnbGUoJ3ZlbG9jaXR5YnJlYWtlcicsIHtUZXh0ID0gJ3ZlbG9jaXR5IGJyZWFrZXInLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIG1vZHVsZWNvbW0udmVsb2JyZWFrID0gZmlyc3QKICAgIGVuZH0pOkFkZEtleVBpY2tlcigndmVsb2NpdHlicmVha2VyYmluZCcsIHtEZWZhdWx0ID0gJ05vbmUnLFN5bmNUb2dnbGVTdGF0ZSA9IHRydWUsTW9kZSA9ICdUb2dnbGUnLFRleHQgPSAndmVsb2NpdHkgYnJlYWtlcicsTm9VSSA9IGZhbHNlfSkKICAgIG12YjpBZGRTbGlkZXIoJ3ZlbG9jaXR5YnJlYWtlcl9zdHJlbmdodCcseyBUZXh0ID0gJ3N0cmVuZ2h0JywgRGVmYXVsdCA9IDYsIE1pbiA9IDAsIE1heCA9IDIwLCBSb3VuZGluZyA9IDEsIFN1ZmZpeCA9ICJzIiwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBtb2R1bGVjb21tLnZlbG9icmVha3N0cmVuZ2h0ID0gU3RhdGUKICAgIGVuZCkKICAgIG12YjpBZGRUb2dnbGUoJ3NpbGVudHdhbGtfZW5hYmxlZCcsIHtUZXh0ID0gJ3NpbGVudCB3YWxraW5nJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBtb2R1bGVjb21tLnNpbGVudHdhbGsgPSBmaXJzdAogICAgICAgIGlmIGZpcnN0IHRoZW4gdHJpZGVudC50Y3A6RmlyZVNlcnZlcigyLCB0cnVlKSBlbmQKICAgIGVuZH0pOkFkZEtleVBpY2tlcignc2lsZW50d2Fsa19iaW5kJywge0RlZmF1bHQgPSAnTm9uZScsU3luY1RvZ2dsZVN0YXRlID0gdHJ1ZSxNb2RlID0gJ1RvZ2dsZScsVGV4dCA9ICdzaWxlbnQgd2FsaycsTm9VSSA9IGZhbHNlfSkKICAgIGxvY2FsIGZyZWVjYW1vZmZzZXQgPSBWZWN0b3IzLnplcm8KICAgIGxvY2FsIG1pZGRsZSA9IHdvcmtzcGFjZS5Db25zdC5JZ25vcmUuTG9jYWxDaGFyYWN0ZXIuTWlkZGxlCiAgICBsb2NhbCBib3R0b20gPSB3b3Jrc3BhY2UuQ29uc3QuSWdub3JlLkxvY2FsQ2hhcmFjdGVyLkJvdHRvbQogICAgbG9jYWwgdG9wID0gd29ya3NwYWNlLkNvbnN0Lklnbm9yZS5Mb2NhbENoYXJhY3Rlci5Ub3AKICAgIGxvY2FsIG1kcG9zLCBibXBvcywgdHBwb3MgPSBtaWRkbGUuQ0ZyYW1lLCBib3R0b20uQ0ZyYW1lLCB0b3AuQ0ZyYW1lCiAgICBtdmI6QWRkVG9nZ2xlKCdmcmVlY2FtX2VuYWJsZWQnLCB7VGV4dCA9ICdmcmVlY2FtIGVuYWJsZWQnLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKGZpcnN0KQogICAgICAgIGVuYWJsZWQgPSBmaXJzdAogICAgICAgIG1pZGRsZS5DYW5Db2xsaWRlID0gbm90IGZpcnN0CiAgICAgICAgYm90dG9tLkNhbkNvbGxpZGUgPSBub3QgZmlyc3QKICAgICAgICB0b3AuQ2FuQ29sbGlkZSA9IG5vdCBmaXJzdAogICAgZW5kfSk6QWRkS2V5UGlja2VyKCdmcmVlY2FtX2JpbmQnLCB7RGVmYXVsdCA9ICdOb25lJyxTeW5jVG9nZ2xlU3RhdGUgPSB0cnVlLE1vZGUgPSAnVG9nZ2xlJyxUZXh0ID0gJ2ZyZWVjYW0nLE5vVUkgPSBmYWxzZX0pCiAgICBtdmI6QWRkU2xpZGVyKCdmcmVlY2FtX3NwZWVkJyx7IFRleHQgPSAnc3BlZWQnLCBEZWZhdWx0ID0gMTAsIE1pbiA9IDEsIE1heCA9IDE1MCwgUm91bmRpbmcgPSAwLCBTdWZmaXggPSAic3BzIiwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBzcGVlZCA9IFN0YXRlCiAgICBlbmQpCiAgICBtdmI6QWRkRHJvcGRvd24oJ2ZyZWVjYW1fcGFydCcsIHtWYWx1ZXM9eyJtaWRkbGUiLCAiYm90dG9tIiwgInRvcCJ9LERlZmF1bHQgPSAxLE11bHRpID0gZmFsc2UsVGV4dCA9ICdmcmVlY2FtIHBhcnQnLENhbGxiYWNrPWZ1bmN0aW9uKFZhbHVlKQogICAgICAgIHBhcnQgPSBWYWx1ZQogICAgZW5kfSkKICAgIG12YjpBZGRUb2dnbGUoJ3NpbGVudGFpbV9leHRlbmRlZCcsIHtUZXh0ID0gJ2Zha2VsYWcnLERlZmF1bHQgPSBmYWxzZSxDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIG1vZHVsZWNvbW0uZXh0ZW5kZWRfbWFuaXB1bGF0aW9uID0gVmFsdWUKICAgIGVuZH0pOkFkZEtleVBpY2tlcignZmFrZWxhZ19iaW5kJywge0RlZmF1bHQgPSAnTm9uZScsU3luY1RvZ2dsZVN0YXRlID0gdHJ1ZSxNb2RlID0gJ1RvZ2dsZScsVGV4dCA9ICdmYWtlbGFnJyxOb1VJID0gZmFsc2V9KQogICAgbXZiOkFkZFRvZ2dsZSgnaW5maW5pdGV1bnJlZ3RlY2huaXF1ZScsIHtUZXh0ID0gJ2luZmluaXRlIHJlZ2lzdGVyIHRlY2huaXF1ZScsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgbW9kdWxlY29tbS5pbmZpbml0ZXJlZ2lzdGVyID0gZmlyc3QKICAgIGVuZH0pCiAgICBjaGVhdC51dGlsaXR5Lm5ld19oZWFydGJlYXQoTFBIX0pJVF9NQVgoZnVuY3Rpb24oZGVsdGEpCiAgICAgICAgaWYgZW5hYmxlZCBhbmQgbWlkZGxlIHRoZW4KICAgICAgICAgICAgaWYgcGFydCA9PSAibWlkZGxlIiB0aGVuIG1pZGRsZS5DRnJhbWUgPSBtZHBvcyBlbmQKICAgICAgICAgICAgaWYgcGFydCA9PSAiYm90dG9tIiB0aGVuIGJvdHRvbS5DRnJhbWUgPSBibXBvcyBlbmQKICAgICAgICAgICAgaWYgcGFydCA9PSAidG9wIiB0aGVuIHRvcC5DRnJhbWUgPSB0cHBvcyBlbmQKICAgICAgICAgICAgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKQogICAgICAgICAgICBpZiBtaWRkbGUgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY2FtZXJhbG9vayA9IENhbWVyYS5DRnJhbWUuTG9va1ZlY3RvcgogICAgICAgICAgICAgICAgbG9jYWwgZGlyZWN0aW9uID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBfSXNLZXlEb3duKFVzZXJJbnB1dFNlcnZpY2UsIEVudW0uS2V5Q29kZS5XKSBhbmQgZGlyZWN0aW9uICsgY2FtZXJhbG9vayBvciBkaXJlY3Rpb247CiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBfSXNLZXlEb3duKFVzZXJJbnB1dFNlcnZpY2UsIEVudW0uS2V5Q29kZS5TKSBhbmQgZGlyZWN0aW9uIC0gY2FtZXJhbG9vayBvciBkaXJlY3Rpb247CiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBfSXNLZXlEb3duKFVzZXJJbnB1dFNlcnZpY2UsIEVudW0uS2V5Q29kZS5EKSBhbmQgZGlyZWN0aW9uICsgX1ZlY3RvcjNuZXcoLSBjYW1lcmFsb29rLlosIDAsIGNhbWVyYWxvb2suWCkgb3IgZGlyZWN0aW9uOwogICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gX0lzS2V5RG93bihVc2VySW5wdXRTZXJ2aWNlLCBFbnVtLktleUNvZGUuQSkgYW5kIGRpcmVjdGlvbiArIF9WZWN0b3IzbmV3KGNhbWVyYWxvb2suWiwgMCwgLSBjYW1lcmFsb29rLlgpIG9yIGRpcmVjdGlvbjsKICAgICAgICAgICAgICAgIGlmIG5vdCBkaXJlY3Rpb24gPT0gVmVjdG9yMy56ZXJvIHRoZW4KICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBkaXJlY3Rpb24uVW5pdAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBmcmVlY2Ftb2Zmc2V0ID0gZnJlZWNhbW9mZnNldCArIChkaXJlY3Rpb24gKiBkZWx0YSAqIHNwZWVkKQogICAgICAgICAgICAgICAgaWYgcGFydCA9PSAibWlkZGxlIiB0aGVuIG1pZGRsZS5DRnJhbWUgPSBtZHBvcyArIGZyZWVjYW1vZmZzZXQgZW5kCiAgICAgICAgICAgICAgICBpZiBwYXJ0ID09ICJib3R0b20iIHRoZW4gYm90dG9tLkNGcmFtZSA9IGJtcG9zICsgZnJlZWNhbW9mZnNldCBlbmQKICAgICAgICAgICAgICAgIGlmIHBhcnQgPT0gInRvcCIgdGhlbiB0b3AuQ0ZyYW1lID0gdHBwb3MgKyBmcmVlY2Ftb2Zmc2V0IGVuZAogICAgICAgICAgICAgICAgbWlkZGxlLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8KICAgICAgICAgICAgICAgIGJvdHRvbS5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgICAgICB0b3AuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgbWlkZGxlIHRoZW4KICAgICAgICAgICAgZnJlZWNhbW9mZnNldCA9IFZlY3RvcjMuemVybwogICAgICAgICAgICBtZHBvcywgYm1wb3MsIHRwcG9zID0gbWlkZGxlLkNGcmFtZSwgYm90dG9tLkNGcmFtZSwgdG9wLkNGcmFtZQogICAgICAgIGVuZAogICAgZW5kKSkKZW5kCgpkbwogICAgbG9jYWwgbXZiID0gdWkuYm94LmF0dmZseTpBZGRUYWIoJ2F0diBmbHknKQogICAgbG9jYWwgY2FyZmx5X2VuYWJsZWQsIHNwZWVkLCBhY2NlbCwgdXBzcGVlZCA9IGZhbHNlLCA1NSwgMTAwLCAyMDAKICAgIG12YjpBZGRUb2dnbGUoJ2NhcmZseV9lbmFibGVkJywge1RleHQgPSAnY2FyIGZseSBlbmFibGVkJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICBjYXJmbHlfZW5hYmxlZCA9IGZpcnN0CiAgICBlbmR9KTpBZGRLZXlQaWNrZXIoJ2NhcmZseV9iaW5kJywge0RlZmF1bHQgPSAnTm9uZScsU3luY1RvZ2dsZVN0YXRlID0gdHJ1ZSxNb2RlID0gJ1RvZ2dsZScsVGV4dCA9ICdjYXIgZmx5IGJpbmQnLE5vVUkgPSBmYWxzZX0pCiAgICBtdmI6QWRkU2xpZGVyKCdjYXJmbHlfc3BlZWQnLHsgVGV4dCA9ICdzcGVlZCcsIERlZmF1bHQgPSAxNTAsIE1pbiA9IDUwLCBNYXggPSAzMDAsIFJvdW5kaW5nID0gMCwgU3VmZml4ID0gInNwcyIsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgc3BlZWQgPSBTdGF0ZQogICAgZW5kKQogICAgbXZiOkFkZFNsaWRlcignY2FyZmx5X3Vwc3BlZWQnLHsgVGV4dCA9ICd1cCBzcGVlZCcsIERlZmF1bHQgPSAxNSwgTWluID0gNSwgTWF4ID0gMzAsIFJvdW5kaW5nID0gMCwgU3VmZml4ID0gInNwcyIsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgdXBzcGVlZCA9IFN0YXRlCiAgICBlbmQpCiAgICBtdmI6QWRkU2xpZGVyKCdjYXJmbHlfYWNjZWwnLHsgVGV4dCA9ICdhY2NlbGVyYXRpb24nLCBEZWZhdWx0ID0gMTAwLCBNaW4gPSAxMCwgTWF4ID0gMzAwLCBSb3VuZGluZyA9IDAsIFN1ZmZpeCA9ICJzcHMiLCBDb21wYWN0ID0gZmFsc2UgfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKFN0YXRlKQogICAgICAgIGFjY2VsID0gU3RhdGUKICAgIGVuZCkKICAgIG12YjpBZGRMYWJlbCgiaG9sZCBWIHRvIGdvIHVwIikKICAgIG12YjpBZGRMYWJlbCgiaG9sZCBCIHRvIGdvIGRvd24iKQogICAgbG9jYWwgY2FyLCBkaXN0ID0gbmlsLCA1MAogICAgbG9jYWwgZmluZGNhciA9IGZ1bmN0aW9uKCkKICAgICAgICBjYXIsIGRpc3QgPSBuaWwsIDUwCiAgICAgICAgZm9yIGksdiBpbiBwYWlycyh3b3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgX0ZpbmRGaXJzdENoaWxkKHYsICJTZWF0IikgYW5kIF9GaW5kRmlyc3RDaGlsZCh2LCAiRnJhbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBpZiAodi5GcmFtZS5Qb3NpdGlvbiAtIHRyaWRlbnQubWlkZGxlcGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDwgZGlzdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgY2FyID0gdgogICAgICAgICAgICAgICAgICAgIGRpc3QgPSAodi5GcmFtZS5Qb3NpdGlvbiAtIHRyaWRlbnQubWlkZGxlcGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGZpbmRjYXIoKQogICAgbG9jYWwgYnVpbGR1cCA9IDAKICAgIGxvY2FsIGxhc3RkaXIgPSBfVmVjdG9yM25ldygxLDAsMCkKICAgIGNoZWF0LnV0aWxpdHkubmV3X3JlbmRlcnN0ZXBwZWQoTFBIX0pJVF9NQVgoZnVuY3Rpb24oZGVsdGEpCiAgICAgICAgaWYgY2FyZmx5X2VuYWJsZWQgYW5kIGNhciBhbmQgX0ZpbmRGaXJzdENoaWxkKGNhciwgIkZyYW1lIikgYW5kIChjYXIuRnJhbWUuQ0ZyYW1lLnAgLSBDYW1lcmEuQ0ZyYW1lLnApLk1hZ25pdHVkZSA8PSA1MCB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNhbWVyYWxvb2sgPSBDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IKICAgICAgICAgICAgY2FtZXJhbG9vayA9IF9WZWN0b3IzbmV3KGNhbWVyYWxvb2suWCwgMCwgY2FtZXJhbG9vay5aKQogICAgICAgICAgICBsb2NhbCBkaXJlY3Rpb24gPSBWZWN0b3IzLnplcm8KICAgICAgICAgICAgZGlyZWN0aW9uID0gX0lzS2V5RG93bihVc2VySW5wdXRTZXJ2aWNlLCBFbnVtLktleUNvZGUuVykgYW5kIGRpcmVjdGlvbiArIGNhbWVyYWxvb2sgb3IgZGlyZWN0aW9uOwogICAgICAgICAgICBkaXJlY3Rpb24gPSBfSXNLZXlEb3duKFVzZXJJbnB1dFNlcnZpY2UsIEVudW0uS2V5Q29kZS5TKSBhbmQgZGlyZWN0aW9uIC0gY2FtZXJhbG9vayBvciBkaXJlY3Rpb247CiAgICAgICAgICAgIGRpcmVjdGlvbiA9IF9Jc0tleURvd24oVXNlcklucHV0U2VydmljZSwgRW51bS5LZXlDb2RlLkQpIGFuZCBkaXJlY3Rpb24gKyBfVmVjdG9yM25ldygtIGNhbWVyYWxvb2suWiwgMCwgY2FtZXJhbG9vay5YKSBvciBkaXJlY3Rpb247CiAgICAgICAgICAgIGRpcmVjdGlvbiA9IF9Jc0tleURvd24oVXNlcklucHV0U2VydmljZSwgRW51bS5LZXlDb2RlLkEpIGFuZCBkaXJlY3Rpb24gKyBfVmVjdG9yM25ldyhjYW1lcmFsb29rLlosIDAsIC0gY2FtZXJhbG9vay5YKSBvciBkaXJlY3Rpb247CiAgICAgICAgICAgIGRpcmVjdGlvbiA9IF9Jc0tleURvd24oVXNlcklucHV0U2VydmljZSwgRW51bS5LZXlDb2RlLlYpIGFuZCBkaXJlY3Rpb24gKyBWZWN0b3IzLnlBeGlzIG9yIGRpcmVjdGlvbjsKICAgICAgICAgICAgZGlyZWN0aW9uID0gX0lzS2V5RG93bihVc2VySW5wdXRTZXJ2aWNlLCBFbnVtLktleUNvZGUuQikgYW5kIGRpcmVjdGlvbiAtIFZlY3RvcjMueUF4aXMgb3IgZGlyZWN0aW9uOwogICAgICAgICAgICBpZiBkaXJlY3Rpb24gfj0gVmVjdG9yMy56ZXJvIHRoZW4KICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGRpcmVjdGlvbi5Vbml0CiAgICAgICAgICAgICAgICBpZiBkaXJlY3Rpb24gfj0gX1ZlY3RvcjNuZXcoMCwgMSwgMCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGJ1aWxkdXAgPSBtYXRoLmNsYW1wKGJ1aWxkdXAgKyBkZWx0YSAqIGFjY2VsLCAwLCBzcGVlZCkKICAgICAgICAgICAgICAgICAgICBsYXN0ZGlyID0gZGlyZWN0aW9uCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gbGFzdGRpcgogICAgICAgICAgICAgICAgYnVpbGR1cCA9IG1hdGguY2xhbXAoYnVpbGR1cCAtIGRlbHRhICogMTAwLCAwLCBzcGVlZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoY2FyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICB2LkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBfVmVjdG9yM25ldyhkaXJlY3Rpb24uWCAqIGJ1aWxkdXAsIGRpcmVjdGlvbi5ZICogdXBzcGVlZCwgZGlyZWN0aW9uLlogKiBidWlsZHVwKQogICAgICAgICAgICAgICAgLS12LkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBkaXJlY3Rpb24gKiBTUEVFRCArIF9WZWN0b3IzbmV3KDAsIDAuMDUsIDApCiAgICAgICAgICAgICAgICAtLXYuQ0ZyYW1lID0gX0NGcmFtZW5ldyh2LkNGcmFtZS5Qb3NpdGlvbikgKiBDRnJhbWUuQW5nbGVzKDAsIHkrKG1hdGgucGkvMiksIDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBub3QgY2FyIG9yIGNhciBhbmQgY2FyOkZpbmRGaXJzdENoaWxkKCJGcmFtZSIpIGFuZCAoY2FyLkZyYW1lLkNGcmFtZS5wIC0gQ2FtZXJhLkNGcmFtZS5wKS5NYWduaXR1ZGUgPiA1MCB0aGVuCiAgICAgICAgICAgIGZpbmRjYXIoKQogICAgICAgICAgICBidWlsZHVwID0gMAogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVpbGR1cCA9IDAKICAgICAgICBlbmQKICAgIGVuZCkpCiAgICAtLVs9WwogICAgbG9jYWwgbXZiID0gdWkuYm94LmF0dmZseTpBZGRUYWIoJ3ZlaGljbGUgZmx5JykKICAgIGxvY2FsIGNhcmZseV9lbmFibGVkLCBzcGVlZCwgYWNjZWwsIHVwc3BlZWQgPSBmYWxzZSwgNTUsIDEwMCwgMTUKICAgIG12YjpBZGRUb2dnbGUoJ2NhcmZseV9lbmFibGVkJywge1RleHQgPSAndmVoaWNsZSBmbHkgZW5hYmxlZCcsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgY2FyZmx5X2VuYWJsZWQgPSBmaXJzdAogICAgZW5kfSk6QWRkS2V5UGlja2VyKCdjYXJmbHlfYmluZCcsIHtEZWZhdWx0ID0gJ05vbmUnLFN5bmNUb2dnbGVTdGF0ZSA9IHRydWUsTW9kZSA9ICdUb2dnbGUnLFRleHQgPSAndmVoaWNsZSBmbHknLE5vVUkgPSBmYWxzZX0pCiAgICBtdmI6QWRkU2xpZGVyKCdjYXJmbHlfc3BlZWQnLHsgVGV4dCA9ICdzcGVlZCcsIERlZmF1bHQgPSAxNTAsIE1pbiA9IDUwLCBNYXggPSAzMDAsIFJvdW5kaW5nID0gMCwgU3VmZml4ID0gInNwcyIsIENvbXBhY3QgPSBmYWxzZSB9KTpPbkNoYW5nZWQoZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgc3BlZWQgPSBTdGF0ZQogICAgZW5kKQogICAgbXZiOkFkZFNsaWRlcignY2FyZmx5X3Vwc3BlZWQnLHsgVGV4dCA9ICd1cCBzcGVlZCcsIERlZmF1bHQgPSAxNSwgTWluID0gNSwgTWF4ID0gMTAwLCBSb3VuZGluZyA9IDAsIFN1ZmZpeCA9ICJzcHMiLCBDb21wYWN0ID0gZmFsc2UgfSk6T25DaGFuZ2VkKGZ1bmN0aW9uKFN0YXRlKQogICAgICAgIHVwc3BlZWQgPSBTdGF0ZQogICAgZW5kKQogICAgbXZiOkFkZFNsaWRlcignY2FyZmx5X2FjY2VsJyx7IFRleHQgPSAnYWNjZWxlcmF0aW9uJywgRGVmYXVsdCA9IDEwMCwgTWluID0gMTAsIE1heCA9IDMwMCwgUm91bmRpbmcgPSAwLCBTdWZmaXggPSAic3BzIiwgQ29tcGFjdCA9IGZhbHNlIH0pOk9uQ2hhbmdlZChmdW5jdGlvbihTdGF0ZSkKICAgICAgICBhY2NlbCA9IFN0YXRlCiAgICBlbmQpCiAgICBtdmI6QWRkTGFiZWwoImhvbGQgViB0byBnbyB1cCIpCiAgICBtdmI6QWRkTGFiZWwoImhvbGQgQiB0byBnbyBkb3duIikKICAgIGxvY2FsIGNhciwgY2FycGFydCwgZGlzdCA9IG5pbCwgbmlsLCA1MAogICAgbG9jYWwgZmluZGNhciA9IGZ1bmN0aW9uKCkKICAgICAgICBjYXIsIGRpc3QgPSBuaWwsIDUwCiAgICAgICAgZm9yIGksdiBpbiBwYWlycyh3b3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgbG9jYWwgdGVtcF9wYXJ0ID0gKF9GaW5kRmlyc3RDaGlsZCh2LCAiU2VhdCIpIGFuZCBfRmluZEZpcnN0Q2hpbGQodiwgIkZyYW1lIikpIG9yIChfRmluZEZpcnN0Q2hpbGQodiwgIlNlYXRzIikgYW5kIF9GaW5kRmlyc3RDaGlsZCh2LCAiSHVsbCIpKQogICAgICAgICAgICBpZiB0ZW1wX3BhcnQgYW5kICh0ZW1wX3BhcnQuUG9zaXRpb24gLSB0cmlkZW50Lm1pZGRsZXBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8IGRpc3QgdGhlbgogICAgICAgICAgICAgICAgY2FyID0gdgogICAgICAgICAgICAgICAgY2FycGFydCA9IHRlbXBfcGFydAogICAgICAgICAgICAgICAgZGlzdCA9IChjYXJwYXJ0LlBvc2l0aW9uIC0gdHJpZGVudC5taWRkbGVwYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGZpbmRjYXIoKQogICAgbG9jYWwgYnVpbGR1cCA9IDAKICAgIGxvY2FsIGxhc3RkaXIgPSBfVmVjdG9yM25ldygxLDAsMCkKICAgIGNoZWF0LnV0aWxpdHkubmV3X3JlbmRlcnN0ZXBwZWQoTFBIX0pJVF9NQVgoZnVuY3Rpb24oZGVsdGEpCiAgICAgICAgaWYgY2FyZmx5X2VuYWJsZWQgYW5kIGNhciBhbmQgY2FycGFydCBhbmQgKGNhcnBhcnQuQ0ZyYW1lLnAgLSBDYW1lcmEuQ0ZyYW1lLnApLk1hZ25pdHVkZSA8PSA1MCB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNhbWVyYWxvb2sgPSBDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IKICAgICAgICAgICAgY2FtZXJhbG9vayA9IF9WZWN0b3IzbmV3KGNhbWVyYWxvb2suWCwgMCwgY2FtZXJhbG9vay5aKQogICAgICAgICAgICBsb2NhbCBkaXJlY3Rpb24gPSBWZWN0b3IzLnplcm8KICAgICAgICAgICAgZGlyZWN0aW9uID0gX0lzS2V5RG93bihVc2VySW5wdXRTZXJ2aWNlLCBFbnVtLktleUNvZGUuVykgYW5kIGRpcmVjdGlvbiArIGNhbWVyYWxvb2sgb3IgZGlyZWN0aW9uOwogICAgICAgICAgICBkaXJlY3Rpb24gPSBfSXNLZXlEb3duKFVzZXJJbnB1dFNlcnZpY2UsIEVudW0uS2V5Q29kZS5TKSBhbmQgZGlyZWN0aW9uIC0gY2FtZXJhbG9vayBvciBkaXJlY3Rpb247CiAgICAgICAgICAgIGRpcmVjdGlvbiA9IF9Jc0tleURvd24oVXNlcklucHV0U2VydmljZSwgRW51bS5LZXlDb2RlLkQpIGFuZCBkaXJlY3Rpb24gKyBfVmVjdG9yM25ldygtIGNhbWVyYWxvb2suWiwgMCwgY2FtZXJhbG9vay5YKSBvciBkaXJlY3Rpb247CiAgICAgICAgICAgIGRpcmVjdGlvbiA9IF9Jc0tleURvd24oVXNlcklucHV0U2VydmljZSwgRW51bS5LZXlDb2RlLkEpIGFuZCBkaXJlY3Rpb24gKyBfVmVjdG9yM25ldyhjYW1lcmFsb29rLlosIDAsIC0gY2FtZXJhbG9vay5YKSBvciBkaXJlY3Rpb247CiAgICAgICAgICAgIGRpcmVjdGlvbiA9IF9Jc0tleURvd24oVXNlcklucHV0U2VydmljZSwgRW51bS5LZXlDb2RlLlYpIGFuZCBkaXJlY3Rpb24gKyBWZWN0b3IzLnlBeGlzIG9yIGRpcmVjdGlvbjsKICAgICAgICAgICAgZGlyZWN0aW9uID0gX0lzS2V5RG93bihVc2VySW5wdXRTZXJ2aWNlLCBFbnVtLktleUNvZGUuQikgYW5kIGRpcmVjdGlvbiAtIFZlY3RvcjMueUF4aXMgb3IgZGlyZWN0aW9uOwogICAgICAgICAgICBpZiBkaXJlY3Rpb24gfj0gVmVjdG9yMy56ZXJvIHRoZW4KICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGRpcmVjdGlvbi5Vbml0CiAgICAgICAgICAgICAgICBpZiBkaXJlY3Rpb24gfj0gVmVjdG9yMy55QXhpcyBhbmQgLWRpcmVjdGlvbiB+PSBWZWN0b3IzLnlBeGlzIHRoZW4KICAgICAgICAgICAgICAgICAgICBidWlsZHVwID0gbWF0aC5jbGFtcChidWlsZHVwICsgZGVsdGEgKiBhY2NlbCwgMCwgc3BlZWQpCiAgICAgICAgICAgICAgICAgICAgbGFzdGRpciA9IGRpcmVjdGlvbgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGxhc3RkaXIKICAgICAgICAgICAgICAgIGJ1aWxkdXAgPSBtYXRoLmNsYW1wKGJ1aWxkdXAgLSBkZWx0YSAqIDE1MCwgMCwgc3BlZWQpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBjYXJwYXJ0LkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBfVmVjdG9yM25ldyhkaXJlY3Rpb24uWCAqIGJ1aWxkdXAsIGRpcmVjdGlvbi5ZICogdXBzcGVlZCwgZGlyZWN0aW9uLlogKiBidWlsZHVwKQogICAgICAgICAgICAtLXYuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IGRpcmVjdGlvbiAqIFNQRUVEICsgX1ZlY3RvcjNuZXcoMCwgMC4wNSwgMCkKICAgICAgICAgICAgLS12LkNGcmFtZSA9IF9DRnJhbWVuZXcodi5DRnJhbWUuUG9zaXRpb24pICogQ0ZyYW1lLkFuZ2xlcygwLCB5KyhtYXRoLnBpLzIpLCAwKQogICAgICAgIGVsc2VpZiBub3QgY2FycGFydCBvciBjYXIgYW5kIGNhcnBhcnQgYW5kIChjYXJwYXJ0LkNGcmFtZS5wIC0gQ2FtZXJhLkNGcmFtZS5wKS5NYWduaXR1ZGUgPiA1MCB0aGVuCiAgICAgICAgICAgIGZpbmRjYXIoKQogICAgICAgICAgICBidWlsZHVwID0gMAogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVpbGR1cCA9IDAKICAgICAgICBlbmQKICAgIGVuZCkpCiAgICBdPV0KZW5kCmxvYWRzeW50YXhmaWxlKCJjaGF0X3NwYW0ubHVhIikoY2hlYXQuTGlicmFyeSwgdWkuYm94Lm1pc2M6QWRkVGFiKCJjaGF0IHNwYW0iKSwgZnVuY3Rpb24od29yZCkKICAgIHRyaWRlbnQudGNwOkZpcmVTZXJ2ZXIoMjMsIHdvcmQsICJHbG9iYWwiKQplbmQsIDM1LCAxNTApCmRvCiAgICBsb2NhbCBub2F0dnJlc3RyaWN0aW9uID0gZmFsc2UKICAgIGxvY2FsIGNoYXJhY3Rlcm1vZCA9IHVpLmJveC5taXNjOkFkZFRhYigiYXR2IG1vZHMiKQogICAgY2hhcmFjdGVybW9kOkFkZFRvZ2dsZSgnbm9hdHZyZXN0cmljdGlvbicsIHtUZXh0ID0gJ25vIGF0diByZXN0cmljdGlvbicsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpCiAgICAgICAgbm9hdHZyZXN0cmljdGlvbiA9IGZpcnN0CiAgICBlbmR9KQogICAgZG8KICAgICAgICAtLWNhcnRyaXBtb2RlID0gInNpZGUiLCAtLSAibm9uZSIsICJsZWZ0IiwgInJpZ2h0IiwgImZyb250IiwgImJhY2siLCAiemVybyIKICAgICAgICAtLWNhcnlhdyA9ICJub25lIiAtLSBub25lLCBzcGluLCBjdXN0b20KICAgICAgICBsb2NhbCBhYXNldCA9IG1vZHVsZWNvbW0uYW50aWFpbQogICAgICAgIGNoYXJhY3Rlcm1vZDpBZGRUb2dnbGUoJ2FudGlhaW1fY2FyZW5hYmxlZCcsIHtUZXh0ID0gJ2NhciBhbnRpYWltJyxEZWZhdWx0ID0gZmFsc2UsQ2FsbGJhY2sgPSBmdW5jdGlvbihmaXJzdCkKICAgICAgICAgICAgYWFzZXQuY2FyID0gZmlyc3QKICAgICAgICBlbmR9KQogICAgICAgIGNoYXJhY3Rlcm1vZDpBZGREcm9wZG93bignYW50aWFpbV9jYXJ0cmlwJywge1ZhbHVlcz17Im5vbmUiLCAiemVybyJ9LERlZmF1bHQgPSAxLE11bHRpID0gZmFsc2UsVGV4dCA9ICd0cmlwIG1vZGUnLENhbGxiYWNrPWZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICBhYXNldC5jYXJ0cmlwbW9kZSA9IFZhbHVlCiAgICAgICAgZW5kfSkKICAgICAgICBjaGFyYWN0ZXJtb2Q6QWRkRHJvcGRvd24oJ2FudGlhaW1fY2FyeWF3Jywge1ZhbHVlcz17Im5vbmUiLCAic3BpbiIsICJpbnZpc2libGUxIiwgImludmlzaWJsZTIiLCAiaW52aXNpYmxlMyJ9LERlZmF1bHQgPSAxLE11bHRpID0gZmFsc2UsVGV4dCA9ICdjYXIgeWF3JyxDYWxsYmFjaz1mdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgYWFzZXQuY2FyeWF3ID0gVmFsdWUKICAgICAgICBlbmR9KQogICAgICAgIGRvCiAgICAgICAgICAgIGxvY2FsIGFhZGVwYm94ID0gY2hhcmFjdGVybW9kOkFkZERlcGVuZGVuY3lCb3goKTsKICAgICAgICAgICAgYWFkZXBib3g6QWRkU2xpZGVyKCdhbnRpYWltX2NhcnNwaW5zcGVlZCcse1RleHQgPSAnc3BpbiBzcGVlZCAocnBtKScsRGVmYXVsdCA9IDYwLE1pbiA9IDYwLE1heCA9IDM2MCxSb3VuZGluZyA9IDAsQ29tcGFjdCA9IHRydWUsQ2FsbGJhY2sgPSBmdW5jdGlvbihTdGF0ZSkKICAgICAgICAgICAgICAgIGFhc2V0LmNhcnNwaW5zcGVlZCA9IFN0YXRlCiAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgIGFhZGVwYm94OlNldHVwRGVwZW5kZW5jaWVzKHsKICAgICAgICAgICAgICAgIHsgY2hlYXQuT3B0aW9ucy5hbnRpYWltX2NhcnlhdywgInNwaW4iIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgZW5kCiAgICBlbmQKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHdhaXQoKSBkbyBpZiBub2F0dnJlc3RyaWN0aW9uIHRoZW4KICAgICAgICAgICAgc2V0dXB2YWx1ZShnYXJiYWdlLm1heGxvb2t5LCAxLCAxMDAwMCkKICAgICAgICBlbmQgZW5kCiAgICBlbmQpCmVuZApkbwogICAgbG9jYWwgcmVhbF9leHRlbmRlZCA9IDAKICAgIGxvY2FsIGdhbWVfTGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKICAgIGxvY2FsIHRvcnNvX3Nwb29mZWRfaW5kZXggPSB7CiAgICAgICAgWyJUcmFuc3BhcmVuY3kiXSA9IHRyaWRlbnQub3JpZ2luYWxfbW9kZWxbIlRvcnNvIl1bIlRyYW5zcGFyZW5jeSJdLAogICAgICAgIFsiQ2FuQ29sbGlkZSJdID0gdHJpZGVudC5vcmlnaW5hbF9tb2RlbFsiVG9yc28iXVsiQ2FuQ29sbGlkZSJdLAogICAgICAgIFsiU2l6ZSJdID0gdHJpZGVudC5vcmlnaW5hbF9tb2RlbFsiVG9yc28iXVsiU2l6ZSJdCiAgICB9CiAgICBsb2NhbCBsaWdodGluZ19vbGR2YWx1ZXMgPSB7CiAgICAgICAgWyJBbWJpZW50Il0gPSBnYW1lX0xpZ2h0aW5nLkFtYmllbnQsCiAgICAgICAgWyJPdXRkb29yQW1iaWVudCJdID0gZ2FtZV9MaWdodGluZy5PdXRkb29yQW1iaWVudCwKICAgICAgICBbIkZvZ1N0YXJ0Il0gPSBnYW1lX0xpZ2h0aW5nLkZvZ1N0YXJ0LAogICAgICAgIFsiRm9nRW5kIl0gPSBnYW1lX0xpZ2h0aW5nLkZvZ0VuZCwKICAgICAgICBbIkdsb2JhbFNoYWRvd3MiXSA9IGdhbWVfTGlnaHRpbmcuR2xvYmFsU2hhZG93cywKICAgICAgICBbIkNsb2NrVGltZSJdID0gZ2FtZV9MaWdodGluZy5DbG9ja1RpbWUsCiAgICAgICAgWyJUaW1lT2ZEYXkiXSA9IGdhbWVfTGlnaHRpbmcuVGltZU9mRGF5CiAgICB9CiAgICBsb2NhbCBfX2dhbWVpbmRleDsgX19nYW1laW5kZXggPSBob29rbWV0YW1ldGhvZChnYW1lLCAiX19pbmRleCIsIG5ld2NjbG9zdXJlKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKHNlbGYsIGlkeCkKICAgICAgICAtLWlmIGNoZWNrY2FsbGVyKCkgdGhlbiByZXR1cm4gX19nYW1laW5kZXgoc2VsZiwgaWR4KSBlbmQKICAgICAgICBpZiB0eXBlb2Yoc2VsZikgfj0gIkluc3RhbmNlIiB0aGVuIHJldHVybiBfX2dhbWVpbmRleChzZWxmLCBpZHgpIGVuZAogICAgICAgIGlmIChpZHggPT0gIkNhbkNvbGxpZGUiIG9yIGlkeCA9PSAiU2l6ZSIgb3IgaWR4ID09ICJUcmFuc3BhcmVuY3kiKSBhbmQgc2VsZi5OYW1lID09ICJUb3JzbyIgYW5kIHRvcnNvX3Nwb29mZWRfaW5kZXhbaWR4XSB0aGVuCiAgICAgICAgICAgIHJldHVybiB0b3Jzb19zcG9vZmVkX2luZGV4W2lkeF0KICAgICAgICBlbmQKICAgICAgICBpZiBzZWxmID09IGdhbWVfTGlnaHRpbmcgYW5kIGxpZ2h0aW5nX29sZHZhbHVlc1tpZHhdIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGxpZ2h0aW5nX29sZHZhbHVlc1tpZHhdCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIF9fZ2FtZWluZGV4KHNlbGYsIGlkeCkKICAgIGVuZCkpKQogICAgbG9jYWwgX19nYW1lbmV3aW5kZXg7IF9fZ2FtZW5ld2luZGV4ID0gaG9va21ldGFtZXRob2QoZ2FtZSwgIl9fbmV3aW5kZXgiLCBuZXdjY2xvc3VyZShMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihzZWxmLCBpZHgsIHZhbCkKICAgICAgICAtLWlmIGNoZWNrY2FsbGVyKCkgdGhlbiByZXR1cm4gX19nYW1lbmV3aW5kZXgoc2VsZiwgaWR4LCB2YWwpIGVuZAogICAgICAgIGlmIHR5cGVvZihzZWxmKSB+PSAiSW5zdGFuY2UiIHRoZW4gcmV0dXJuIF9fZ2FtZW5ld2luZGV4KHNlbGYsIGlkeCwgdmFsKSBlbmQKICAgICAgICBpZiBzZWxmID09IGdhbWVfTGlnaHRpbmcgdGhlbgogICAgICAgICAgICBsaWdodGluZ19vbGR2YWx1ZXNbaWR4XSA9IHZhbAogICAgICAgICAgICAtLXJldHVybiBfX2dhbWVuZXdpbmRleChzZWxmLCBpZHgsIHZhbCkKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gX19nYW1lbmV3aW5kZXgoc2VsZiwgaWR4LCB2YWwpCiAgICBlbmQpKSkKICAgIGxvY2FsIF9fZ2FtZW5hbWVjYWxsOyBfX2dhbWVuYW1lY2FsbCA9IGhvb2ttZXRhbWV0aG9kKGdhbWUsICJfX25hbWVjYWxsIiwgbmV3Y2Nsb3N1cmUoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oc2VsZiwgLi4uKQogICAgICAgIC0taWYgY2hlY2tjYWxsZXIoKSB0aGVuIHJldHVybiBfX2dhbWVuYW1lY2FsbChzZWxmLCAuLi4pIGVuZAogICAgICAgIGlmIHR5cGVvZihzZWxmKSB+PSAiSW5zdGFuY2UiIHRoZW4gcmV0dXJuIF9fZ2FtZW5hbWVjYWxsKHNlbGYsIC4uLikgZW5kCgogICAgICAgIGxvY2FsIG1ldGhvZCA9IGdldG5hbWVjYWxsbWV0aG9kKCkKICAgICAgICBsb2NhbCBhcmdzID0gey4uLn0KICAgICAgICAtLWlmIG1ldGhvZCA9PSAiUmF5Y2FzdCIgYW5kIG1vZHVsZWNvbW0uc2ltdWxhdGlvbl9wb3MgYW5kIGFyZ3NbM10uQ29sbGlzaW9uR3JvdXAgPT0gIldlYXBvblJheWNhc3QiIHRoZW4KICAgICAgICAtLSAgICBsb2NhbCB0YXJnZXQgPSBtb2R1bGVjb21tLnRhcmdldAogICAgICAgIC0tICAgIGlmIHRhcmdldFsxXSBhbmQgdGFyZ2V0WzJdIHRoZW4KICAgICAgICAtLSAgICAgICAgbG9jYWwgZ3VuaW5mbyA9IHRyaWRlbnQuZ3VuaW5mbwogICAgICAgIC0tICAgICAgICBsb2NhbCBwcm9qX3NwZWVkID0gZ3VuaW5mbyBhbmQgcmF3Z2V0KGd1bmluZm8sICJQcm9qZWN0aWxlU3BlZWQiKQogICAgICAgIC0tICAgICAgICBpZiBndW5pbmZvIGFuZCBwcm9qX3NwZWVkIHRoZW4KICAgICAgICAtLSAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgLS0gICAgICAgICAgICAgICAgSW5zdGFuY2UgPSB0YXJnZXRbMV0sCiAgICAgICAgLS0gICAgICAgICAgICAgICAgUG9zaXRpb24gPSB0YXJnZXRbMV0uUG9zaXRpb24sCiAgICAgICAgLS0gICAgICAgICAgICAgICAgTm9ybWFsID0gVmVjdG9yMy5uZXcoMSwgMCwgMCksCiAgICAgICAgLS0gICAgICAgICAgICAgICAgTWF0ZXJpYWwgPSB0YXJnZXRbMV0uTWF0ZXJpYWwsCiAgICAgICAgLS0gICAgICAgICAgICAgICAgRGlzdGFuY2UgPSAodGFyZ2V0WzFdLlBvc2l0aW9uIC0gYXJnc1sxXSkuTWFnbml0dWRlCiAgICAgICAgLS0gICAgICAgICAgICB9CiAgICAgICAgLS0gICAgICAgIGVuZAogICAgICAgIC0tICAgICAgICByZXR1cm4gX19nYW1lbmFtZWNhbGwoc2VsZiwgdW5wYWNrKGFyZ3MpKQogICAgICAgIC0tICAgIGVuZAogICAgICAgIC0tZW5kCiAgICAgICAgaWYgbWV0aG9kID09ICJGaXJlU2VydmVyIiBhbmQgKHNlbGYgPT0gdHJpZGVudC50Y3Agb3Igc2VsZiA9PSB0cmlkZW50LnVkcCkgdGhlbgogICAgICAgICAgICBpZiBhcmdzWzFdID09IDQ2IHRoZW4KICAgICAgICAgICAgICAgIGlmIHR5cGVvZihhcmdzWzNdKSA9PSAiVmVjdG9yMyIgYW5kIG1vZHVsZWNvbW0uYW50aWFpbS5jYXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFhc2V0ID0gbW9kdWxlY29tbS5hbnRpYWltCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGl0Y2gsIHJvbGwgZG8gLS0gY2FydHJpcG1vZGUgPSBzaWRlLCAtLSBub25lLCBsZWZ0LCByaWdodCwgZnJvbnQsIGJhY2ssIHplcm8KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHJpcG1vZGUgPSBhYXNldC5jYXJ0cmlwbW9kZQogICAgICAgICAgICAgICAgICAgICAgICBwaXRjaCA9ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBtb2RlID09ICJub25lIiBhbmQgYXJnc1s0XS5YIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLXRyaXBtb2RlID09ICJsZWZ0IiBhbmQgLTEgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tdHJpcG1vZGUgPT0gInJpZ2h0IiBhbmQgMSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcG1vZGUgPT0gInplcm8iIGFuZCAwIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzWzRdLlkgb3IgMAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGwgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwbW9kZSA9PSAibm9uZSIgYW5kIGFyZ3NbNF0uWiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS10cmlwbW9kZSA9PSAiZnJvbnQiIGFuZCAtMSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS10cmlwbW9kZSA9PSAiYmFjayIgYW5kIDEgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBtb2RlID09ICJ6ZXJvIiBhbmQgMCBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1s0XS5aIG9yIDAKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHlhdyBkbyAtLSBjYXJ5YXcgPSAibm9uZSIgLS0gbm9uZSwgc3BpbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB5YXdzZXQgPSBhYXNldC5jYXJ5YXcKICAgICAgICAgICAgICAgICAgICAgICAgeWF3ID0gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeWF3c2V0ID09ICJub25lIiBhbmQgYXJnc1s0XS5ZIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXdzZXQgPT0gInNwaW4iIGFuZCAodGljaygpICUgMSkgKiAoKGFhc2V0LmNhcnNwaW5zcGVlZCAvIDM2MCkgKiBtYXRoLnBpKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgeWF3IG9yIDAgLS0gd29tcCB3b21wCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBhcmdzWzRdID0gX1ZlY3RvcjNuZXcocGl0Y2gsIHlhdywgcm9sbCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgYXJnc1sxXSA9PSAxIHRoZW4KCiAgICAgICAgICAgICAgICByZWFsX2V4dGVuZGVkID0gcmVhbF9leHRlbmRlZCArIDEKCiAgICAgICAgICAgICAgICBpZiByZWFsX2V4dGVuZGVkICUgMiA+PSAxIGFuZCBtb2R1bGVjb21tLmV4dGVuZGVkX21hbmlwdWxhdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgYXJnc1s1XSA9IG5pbAogICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dhbWVuYW1lY2FsbChzZWxmLCB1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBtb2R1bGVjb21tLnZlbG9icmVhayB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgcmVhbF9leHRlbmRlZCAlIDQgPT0gMCBvciByZWFsX2V4dGVuZGVkICUgNCA9PSAyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1s1XSA9IG5pbAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGFyZ3NbMl0gPSBhcmdzWzJdICsgKHJlYWxfZXh0ZW5kZWQgJSA0ID09IDEgYW5kIFZlY3RvcjMuemVybyBvciBWZWN0b3IzLnlBeGlzICogbW9kdWxlY29tbS52ZWxvYnJlYWtzdHJlbmdodCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nYW1lbmFtZWNhbGwoc2VsZiwgdW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgbW9kdWxlY29tbS5pbnZpcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgYXJnc1s1XSA9IG5pbAogICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dhbWVuYW1lY2FsbChzZWxmLCB1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAtLS1pZiBtb2R1bGVjb21tLmp1bXBzaG9vdCBvciBtb2R1bGVjb21tLmRvd25oaWxsIHRoZW4KICAgICAgICAgICAgICAgIC0tLSAgICBhcmdzWzVdID0gMQogICAgICAgICAgICAgICAgLS0tZW5kCgogICAgICAgICAgICAgICAgdHJpZGVudC5sYXN0cG9zID0gYXJnc1syXSArIF9WZWN0b3IzbmV3KDAsIDMsIDApCgogICAgICAgICAgICAgICAgaWYgdHlwZW9mKGFyZ3NbM10pID09ICJWZWN0b3IzIiBhbmQgbW9kdWxlY29tbS5hbnRpYWltLmFudGlhaW0gdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFhc2V0ID0gbW9kdWxlY29tbS5hbnRpYWltCiAgICAgICAgICAgICAgICAgICAgaWYgYWFzZXQuYW50aWFpbXlhdyA9PSAiaW52aXNpYmxlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3NbM10gPSBWZWN0b3IzaW50MTYubmV3KDAsIG1hdGguaHVnZSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2FtZW5hbWVjYWxsKHNlbGYsIHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBwaXRjaCBkbyAtLSBhbnRpYWltcGl0Y2ggPSAibm9uZSIsIC0tIG5vbmUsIGRvd24sIHVwLCBqaXR0ZXIsIGN1c3RvbQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwaXRjaHNldCA9IGFhc2V0LmFudGlhaW1waXRjaAogICAgICAgICAgICAgICAgICAgICAgICBwaXRjaCA9ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpdGNoc2V0ID09ICJub25lIiBhbmQgYXJnc1szXS5ZIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXRjaHNldCA9PSAiZG93biIgYW5kIC0xLjUgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpdGNoc2V0ID09ICJ1cCIgYW5kIDEuNSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2hzZXQgPT0gImppdHRlciIgYW5kIChyZWFsX2V4dGVuZGVkICUgMiA9PSAwIGFuZCAtMS41IG9yIDEuNSkgKiAoYWFzZXQucGl0Y2hqaXR0ZXJzaXplIC8gOTApIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXRjaHNldCA9PSAiY3VzdG9tIiBhbmQgMS41ICogKGFhc2V0LnBpdGNoY3VzdG9tIC8gOTApIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzWzNdLlkgb3IgMAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgeWF3IGRvIC0tIGFudGlhaW15YXcgPSAibm9uZSIsIC0tIG5vbmUsIHNwaW4sIHN0YXRpYywgaml0dGVyLCBpbnZpc2libGUKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgeWF3c2V0ID0gYWFzZXQuYW50aWFpbXlhdwogICAgICAgICAgICAgICAgICAgICAgICB5YXcgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoeWF3c2V0ID09ICJzdGF0aWMiIG9yIHlhd3NldCA9PSAiaml0dGVyIikgYW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFyZ3NbM10uWCArIChtYXRoLnJhZChhYXNldC55YXdvZmZzZXQpIC0gKGFhc2V0LmJhY2t3YXJkcyBhbmQgbWF0aC5waSBvciAwKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICkgb3IgMAogICAgICAgICAgICAgICAgICAgICAgICB5YXcgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXdzZXQgPT0gIm5vbmUiIGFuZCBhcmdzWzNdLlkgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlhd3NldCA9PSAic3BpbiIgYW5kICh0aWNrKCkgJSAxKSAqICgoYWFzZXQuc3BpbnNwZWVkIC8gMzYwKSAqIG1hdGgucGkpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLXlhd3NldCA9PSAiaW52aXNpYmxlIiBhbmQgbWF0aC5odWdlIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXdzZXQgPT0gImppdHRlciIgYW5kIG1hdGgucmFkKChyZWFsX2V4dGVuZGVkICUgMiA9PSAwIGFuZCAxIG9yIC0xKSAqIChhYXNldC55YXdqaXR0ZXJzaXplIC8gMikpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXcgb3IgMCAtLSB3b21wIHdvbXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIGZvciBldmVyeSBza2lkIG91dCBoZXJlLCBpbSAxNCBhbmQgaSBkaWQgdGhpcyBtYXRoIGFsbCBieSBteXNlbGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIGRvbid0IGFzayBtZSB0aGUgcmVhc29ucyBvZiB3aHlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBleGNlcHQgc3BpbgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgYXJnc1szXSA9IF9WZWN0b3IzbmV3KHBpdGNoLCB5YXcsIDApCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGFyZ3NbMV0gPT0gMiBhbmQgbW9kdWxlY29tbS5zaWxlbnR3YWxrIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBfX2dhbWVuYW1lY2FsbChzZWxmLCAyLCB0cnVlKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgYXJnc1sxXSA9PSAxMCB0aGVuCiAgICAgICAgICAgICAgICBpZiBhcmdzWzJdID09ICJGaXJlIiBhbmQgdHlwZW9mKGFyZ3NbNF0pID09ICJDRnJhbWUiIGFuZCBtb2R1bGVjb21tLnNpbXVsYXRpb24gYW5kIG1vZHVsZWNvbW0uc2ltdWxhdGlvbl9wb3MgdGhlbgoKCiAgICAgICAgICAgICAgICAgICAgLS1bWwogICAgICAgICAgICAgICAgICAgICAgICBsX05ldENsaWVudF8wLlNlbmRUQ1AoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsX1NlbmRDb2Rlc18wLklOVl9VU0VfSVRFTSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJGaXJlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmX29yaWdpbgogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIF1dCiAgICAgICAgICAgICAgICAgICAgLS1bWwogICAgICAgICAgICAgICAgICAgICAgICBsX05ldENsaWVudF8wLlNlbmRUQ1AoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsX1NlbmRDb2Rlc18wLklOVl9VU0VfSVRFTSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJIaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJheWNhc3RyZXMuSW5zdGFuY2UuTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJheWNhc3RyZXMuUG9zaXRpb24gLSBlbnRpdHkubW9kZWwuUHJpbWFyeVBhcnQuUG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXljYXN0cmVzLlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgXV0KCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gbW9kdWxlY29tbS50YXJnZXQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBndW5pbmZvICAgID0gdHJpZGVudC5ndW5pbmZvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHJval9zcGVlZCA9IGd1bmluZm8gYW5kIHJhd2dldChndW5pbmZvLCAiUHJvamVjdGlsZVNwZWVkIikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBwcm9qX2Ryb3AgID0gZ3VuaW5mbyBhbmQgcmF3Z2V0KGd1bmluZm8sICJQcm9qZWN0aWxlRHJvcCIpIG9yIDAKICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXRbMV0gYW5kIHRhcmdldFsyXSBhbmQgZ3VuaW5mbyBhbmQgcHJval9zcGVlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0tY3JlYXRlX2Nvb2xfYmVhbShhcmdzWzRdLnAsIG1vZHVsZWNvbW0uc2ltdWxhdGlvbl9wb3MsIENvbG9yMy5uZXcoMCwxLDApLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVfY29vbF9iZWFtKGFyZ3NbNF0ucCwgdGFyZ2V0WzFdLlBvc2l0aW9uLCBDb2xvcjMubmV3KDAsMSwwKSwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1s0XSA9IENGcmFtZS5sb29rQXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzWzRdLnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVjb21tLnNpbXVsYXRpb25fcG9zICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9WZWN0b3IzbmV3KDAsIHByZWRpY3RfZHJvcF9wb3NpdGlvbihtb2R1bGVjb21tLnNpbXVsYXRpb25fcG9zLCBwcm9qX3NwZWVkLCBwcm9qX2Ryb3AsIGFyZ3NbNF0ucCksIDApCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2FtZW5hbWVjYWxsKHNlbGYsIHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgYXJnc1syXSA9PSAiSGl0IiBhbmQgdHlwZShhcmdzWzVdKSA9PSAibnVtYmVyIiBhbmQgdHlwZShhcmdzWzZdKSA9PSAic3RyaW5nIiBhbmQgdHlwZW9mKGFyZ3NbN10pID09ICJWZWN0b3IzIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW50aXR5ID0gcmF3Z2V0KGdldHVwdmFsdWUoZ2FyYmFnZS5lbnRpdHlsaXN0LCAxKSwgYXJnc1s1XSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlbnRpdHltb2RlbCA9IGVudGl0eSBhbmQgcmF3Z2V0KGVudGl0eSwgIm1vZGVsIikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlbnRpdHloZWFkID0gZW50aXR5bW9kZWwgYW5kIF9GaW5kRmlyc3RDaGlsZChlbnRpdHltb2RlbCwgIkhlYWQiKQogICAgICAgICAgICAgICAgICAgIGlmIGVudGl0eWhlYWQgdGhlbgoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbW9kdWxlY29tbS5mb3JjZWhlYWQgdGhlbiBhcmdzWzZdID0gIkhlYWQiIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGFydCA9IF9GaW5kRmlyc3RDaGlsZChlbnRpdHltb2RlbCwgYXJnc1s2XSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgb3JpZ2luYWxwYXJ0ID0gX0ZpbmRGaXJzdENoaWxkKHRyaWRlbnQub3JpZ2luYWxfbW9kZWwsIGFyZ3NbNl0pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAocGFydCBhbmQgb3JpZ2luYWxwYXJ0KSB0aGVuIHJldHVybiBfX2dhbWVuYW1lY2FsbChzZWxmLCB1bnBhY2soYXJncykpIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2ltcG9zID0gbW9kdWxlY29tbS5zaW11bGF0aW9uX3BvcwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbW9kdWxlY29tbS5oaXRib3hlcyBvciBzaW1wb3MgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHJpbWFyeXBhcnQgPSBlbnRpdHltb2RlbC5QcmltYXJ5UGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGFydG9mZnNldCA9IHBhcnQuUG9zaXRpb24gLSBwcmltYXJ5cGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1s3XSA9IF9WZWN0b3IzbmV3KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGgucmFuZG9tKC1vcmlnaW5hbHBhcnQuU2l6ZS5YLCBvcmlnaW5hbHBhcnQuU2l6ZS5YKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRoLnJhbmRvbSgtb3JpZ2luYWxwYXJ0LlNpemUuWSwgb3JpZ2luYWxwYXJ0LlNpemUuWSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0aC5yYW5kb20oLW9yaWdpbmFscGFydC5TaXplLlosIG9yaWdpbmFscGFydC5TaXplLlopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApICsgcGFydG9mZnNldAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2ltcG9zIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IG1vZHVsZWNvbW0udGFyZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBndW5pbmZvID0gdHJpZGVudC5ndW5pbmZvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwcm9qX3NwZWVkID0gZ3VuaW5mbyBhbmQgcmF3Z2V0KGd1bmluZm8sICJQcm9qZWN0aWxlU3BlZWQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHJval9kcm9wICA9IGd1bmluZm8gYW5kIHJhd2dldChndW5pbmZvLCAiUHJvamVjdGlsZURyb3AiKSBvciAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgKHRhcmdldFsxXSBhbmQgdGFyZ2V0WzJdKSB0aGVuIHJldHVybiBfX2dhbWVuYW1lY2FsbChzZWxmLCB1bnBhY2soYXJncykpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZHJvcCwgdGltZSA9IHByZWRpY3RfZHJvcF9wb3NpdGlvbihzaW1wb3MsIHByb2pfc3BlZWQsIHByb2pfZHJvcCwgQ2FtZXJhLkNGcmFtZS5wKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1s0XSA9IChzaW1wb3MgLSBDYW1lcmEuQ0ZyYW1lLnApLk1hZ25pdHVkZSAvIHByb2pfc3BlZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3NbOF0gPSBzaW1wb3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tY3JlYXRlX2Nvb2xfYmVhbShDYW1lcmEuQ0ZyYW1lLnAsIGFyZ3NbOF0sIENvbG9yMy5uZXcoMSwxLDEpLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KGFyZ3NbNF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5GaXJlU2VydmVyKHNlbGYsIHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmV0dXJuIF9fZ2FtZW5hbWVjYWxsKHNlbGYsIHVucGFjayhhcmdzKSkKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gX19nYW1lbmFtZWNhbGwoc2VsZiwgLi4uKQogICAgZW5kKSkpCmVuZAoKdWkuYm94LnRoZW1lY29uZmlnOkFkZFRvZ2dsZSgna2V5YmluZHNob3d3Jywge1RleHQgPSAnc2hvdyBrZXliaW5kcycsRGVmYXVsdCA9IGZhbHNlLENhbGxiYWNrID0gZnVuY3Rpb24oZmlyc3QpY2hlYXQuTGlicmFyeS5LZXliaW5kRnJhbWUuVmlzaWJsZSA9IGZpcnN0IGVuZH0pCmNoZWF0LlRoZW1lTWFuYWdlcjpTZXRPcHRpb25zVEVNUChjaGVhdC5PcHRpb25zLCBjaGVhdC5Ub2dnbGVzKQpjaGVhdC5TYXZlTWFuYWdlcjpTZXRPcHRpb25zVEVNUChjaGVhdC5PcHRpb25zLCBjaGVhdC5Ub2dnbGVzKQpjaGVhdC5UaGVtZU1hbmFnZXI6U2V0TGlicmFyeShjaGVhdC5MaWJyYXJ5KQpjaGVhdC5TYXZlTWFuYWdlcjpTZXRMaWJyYXJ5KGNoZWF0LkxpYnJhcnkpCmNoZWF0LlNhdmVNYW5hZ2VyOklnbm9yZVRoZW1lU2V0dGluZ3MoKQpjaGVhdC5UaGVtZU1hbmFnZXI6U2V0Rm9sZGVyKCdzeW50YXgnKQpjaGVhdC5TYXZlTWFuYWdlcjpTZXRGb2xkZXIoJ3N5bnRheCcpCmNoZWF0LlNhdmVNYW5hZ2VyOkJ1aWxkQ29uZmlnU2VjdGlvbih1aS50YWJzLmNvbmZpZykKY2hlYXQuVGhlbWVNYW5hZ2VyOkFwcGx5VG9Hcm91cGJveCh1aS5ib3gudGhlbWVjb25maWcpCgpjaGVhdC5Fc3BMaWJyYXJ5LmxvYWQoKQoKLS1ydW5fb25fYWN0b3IoZ2V0YWN0b3JzKClbMV0sIHNvdXJjZSk=]]
local decoded = game:HttpGet("data:text/plain;base64," .. encoded)
local func, err = loadstring(decoded)
if func then
    func()
else
    warn("Erro ao carregar script ofuscado:", err)
end
